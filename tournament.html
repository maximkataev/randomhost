<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>–¢—É—Ä–Ω–∏—Ä</title>
  <meta name="description" content="–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä, –≥–¥–µ –¥–≤–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–∞ —Å—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞ –ø–æ —á–µ—Å—Ç–Ω—ã–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <link rel="canonical" href="https://randomhost.online/tournament.html">

  <!-- Open Graph -->
  <meta property="og:locale" content="ru_RU">
  <meta property="og:type" content="website">
  <meta property="og:title" content="–¢—É—Ä–Ω–∏—Ä">
  <meta property="og:description" content="–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞. –ß–µ—Å—Ç–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, —ç–ø–∏—á–Ω—ã–µ –ø–æ–±–µ–¥—ã.">
  <meta property="og:url" content="https://randomhost.online/tournament.html">
  <meta property="og:site_name" content="–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä-–∏–≥—Ä—ã">

  <!-- Icons -->
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/2694.svg" type="image/svg+xml">
  <meta name="theme-color" content="#764ba2">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      touch-action: manipulation;
    }

    /* ===== DESKTOP –ú–ï–ù–Æ ===== */
    .top-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .desktop-menu-toggle {
      position: relative;
      background: linear-gradient(135deg, rgba(30,35,60,0.85), rgba(50,30,70,0.85));
      backdrop-filter: blur(12px);
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow:
        0 4px 15px rgba(0,0,0,0.3),
        0 0 0 0 rgba(255,255,255,0.4);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
    }

    .desktop-menu-toggle::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2, #667eea);
      background-size: 200% 200%;
      animation: gradientSpin 3s ease infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    @keyframes gradientSpin {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .desktop-menu-toggle:hover::before {
      opacity: 1;
    }

    .desktop-menu-toggle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow:
        0 8px 25px rgba(0,0,0,0.4),
        0 0 0 8px rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
    }

    .desktop-menu-toggle:active {
      transform: translateY(-1px) scale(0.98);
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 18px;
      position: relative;
      transition: transform 0.3s ease;
    }

    .menu-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background: #fff;
      border-radius: 2px;
      position: absolute;
      left: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .menu-icon span:nth-child(1) {
      top: 0;
    }

    .menu-icon span:nth-child(2) {
      top: 50%;
      margin-top: -1.5px;
    }

    .menu-icon span:nth-child(3) {
      bottom: 0;
    }

    .desktop-menu-toggle:hover .menu-icon {
      transform: scale(1.1);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(1) {
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(45deg);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(2) {
      opacity: 0;
      transform: rotate(180deg) scale(0);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(3) {
      bottom: auto;
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(-45deg);
    }

    .desktop-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 15px;
      background: linear-gradient(135deg, rgba(20,25,45,0.92), rgba(40,20,55,0.92));
      backdrop-filter: blur(20px);
      border-radius: 16px;
      box-shadow:
        0 10px 40px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.15) inset,
        0 0 20px rgba(102,126,234,0.2);
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(-10px);
      transition:
        max-height 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55),
        opacity 0.3s ease,
        transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      min-width: 240px;
    }

    .desktop-dropdown.active {
      max-height: 600px;
      opacity: 1;
      transform: translateY(0);
    }

    .desktop-dropdown a {
      position: relative;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .desktop-dropdown a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      transform: translateX(-4px);
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(102,126,234,0.2), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .desktop-dropdown a:last-child {
      border-bottom: none;
    }

    .desktop-dropdown a:hover {
      background: rgba(102,126,234,0.25);
      padding-left: 24px;
      color: #ffd43b;
      text-shadow: 0 0 10px rgba(255,212,59,0.5);
    }

    .desktop-dropdown a:hover::before {
      transform: translateX(0);
    }

    .desktop-dropdown a:hover::after {
      opacity: 1;
    }

    .desktop-dropdown a:active {
      background: rgba(118,75,162,0.3);
      transform: scale(0.98);
    }

    .desktop-dropdown a span:first-child {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a:hover span:first-child {
      transform: scale(1.2) rotate(10deg);
    }

    /* ===== MOBILE –ú–ï–ù–Æ (–°–ö–†–´–¢–û –ü–û –î–ï–§–û–õ–¢–£ –ù–ê DESKTOP) ===== */
    .menu-container {
      display: none;
    }

    /* ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ===== */
    .main-container {
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      align-items: center;
      max-width: 1200px;
      width: 100%;
    }

    .game-container {
      flex: 1;
      text-align: center;
      perspective: 1000px;
      position: relative;
    }

    .arena {
      width: 100%;
      height: 600px;
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      border: 3px solid rgba(255,255,255,0.15);
      box-shadow:
        0 12px 40px rgba(0,0,0,0.5),
        0 0 40px rgba(102,126,234,0.35);
      background:
        radial-gradient(circle at 50% 0%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(circle at 0% 100%, rgba(0,255,255,0.08), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255,0,255,0.08), transparent 55%),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(180deg, rgba(255,255,255,0.04) 1px, transparent 1px),
        #0b1020;
      background-size:
        100% 100%,
        100% 100%,
        100% 100%,
        48px 48px,
        48px 48px,
        auto;
    }

    .arena::before {
      content: '';
      position: absolute;
      inset: 24px;
      border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.08);
      box-shadow: 0 0 30px rgba(0,0,0,0.7) inset;
      pointer-events: none;
    }

    .arena::after {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      width: 3px;
      height: 100%;
      transform: translateX(-50%);
      background: linear-gradient(
        180deg,
        rgba(255,255,255,0) 0%,
        rgba(255,255,255,0.35) 20%,
        rgba(255,255,255,0.35) 80%,
        rgba(255,255,255,0) 100%
      );
      opacity: 0.45;
      pointer-events: none;
    }

    .settings-panel {
      width: 450px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .settings-title {
      color: #fff;
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .settings-actions {
      display: flex;
      gap: 8px;
    }

    .equalize-btn, .collapse-btn {
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(102,126,234,0.8), rgba(118,75,162,0.8));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
    }

    .collapse-btn {
      display: none;
    }

    .equalize-btn:hover, .collapse-btn:hover {
      background: linear-gradient(135deg, rgba(118,75,162,1), rgba(102,126,234,1));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      border-color: rgba(255,255,255,0.5);
    }

    .equalize-btn:active, .collapse-btn:active {
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .names-list-wrapper {
      transition: max-height 0.3s ease;
    }

    .names-list-wrapper.collapsed {
      max-height: 0;
      overflow: hidden;
    }

    .names-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-height: 500px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-right: 5px;
    }
    .names-list::-webkit-scrollbar {
      display: none;
    }

    .headers-row {
      display: flex;
      align-items: center;
      gap: 0px;
      margin-bottom: 10px;
      padding: 0 5px;
    }

    .header-name {
      flex: 1;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: left;
    }

    .header-probability {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      width: 120px;
      flex-shrink: 0;
    }

    .header-remove {
      width: 44px;
    }

    .name-item {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .name-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      transition: 0.3s;
    }
    .name-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.2);
    }
    .name-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .name-input.error-state {
      border-color: #ef4444 !important;
      background: rgba(239,68,68,0.1) !important;
    }

    .name-input.error-state::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .probability-controls {
      display: flex;
      gap: 5px;
      width: 120px;
      flex-shrink: 0;
    }

    .prob-btn {
      padding: 5px 10px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .prob-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .prob-btn:active {
      transform: scale(0.95);
    }

    .probability-input {
      width: 55px;
      padding: 4px;
      background: rgba(255,255,255,0.1);
      color: #ffd43b;
      border: 2px solid rgba(255,212,59,0.3);
      border-radius: 5px;
      text-align: center;
      font-weight: 800;
      font-size: 14px;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .probability-input::-webkit-outer-spin-button,
    .probability-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .probability-input[type=number] {
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .probability-input.error {
      border-color: #ef4444;
      background: rgba(239,68,68,0.2);
    }

    .probability-input.manual {
      background: rgba(255,244,204,0.25);
      border-color: #F59E0B;
      box-shadow: 0 0 0 3px rgba(245,158,11,0.25);
    }

    .prob-btn,
    .remove-btn,
    .add-btn-small {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .equalize-btn {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .prob-btn:hover,
    .remove-btn:hover,
    .add-btn-small:hover,
    .equalize-btn:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    .probability-input:focus {
      outline: none;
      border-color: rgba(255,212,59,0.6);
      background: rgba(255,255,255,0.15);
    }

    .remove-btn {
      padding: 8px 12px;
      background: rgba(239,68,68,0.2);
      color: #fff;
      border: 2px solid rgba(239,68,68,0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      transition: 0.2s;
      width: 44px;
      flex-shrink: 0;
    }

    .remove-btn:hover {
      background: rgba(239,68,68,0.4);
      border-color: rgba(239,68,68,0.5);
      transform: scale(1.05);
    }

    .remove-btn:active {
      transform: scale(0.95);
    }

    .add-name-container {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .add-btn-small {
      padding: 10px 15px;
      background: rgba(34,197,94,0.7);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 20px;
      transition: 0.3s;
    }
    .add-btn-small:hover {
      background: rgba(34,197,94,0.9);
      transform: scale(1.1);
    }

    .add-btn-small:active {
      transform: scale(0.95);
    }

    .start-btn {
      width: auto;
      min-width: 200px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 800;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      margin-top: 20px;
    }

    .start-btn:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .start-btn:hover:not(:disabled):before {
      width: 300px;
      height: 300px;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .start-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:disabled,
    input:disabled {
      opacity: 0.5;
      cursor: not-allowed !important;
    }

    .error-message {
      color: #fff;
      font-size: 13px;
      margin-top: 8px;
      min-height: 16px;
    }

    /* ===== ARENA ELEMENTS ===== */
    .participant {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 0 20px currentColor;
      opacity: 0;
      transform: scale(0);
      animation: smokeAppear 1.2s ease-out forwards;
    }

    .participant.inactive {
      filter: grayscale(1) brightness(0.5);
      box-shadow: 0 0 10px rgba(128, 128, 128, 0.3);
    }

    @keyframes smokeAppear {
      0% {
        opacity: 0;
        transform: scale(0) translateY(50px);
        filter: blur(10px);
      }
      50% {
        opacity: 0.5;
        filter: blur(5px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
        filter: blur(0);
      }
    }

    .smoke-effect {
      position: absolute;
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
      animation: smokeExpand 1.5s ease-out forwards;
      z-index: 1;
    }

    @keyframes smokeExpand {
      0% {
        transform: scale(0);
        opacity: 0.8;
      }
      100% {
        transform: scale(3);
        opacity: 0;
      }
    }

    .participant-name {
      position: absolute;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      white-space: nowrap;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      pointer-events: none;
      transform: translate(-50%, calc(-100% - 20px));
      opacity: 0;
      animation: nameAppear 1s ease-out 0.5s forwards;
    }

    .participant-name.inactive {
      color: rgba(128, 128, 128, 0.7);
      text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
    }

    @keyframes nameAppear {
      from {
        opacity: 0;
        transform: translate(-50%, calc(-100% - 15px));
      }
      to {
        opacity: 1;
        transform: translate(-50%, calc(-100% - 20px));
      }
    }

    .celebration-emoji {
      position: fixed;
      font-size: 60px;
      z-index: 998;
      pointer-events: none;
      animation: emojiCelebrate 3s ease-out forwards;
    }

    @keyframes emojiCelebrate {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      20% { transform: scale(1.5) rotate(180deg); opacity: 1; }
      80% { opacity: 1; }
      100% { transform: scale(0.5) rotate(360deg); opacity: 0; }
    }

    .celebration-word {
      position: fixed;
      font-size: 40px;
      font-weight: 800;
      color: #fff;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
      z-index: 998;
      pointer-events: none;
      animation: wordCelebrate 4s ease-out forwards;
    }

    @keyframes wordCelebrate {
      0% { transform: scale(0) translateY(0) rotate(0deg); opacity: 0; }
      15% { transform: scale(1.2) translateY(-20px) rotate(5deg); opacity: 0.9; }
      50% { opacity: 0.8; }
      100% { transform: scale(0.8) translateY(-150px) rotate(15deg); opacity: 0; }
    }

    .winner-announcement {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95));
      backdrop-filter: blur(10px);
      padding: 30px 50px;
      border-radius: 20px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.4);
      z-index: 1001;
      display: none;
      text-align: center;
    }

    .winner-announcement.show {
      display: block;
      animation: winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .winner-announcement h2 {
      color: #fff;
      font-size: 36px;
      margin: 0;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      line-height: 1.2;
    }

    .winner-name {
      display: block;
      margin: 8px 0 0;
      font-size: 1.4em;
      letter-spacing: 0.03em;
    }

    .winner-emoji {
      font-size: 1.2em;
    }

    .battle-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .battle-overlay.active {
      display: flex;
    }

    .rps-icons {
      display: flex;
      gap: 60px;
      margin-bottom: 40px;
    }

    .rps-icon {
      font-size: 120px;
      opacity: 0;
      transform: scale(0);
      transition: all 0.4s ease;
    }

    .rps-icon:first-child {
      transform: rotate(90deg) scale(0);
    }

    .rps-icon:last-child {
      transform: rotate(-90deg) scale(0);
    }

    .rps-icon.shaking {
      opacity: 1;
      animation: shake 0.3s ease-in-out infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      25% { transform: translateY(-15px) rotate(-10deg); }
      50% { transform: translateY(-5px) rotate(0deg); }
      75% { transform: translateY(-15px) rotate(10deg); }
    }

    .rps-icon:first-child.shaking {
      animation: shakeLeft 0.3s ease-in-out infinite;
    }

    .rps-icon:last-child.shaking {
      animation: shakeRight 0.3s ease-in-out infinite;
    }

    @keyframes shakeLeft {
      0%, 100% { transform: translateY(0) rotate(85deg); }
      25% { transform: translateY(-15px) rotate(80deg); }
      50% { transform: translateY(-5px) rotate(90deg); }
      75% { transform: translateY(-15px) rotate(100deg); }
    }

    @keyframes shakeRight {
      0%, 100% { transform: translateY(0) rotate(-85deg); }
      25% { transform: translateY(-15px) rotate(-80deg); }
      50% { transform: translateY(-5px) rotate(-90deg); }
      75% { transform: translateY(-15px) rotate(-100deg); }
    }

    .rps-icon.show {
      opacity: 1;
      animation: none;
    }

    .rps-icon:first-child.show {
      transform: rotate(90deg) scale(1);
    }

    .rps-icon:last-child.show {
      transform: rotate(-90deg) scale(1);
    }

    .rps-icon.winner {
      filter: drop-shadow(0 0 30px rgba(255,215,0,0.8));
      animation: pulse 0.5s ease-in-out;
    }

    .rps-icon:first-child.winner {
      transform: rotate(90deg) scale(1.3);
    }

    .rps-icon:last-child.winner {
      transform: rotate(-90deg) scale(1.3);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1.3); }
      50% { transform: scale(1.5); }
    }

    .rps-icon:first-child.winner {
      animation: pulseLeft 0.5s ease-in-out;
    }

    .rps-icon:last-child.winner {
      animation: pulseRight 0.5s ease-in-out;
    }

    @keyframes pulseLeft {
      0%, 100% { transform: rotate(90deg) scale(1.3); }
      50% { transform: rotate(90deg) scale(1.5); }
    }

    @keyframes pulseRight {
      0%, 100% { transform: rotate(-90deg) scale(1.3); }
      50% { transform: rotate(-90deg) scale(1.5); }
    }

    .battle-participants {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 80px;
      font-size: 24px;
      color: #fff;
      font-weight: 700;
      position: absolute;
      top: 15%;
      left: 50%;
      transform: translateX(-50%);
      width: 100%;
    }

    .battle-participant-pill {
      padding: 10px 18px;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,0.4);
      background: radial-gradient(circle at 0% 0%, rgba(255,255,255,0.18), transparent 55%);
      box-shadow: 0 6px 18px rgba(0,0,0,0.45);
      min-width: 160px;
      max-width: 350px;
      width: auto;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      backdrop-filter: blur(6px);
      display: flex;
      align-items: center;
      justify-content: center;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .battle-name-text {
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
    }

    .battle-vs {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      font-size: 24px;
      font-weight: 900;
      color: #ffd43b;
      text-shadow:
        0 0 12px rgba(255,212,59,0.9),
        0 0 24px rgba(255,212,59,0.6);
    }

    .winner-announcement {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95));
      padding: 40px 60px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      z-index: 1001;
      display: none;
      text-align: center;
    }

    .winner-announcement.show {
      display: block;
      animation: winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes winnerAppear {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    }

    .winner-announcement h2 {
      color: #fff;
      font-size: 36px;
      margin: 0;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      line-height: 1.2;
    }

    .winner-name {
      display: block;
      margin: 2px 0 0;
      font-size: 1.4em;
      letter-spacing: 0.03em;
      transform: translateY(-15px);
    }

    .winner-emoji {
      font-size: 1.2em;
    }

    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 2000;
    }

    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .celebration-word {
      position: fixed;
      font-size: 48px;
      font-weight: 900;
      color: #ffd700;
      text-shadow:
        0 0 10px rgba(255,215,0,0.8),
        0 0 20px rgba(255,215,0,0.6),
        0 0 30px rgba(255,215,0,0.4),
        3px 3px 6px rgba(0,0,0,0.5);
      pointer-events: none;
      z-index: 2000;
      animation: celebrationFloat 3s ease-out forwards;
      opacity: 0;
    }

    @keyframes celebrationFloat {
      0% {
        opacity: 0;
        transform: scale(0.5) translateY(0) rotate(-10deg);
      }
      20% {
        opacity: 1;
        transform: scale(1.2) translateY(-30px) rotate(5deg);
      }
      80% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: scale(0.8) translateY(-200px) rotate(15deg);
      }
    }

    .champion-trophy {
      font-size: 80px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: trophyAppear 1s ease-out forwards;
      filter: drop-shadow(0 0 20px rgba(255,215,0,0.8));
    }

    @keyframes trophyAppear {
      0% {
        transform: translate(-50%, -50%) scale(0) rotate(-180deg);
        opacity: 0;
      }
      60% {
        transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
      }
      100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .spotlight {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.3), transparent);
      pointer-events: none;
      animation: spotlightPulse 2s ease-in-out infinite;
    }

    @keyframes spotlightPulse {
      0%, 100% {
        opacity: 0.6;
        transform: scale(1);
      }
      50% {
        opacity: 0.9;
        transform: scale(1.1);
      }
    }

    .finalist-label {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #1a1a2e;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 15px rgba(255,215,0,0.5);
      animation: labelGlow 2s ease-in-out infinite;
      white-space: nowrap;
    }

    @keyframes labelGlow {
      0%, 100% {
        box-shadow: 0 4px 15px rgba(255,215,0,0.5);
      }
      50% {
        box-shadow: 0 4px 25px rgba(255,215,0,0.9);
      }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }

      .settings-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-container {
        width: 100%;
      }
    }

    @media (max-width: 918px) {
      html, body {
        max-width: 100%;
        overflow-x: hidden;
      }
      body {
        padding: calc(66px + var(--safe-top)) var(--safe-right) calc(20px + var(--safe-bottom)) var(--safe-left);
      }

      .top-buttons {
        display: none;
      }

      .menu-container {
        display: block;
        position: fixed;
        top: var(--safe-top);
        left: var(--safe-left);
        right: var(--safe-right);
        z-index: 1000;
        padding: 12px 16px;
        background: linear-gradient(180deg, rgba(102,126,234,0.95) 0%, rgba(118,75,162,0.85) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .menu-title {
        color: #fff;
        font-size: 18px;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .burger-btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 4px;
        transition: all 0.3s ease;
      }

      .burger-btn:hover {
        background: rgba(255,255,255,0.3);
      }

      .burger-btn span {
        display: block;
        width: 24px;
        height: 3px;
        background: #fff;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .burger-btn.active span:nth-child(1) {
        transform: rotate(45deg) translateY(7px);
      }

      .burger-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .burger-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translateY(-7px);
      }

      .menu-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, rgba(102,126,234,0.98) 0%, rgba(118,75,162,0.98) 100%);
        backdrop-filter: blur(10px);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .menu-dropdown.active {
        max-height: 500px;
      }

      .menu-dropdown a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        transition: background 0.2s;
      }

      .menu-dropdown a:last-child {
        border-bottom: none;
      }

      .menu-dropdown a:hover {
        background: rgba(255,255,255,0.15);
      }

      .menu-dropdown a:active {
        background: rgba(255,255,255,0.25);
      }

      .menu-dropdown a.active {
        background: linear-gradient(90deg, rgba(139,92,246,0.25), rgba(139,92,246,0.15));
        color: #8B5CF6;
        text-shadow: 0 0 10px rgba(139,92,246,0.5);
        border-left: 4px solid #8B5CF6;
        padding-left: 16px;
        font-weight: 700;
      }

      .main-container {
        flex-direction: column;
        gap: 20px;
      }

      .collapse-btn {
        display: block;
      }

      .arena {
        height: 400px;
      }

      .rps-icon {
        font-size: 80px;
      }

      .battle-participants {
        font-size: 18px;
        gap: 40px;
      }

      .winner-announcement {
        font-size: 32px;
      }

      .name-item {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
      }

      .name-item .name-input {
        flex: 1;
        min-width: 0;
      }

      .name-item .probability-controls {
        flex-shrink: 0;
      }

      .name-item .remove-btn {
        flex-shrink: 0;
      }

      .names-list-wrapper {
        max-height: none;
      }

      .names-list {
        max-height: none;
        overflow-y: visible;
        overflow: visible;
        width: 100%;
        max-width: 100%;
        flex: 1 1 auto;
      }

      .name-input.invalid {
        border-color: #ef4444 !important;
        background: rgba(239,68,68,0.1) !important;
      }

      .headers-row {
        padding: 0 2px;
      }

      h1 {
        font-size: clamp(24px, 6vw, 48px);
        margin-bottom: 30px;
        margin-top: 18px !important;
      }

      .probability-error-tooltip {
        max-width: 90%;
        padding: 16px 20px;
        font-size: 14px;
      }

      .participant {
        font-size: 11px;
        padding: 6px 10px;
        min-width: 25px;
        min-height: 25px;
      }

      .battle-participant-pill {
        font-size: 16px;
        min-width: 120px;
        max-width: 200px;
        padding: 8px 14px;
      }

      .add-name-container {
        display: flex;
        gap: 8px;
        margin-top: 15px;
      }

      .add-name-container .name-input {
        flex: 1;
        min-width: 0;
      }

      .add-btn-small {
        flex-shrink: 0;
        width: 44px;
        padding: 10px 0;
      }

      .settings-panel {
        width: 100%;
        max-width: 600px;
        padding: 20px 16px;
        margin: 0 auto;
      }

      .settings-header {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin-bottom: 10px;
      }

      .settings-actions {
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: 8px;
        margin-bottom: 4px;
      }

      .settings-actions .equalize-btn,
      .settings-actions .collapse-btn {
        flex: 1;
        max-width: 48%;
        padding: 10px 0;
        font-size: 14px;
        text-align: center;
      }
    }

    /* –¢—É–ª—Ç–∏–ø –¥–ª—è –æ—à–∏–±–æ–∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π */
    .probability-error-tooltip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95));
      color: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      z-index: 1002;
      font-size: 16px;
      font-weight: 600;
      text-align: center;
      max-width: 400px;
      animation: tooltipAppear 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes tooltipAppear {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
  </style>
</head>
<body>
  <!-- Desktop Menu -->
  <div class="top-buttons">
    <button class="desktop-menu-toggle" id="desktopMenuToggle" aria-label="–ú–µ–Ω—é">
      <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    <nav class="desktop-dropdown" id="desktopDropdown">
      <a href="index.html"><span>üè†</span> –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html"><span>üé°</span> –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html"><span>üé±</span> –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html"><span>üîÆ</span> –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html"><span>üéØ</span> –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html"><span>üèÅ</span> –ì–æ–Ω–∫–∏</a>
      <a href="trading.html"><span>üìà</span> –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html"><span>‚öîÔ∏è</span> –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <!-- MOBILE –ú–ï–ù–Æ -->
  <div class="menu-container">
    <div class="menu-header">
      <button class="burger-btn" id="burgerBtn" aria-label="–ú–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="menu-dropdown" id="menuDropdown">
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html">üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html">üé± –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html">üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html">üéØ –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html">üèÅ –ì–æ–Ω–∫–∏</a>
      <a href="trading.html">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <div class="main-container">
    <!-- Game Container -->
    <div class="game-container">
      <h1 style="color: #fff; text-align: center; font-size: 48px; font-weight: 800; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.5);">–¢–£–†–ù–ò–†</h1>
      <div class="arena" id="arena">
        <div class="battle-overlay" id="battleOverlay">
          <div class="battle-participants" id="battleParticipants"></div>
          <div class="rps-icons" id="rpsIcons">
            <div class="rps-icon" id="icon1"></div>
            <div class="rps-icon" id="icon2"></div>
          </div>
        </div>
      </div>
      <button class="start-btn" id="startBtn" onclick="startTournament()">–ù–∞—á–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h2 class="settings-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <div class="settings-actions">
          <button class="equalize-btn" id="equalizeBtn" title="–£—Ä–∞–≤–Ω—è—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏">–£—Ä–∞–≤–Ω—è—Ç—å</button>
          <button class="collapse-btn" id="collapseBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫">
            <span id="collapseIcon">‚ñº</span>
          </button>
        </div>
      </div>

      <div class="names-list-wrapper" id="namesListWrapper">
        <div class="headers-row">
          <div class="header-name">–ò–º—è</div>
          <div class="header-probability">üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
          <div class="header-remove"></div>
        </div>
        <div class="names-list" id="namesList"></div>
      </div>

      <div class="add-name-container">
        <input type="text" class="name-input" id="newNameInput" placeholder="–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫" maxlength="15">
        <button class="add-btn-small" id="addNameBtn" title="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞">‚ûï</button>
      </div>

      <div id="errorMessage" class="error-message"></div>
    </div>
  </div>

  <div class="winner-announcement" id="winnerAnnouncement">
    <h2 id="winnerText"></h2>
  </div>

<script>
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

  const NAMES_KEY = 'shared_names_v1';
  const PROB_KEY = 'shared_probabilities_v2';
  const LOCKED_KEY = 'shared_locked_v1';
  const MAX_PARTICIPANTS = 20;
  const MIN_PROBABILITY = 0.05; // 5%

  let names = ['–î–∏–º–∞','–°–∞—à–∞','–ù–∏–∫–∏—Ç–∞','–ú–∞–∫—Å–∏–º','–ö–∏—Ä–∏–ª–ª','–°–µ–º—ë–Ω'];
  let probabilities = {};
  let lockedParticipants = {};
  let hasCustomProbabilities = false;
  let isLoadingFromStorage = false; // –§–ª–∞–≥ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage

  const namesList = document.getElementById('namesList');
  const newNameInput = document.getElementById('newNameInput');
  const addNameBtn = document.getElementById('addNameBtn');
  const startBtn = document.getElementById('startBtn');
  const errorMessage = document.getElementById('errorMessage');
  const arena = document.getElementById('arena');
  const battleOverlay = document.getElementById('battleOverlay');
  const equalizeBtn = document.getElementById('equalizeBtn');
  const collapseBtn = document.getElementById('collapseBtn');
  const collapseIcon = document.getElementById('collapseIcon');
  const namesListWrapper = document.getElementById('namesListWrapper');

  let tournamentActive = false;

  const defaultNewNamePlaceholder = '–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫';

  function resetNewNamePlaceholder() {
    newNameInput.placeholder = defaultNewNamePlaceholder;

    // –ï—Å–ª–∏ –ø–æ–ª–µ –ø—É—Å—Ç–æ–µ ‚Äî –≤–µ—Ä–Ω—É—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –≤–∏–¥
    if (!newNameInput.value.trim()) {
      newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
      newNameInput.style.background = 'rgba(255,255,255,0.1)';
    }
  }

  newNameInput.addEventListener('focus', resetNewNamePlaceholder);
  newNameInput.addEventListener('click', resetNewNamePlaceholder);

  function showErrorTooltip(message) {
    const existing = document.querySelector('.probability-error-tooltip');
    if (existing) existing.remove();

    const tooltip = document.createElement('div');
    tooltip.className = 'probability-error-tooltip';
    tooltip.textContent = message;
    document.body.appendChild(tooltip);

    setTimeout(() => {
      tooltip.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
      tooltip.style.opacity = '0';
      tooltip.style.transform = 'translate(-50%, -50%) scale(0.8)';
      setTimeout(() => tooltip.remove(), 300);
    }, 2000);
  }


  function clearErrorMessage() {
    if (errorMessage) errorMessage.textContent = '';
  }

  function saveState() {
    try {
      localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      const cleanP = {};
      names.forEach((nm) => cleanP[nm] = probabilities[nm] ?? 0);
      const cleanLocked = {};
      names.forEach((nm) => { if (lockedParticipants[nm]) cleanLocked[nm] = true; });
      localStorage.setItem(PROB_KEY, JSON.stringify({
        probabilities: cleanP,
        hasCustomProbabilities
      }));
      localStorage.setItem(LOCKED_KEY, JSON.stringify(cleanLocked));
    } catch (e) {}
  }

  newNameInput.addEventListener('keydown', (e) => {
    if (newNameInput.value.length >= 15 && 
        !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'].includes(e.key) &&
        !e.ctrlKey && !e.metaKey) {
      
      newNameInput.style.borderColor = '#ef4444';
      newNameInput.style.background = 'rgba(239,68,68,0.1)';
      newNameInput.placeholder = '–ú–∞–∫—Å–∏–º—É–º 15 —Å–∏–º–≤–æ–ª–æ–≤';
      
      setTimeout(() => {
        newNameInput.placeholder = '–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫';
        if (newNameInput.value.trim()) {
          const dup = names.some((n) => n.toLowerCase() === newNameInput.value.trim().toLowerCase());
          if (!dup) {
            newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
            newNameInput.style.background = 'rgba(255,255,255,0.1)';
          }
        } else {
          newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
          newNameInput.style.background = 'rgba(255,255,255,0.1)';
        }
      }, 1500);
    }
  });

  function equalizeProbabilities() {
    const count = Math.max(1, names.length);
    const p = 1 / count;
    probabilities = {};
    lockedParticipants = {};
    hasCustomProbabilities = false;
    names.forEach((n) => {
      probabilities[n] = p;
    });
    saveState();
    renderParticipants();
    validateAllNames();
  }

  function validateAndFixProbabilities() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–µ 5%
    const belowMin = names.filter(n => (probabilities[n] ?? 0) < 0.05);

    if (belowMin.length === 0) {
      // –í—Å—ë –æ–∫, –ø—Ä–æ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
      const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      if (Math.abs(sum - 1) > 1e-4) {
        const k = 1 / sum;
        names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
      }
      return;
    }

    // –ï—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é < 5%
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º 5%
    belowMin.forEach(n => probabilities[n] = 0.05);

    // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ 5%
    const fixedSum = belowMin.length * 0.05;
    const others = names.filter(n => !belowMin.includes(n));

    if (others.length === 0) {
      // –í—Å–µ –±—ã–ª–∏ –Ω–∏–∂–µ 5% - –¥–µ–ª–∞–µ–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
      equalizeProbabilities();
      return;
    }

    // –°—á–∏—Ç–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—É–º–º—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
    const othersSum = others.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
    const remainForOthers = 1 - fixedSum;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –º–æ–∂–µ–º –ª–∏ –º—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏
    if (othersSum > 0) {
      const scale = remainForOthers / othersSum;
      others.forEach(nm => probabilities[nm] = (probabilities[nm] || 0) * scale);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —Å—Ç–∞–ª –ª–∏ –∫—Ç–æ-—Ç–æ –º–µ–Ω—å—à–µ 5% –ø–æ—Å–ª–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
      const stillBelowMin = others.some(nm => (probabilities[nm] ?? 0) < 0.05);

      if (stillBelowMin) {
        // –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        equalizeProbabilities();
      }
    } else {
      // –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–ø–æ—Ä—Ü–∏—è—Ö - —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
      equalizeProbabilities();
    }
  }

  function loadState() {
    isLoadingFromStorage = true;

    // –ò–º–µ–Ω–∞
    try {
      const savedNames = JSON.parse(localStorage.getItem(NAMES_KEY) || '[]');
      if (Array.isArray(savedNames) && savedNames.length) {
        names = savedNames.slice(0, MAX_PARTICIPANTS);
        if (names.length === 1) {
          names.push('–£—á–∞—Å—Ç–Ω–∏–∫ 2');
        }
      } else {
        localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      }
    } catch (e) {}

    // –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    try {
      const saved = JSON.parse(localStorage.getItem(PROB_KEY) || '{}');
      const savedLocked = JSON.parse(localStorage.getItem(LOCKED_KEY) || '{}');

      if (saved?.hasCustomProbabilities && saved?.probabilities && Object.keys(saved.probabilities).length) {
        probabilities = { ...saved.probabilities };
        lockedParticipants = { ...savedLocked };
        hasCustomProbabilities = true;

        // –£–¥–∞–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ names
        Object.keys(probabilities).forEach((n) => { if (!names.includes(n)) delete probabilities[n]; });
        Object.keys(lockedParticipants).forEach((n) => { if (!names.includes(n)) delete lockedParticipants[n]; });

        // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        names.forEach((n) => { if (!(n in probabilities)) probabilities[n] = 0.05; });

        // –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è
        normalizeProbabilities();
      } else {
        equalizeProbabilities();
      }
    } catch (e) {
      equalizeProbabilities();
    }

    isLoadingFromStorage = false;
  }

  function getPercent(name) {
    const n = Math.max(1, names.length);
    if (!(name in probabilities)) {
      return (100 / n).toFixed(1);
    }
    return (probabilities[name] * 100).toFixed(1);
  }

  function getRealisticMaxPercent(name) {
    // –í—Å–µ –¥—Ä—É–≥–∏–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ
    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    // –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ, –∫—Ä–æ–º–µ —Ç–µ–∫—É—â–µ–≥–æ (–æ–Ω –±—É–¥–µ—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –ø—Ä–∏ –≤–≤–æ–¥–µ)
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);

    const otherLockedSum = otherLocked.reduce(
      (s, nm) => s + (probabilities[nm] || 0),
      0
    );

    // –ú–∏–Ω–∏–º—É–º –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö (–ø–æ 5%)
    const minUnlockedTotal = willBeUnlocked.length * 0.05;

    // –°–∫–æ–ª—å–∫–æ –º–∞–∫—Å–∏–º—É–º –º–æ–∂–Ω–æ –æ—Ç–¥–∞—Ç—å —Ç–µ–∫—É—â–µ–º—É, —á—Ç–æ–±—ã –æ—Å—Ç–∞–ª—å–Ω—ã–º —Ö–≤–∞—Ç–∏–ª–æ –Ω–∞ –∏—Ö 5%
    const rawMax = (1 - otherLockedSum - minUnlockedTotal) * 100;

    // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø—Ä–æ–±–ª–µ–º —Å float
    const rounded = Math.round(rawMax * 10) / 10;

    // –û–±—Ä–µ–∑–∞–µ–º –æ—Ç 5 –¥–æ 100, —á—Ç–æ–±—ã –Ω–µ —É—Ö–æ–¥–∏—Ç—å –≤ –±—Ä–µ–¥–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    return Math.max(5, Math.min(100, rounded));
  }

  function normalizeProbabilities() {
    // –ï—Å–ª–∏ –Ω–µ—Ç –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π - –ø—Ä–æ—Å—Ç–æ —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    if (!hasCustomProbabilities) {
      const exact = 1 / (names.length || 1);
      names.forEach((nm) => probabilities[nm] = exact);
      return;
    }

    // –†–∞–∑–¥–µ–ª—è–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏ –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
    const locked = names.filter(n => lockedParticipants[n]);
    const unlocked = names.filter(n => !lockedParticipants[n]);

    // –ï—Å–ª–∏ –≤—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã - –ø—Ä–æ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
    if (unlocked.length === 0) {
      const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      if (sum > 0 && Math.abs(sum - 1) > 1e-4) {
        const k = 1 / sum;
        names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–∏–Ω–∏–º—É–º 5% —Å –±–æ–ª—å—à–µ–π –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å—é
      const hasViolation = names.some(nm => (probabilities[nm] ?? 0) < 0.049);
      if (hasViolation) {
        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å—ë
        equalizeProbabilities();
      }
      return;
    }

    // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
    const lockedSum = locked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–æ–∑–º–æ–∂–Ω–æ –ª–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
    const minUnlockedTotal = unlocked.length * 0.05; // –º–∏–Ω–∏–º—É–º –¥–ª—è –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
    const remainForUnlocked = 1 - lockedSum;

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—É—é –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å –±–æ–ª—å—à–µ–π –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å—é
    const lockedViolation = locked.some(nm => (probabilities[nm] ?? 0) < 0.049);

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å 0.001 (0.1%) –≤–º–µ—Å—Ç–æ 1e-6
    if (lockedViolation || remainForUnlocked < minUnlockedTotal - 0.001 || lockedSum > 1.001) {
      // –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Å–æ–±–ª—é—Å—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ 5% - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–∫—Å–∞—Ü–∏–∏
      equalizeProbabilities();
      return;
    }

    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –ø–æ—Ä–æ–≤–Ω—É –º–µ–∂–¥—É –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏
    const sharePerUnlocked = remainForUnlocked / unlocked.length;
    unlocked.forEach(nm => probabilities[nm] = sharePerUnlocked);

    // –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –º–∏–Ω–∏–º—É–º 5% —Å –±–æ–ª—å—à–µ–π –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å—é
    const finalViolation = names.some(nm => (probabilities[nm] ?? 0) < 0.049);
    if (finalViolation) {
      equalizeProbabilities();
    }
  }

  function setProbabilityManually(name, percentValue) {
    const maxPossible = getRealisticMaxPercent(name);

    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å 0.2 –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å –º–∞–∫—Å–∏–º—É–º–æ–º (–∏–∑-–∑–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è)
    if (isNaN(percentValue) || percentValue < 5 || percentValue > maxPossible + 0.2) {
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${maxPossible.toFixed(1)}%`);
      return false;
    }

    hasCustomProbabilities = true;
    lockedParticipants[name] = true;
    probabilities[name] = percentValue / 100;

    normalizeProbabilities();
    saveState();
    resetNewNamePlaceholder();

    return true;
  }

  function changeProbability(name, delta) {
    const cur = parseFloat(getPercent(name)) || 0;
    const maxPossible = 100 - (names.length - 1) * 5;
    const next = Math.max(5, Math.min(maxPossible, cur + delta));

    // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º/–º–∏–Ω–∏–º—É–º), –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
    if (Math.abs(next - cur) < 0.01) {
      const realisticMax = getRealisticMaxPercent(name);
      if (delta > 0) {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º: ${realisticMax.toFixed(1)}%`);
      } else {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∏–Ω–∏–º—É–º: 5.0%`);
      }
      return;
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –ª–∏ —ç—Ç–æ –∫ –Ω–∞—Ä—É—à–µ–Ω–∏—é –ø—Ä–∞–≤–∏–ª–∞ 5%
    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
    const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
    const newProbForThis = next / 100;
    const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
    const minUnlockedTotal = willBeUnlocked.length * 0.05;

    if (remainForUnlocked < minUnlockedTotal - 0.001) {
      const realisticMax = getRealisticMaxPercent(name);
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
      return;
    }

    setProbabilityManually(name, next);
    renderParticipants();
  }

  function validateProbabilities() {
    if (!names.length) return false;

    let sum = 0;
    for (const n of names) {
      const p = probabilities[n] || 0;
      if (p < MIN_PROBABILITY - 1e-6) {
        showErrorTooltip(
          `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ‚Äî ${(MIN_PROBABILITY * 100).toFixed(1)}%`
        );
        return false;
      }
      sum += p;
    }

    if (Math.abs(sum - 1) > 0.001) {
      showErrorTooltip(
        `–°—É–º–º–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100% (—Å–µ–π—á–∞—Å ${(sum * 100).toFixed(1)}%)`
      );
      return false;
    }

    clearErrorMessage();
    return true;
  }

  function validateAllNames() {
    let allValid = true;
      
    const nameInputs = namesList.querySelectorAll('.name-input');
    nameInputs.forEach(input => {
      const value = input.value.trim();
      if (!value || value.length === 0 || value.length > 15) {
        allValid = false;
      }
    });

    if (startBtn) {
      startBtn.disabled = !allValid || tournamentActive;
    }

    return allValid;
  }


  function removeParticipant(idx) {
    if (names.length <= 2) {
      showErrorTooltip('–ú–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞!');
      return;
    }

    const name = names[idx];
    names.splice(idx, 1);
    delete probabilities[name];
    delete lockedParticipants[name];

    // –ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();
  }

  function addNewParticipant() {
    const newName = newNameInput.value.trim();

    if (!newName) {
      newNameInput.classList.add('error-state');
      newNameInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
      return;
    }

    if (newName.length > 15) {
      showErrorTooltip('–ú–∞–∫—Å–∏–º—É–º 15 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∏');
      return;
    }

    if (names.some((n) => n.toLowerCase() === newName.toLowerCase())) {
      showErrorTooltip('–≠—Ç–æ –∏–º—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!');
      return;
    }

    if (names.length >= MAX_PARTICIPANTS) {
      showErrorTooltip(`–ú–∞–∫—Å–∏–º—É–º ${MAX_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!`);
      return;
    }

    names.push(newName);
    probabilities[newName] = 0.05; // –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å
    // –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ ‚Äî –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏
    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();

    newNameInput.value = '';
    resetNewNamePlaceholder();
    clearErrorMessage();
  }

  if (addNameBtn) {
    addNameBtn.addEventListener('click', addNewParticipant);
  }

  if (equalizeBtn) {
    equalizeBtn.addEventListener('click', equalizeProbabilities);
  }

  if (newNameInput) {
    newNameInput.addEventListener('input', () => {
      const v = newNameInput.value.trim();

      if (!v) {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
        return;
      }

      const dup = names.some((n) => n.toLowerCase() === v.toLowerCase());
      if (dup || v.length > 15) {
        newNameInput.style.borderColor = '#ef4444';
        newNameInput.style.background = 'rgba(239,68,68,0.1)';
        newNameInput.classList.add('error-state');
      } else {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
      }
    });

    newNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addNewParticipant();
      }
    });

    newNameInput.addEventListener('focus', () => {
      resetNewNamePlaceholder();
      newNameInput.style.borderColor = 'rgba(255,255,255,0.5)';
      newNameInput.style.background = 'rgba(255,255,255,0.2)';
      clearErrorMessage();
    });
  }

  function renderParticipants() {
    namesList.innerHTML = '';

    names.forEach((name, idx) => {
      const row = document.createElement('div');
      row.className = 'name-item';

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'name-input';
      input.value = name;
      input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
      input.maxLength = 15;

      input.addEventListener('keydown', (e) => {
        if (
          input.value.length >= 15 &&
          !['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Home','End'].includes(e.key) &&
          !e.ctrlKey && !e.metaKey
        ) {
          showErrorTooltip('–ù–µ –±–æ–ª–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          setTimeout(() => {
            if (input.value.trim() && !names.some((n, i) => i !== idx && n.toLowerCase() === input.value.trim().toLowerCase())) {
              input.style.borderColor = 'rgba(255,255,255,0.2)';
              input.style.background = 'rgba(255,255,255,0.1)';
            }
          }, 1500);
        }
      });

      input.addEventListener('input', () => {
        const v = input.value.trim();

        if (!v) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
        } else {
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
        }

        validateAllNames();
      });

      input.addEventListener('blur', () => {
        const v = input.value.trim();

        if (!v) {
          input.value = name;
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.value = names[idx];
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          showErrorTooltip('–ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤!');
          validateAllNames();
          return;
        }

        const oldName = names[idx];
        if (v !== oldName) {
          names[idx] = v;

          if (probabilities[oldName] !== undefined) {
            probabilities[v] = probabilities[oldName];
            delete probabilities[oldName];
          }

          if (lockedParticipants[oldName]) {
            lockedParticipants[v] = true;
            delete lockedParticipants[oldName];
          }

          saveState();
        }

        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.2)';
        input.style.background = 'rgba(255,255,255,0.1)';
        input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
        validateAllNames();
      });

      input.addEventListener('focus', () => {
        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.5)';
        input.style.background = 'rgba(255,255,255,0.2)';
        clearErrorMessage();
      });

      const probControls = document.createElement('div');
      probControls.className = 'probability-controls';

      const minusBtn = document.createElement('button');
      minusBtn.className = 'prob-btn';
      minusBtn.textContent = '‚àí';
      minusBtn.onclick = () => {
        // –ï—Å–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –µ—ë –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, -1);
      };

      const probInput = document.createElement('input');
      probInput.type = 'text';
      probInput.className = 'probability-input';
      probInput.setAttribute('inputmode', 'decimal');
      probInput.setAttribute('aria-label', '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö');
      probInput.value = getPercent(name);

      // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å manual –¥–ª—è –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
      if (lockedParticipants[name]) {
        probInput.classList.add('manual');
      }

      let lastValid = probInput.value;

      probInput.addEventListener('focus', () => {
        probInput.value = probInput.value.replace('%', '');
        lastValid = probInput.value;
        clearErrorMessage();
      });

      probInput.addEventListener('input', () => {
        probInput.value = probInput.value.replace(',', '.');
        let val = probInput.value.replace('%', '').trim();

        // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥—Ä–æ–±–Ω—É—é —á–∞—Å—Ç—å –¥–æ 2 —Ü–∏—Ñ—Ä
        if (val.includes('.')) {
          const parts = val.split('.');
          if (parts[1] && parts[1].length > 2) {
            val = parts[0] + '.' + parts[1].substring(0, 2);
            probInput.value = val;
          }
        }

        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫—Ä–∞—Å–Ω—ã–º –µ—Å–ª–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        if (val === '') {
          probInput.classList.remove('error');
        } else if (isNaN(num) || num < 5 || num > 100 || num > maxAllowed) {
          probInput.classList.add('error');
        } else {
          probInput.classList.remove('error');
        }
      });

      probInput.addEventListener('blur', () => {
        const val = probInput.value.replace('%', '').trim();
        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        if (val === '' || isNaN(num) || num < 5 || num > maxAllowed) {
          probInput.value = lastValid;
          probInput.classList.remove('error');

          if (!isNaN(num) && (num < 5 || num > maxAllowed)) {
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${maxAllowed.toFixed(1)}%`);
          }
        } else {
          const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
          const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
          const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
          const newProbForThis = num / 100;
          const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
          const minUnlockedTotal = willBeUnlocked.length * 0.05;

          if (remainForUnlocked < minUnlockedTotal - 0.001) {
            probInput.value = lastValid;
            probInput.classList.remove('error');

            const realisticMax = getRealisticMaxPercent(name);
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
          } else if (setProbabilityManually(name, num)) {
            lastValid = getPercent(name);
            renderParticipants();
          } else {
            probInput.value = lastValid;
            probInput.classList.remove('error');
          }
        }
      });

      probInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          probInput.blur();
        }
        if (!/[\d.,]/.test(e.key) && e.key !== 'Enter') e.preventDefault();
      });

      const plusBtn = document.createElement('button');
      plusBtn.className = 'prob-btn';
      plusBtn.textContent = '+';
      plusBtn.onclick = () => {
        // –ï—Å–ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –±—ã–ª–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞, —Ä–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –µ—ë –ø–µ—Ä–µ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–µ–º
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, 1);
      };

      probControls.appendChild(minusBtn);
      probControls.appendChild(probInput);
      probControls.appendChild(plusBtn);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.onclick = () => removeParticipant(idx);

      row.appendChild(input);
      row.appendChild(probControls);
      row.appendChild(removeBtn);

      namesList.appendChild(row);
    });

    validateAllNames();
  }

  // ===== –ö–ù–û–ü–ö–ê "–°–í–ï–†–ù–£–¢–¨" –°–ü–ò–°–ö–ê =====
  let listCollapsed = false;

  if (collapseBtn) {
    collapseBtn.addEventListener('click', () => {
      listCollapsed = !listCollapsed;
      namesListWrapper.classList.toggle('collapsed', listCollapsed);
      collapseIcon.textContent = listCollapsed ? '‚ñ≤' : '‚ñº';
    });
  }

  // ===== DESKTOP MENU =====
  const desktopMenuToggle = document.getElementById('desktopMenuToggle');
  const desktopDropdown = document.getElementById('desktopDropdown');
  let desktopMenuOpen = false;

  function toggleDesktopMenu() {
    desktopMenuOpen = !desktopMenuOpen;
    desktopDropdown.classList.toggle('active', desktopMenuOpen);
    desktopMenuToggle.classList.toggle('active', desktopMenuOpen);
  }

  if (desktopMenuToggle) {
    desktopMenuToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleDesktopMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        desktopMenuOpen &&
        !desktopDropdown.contains(e.target) &&
        !desktopMenuToggle.contains(e.target)
      ) {
        toggleDesktopMenu();
      }
    });
  }

  // ===== BURGER MENU (MOBILE) =====
  const burgerBtn = document.getElementById('burgerBtn');
  const menuDropdown = document.getElementById('menuDropdown');
  let menuOpen = false;

  function toggleMenu() {
    menuOpen = !menuOpen;
    menuDropdown.classList.toggle('active', menuOpen);
    burgerBtn.classList.toggle('active', menuOpen);
  }

  if (burgerBtn) {
    burgerBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        menuOpen &&
        !menuDropdown.contains(e.target) &&
        !burgerBtn.contains(e.target)
      ) {
        toggleMenu();
      }
    });
  }

  // ===== UI LOCKING =====
  function setUILocked(locked) {
    if (startBtn) startBtn.disabled = locked;
    addNameBtn.disabled = locked;
    newNameInput.disabled = locked;
    equalizeBtn.disabled = locked;
    if (collapseBtn) collapseBtn.disabled = locked;

    const allInputs = namesList.querySelectorAll('.name-input, .probability-input');
    const allButtons = namesList.querySelectorAll('.prob-btn, .remove-btn');
      
    allInputs.forEach(input => input.disabled = locked);
    allButtons.forEach(button => button.disabled = locked);
      
    const panel = document.querySelector('.settings-panel');
    if (panel) {
      panel.style.opacity = locked ? '0.5' : '1';
      panel.style.pointerEvents = locked ? 'none' : 'auto';
    }
  }


  // ===== TOURNAMENT LOGIC =====
  let participants = [];

  function startTournament() {
    if (!validateAllNames()) {
      showErrorTooltip('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!');
      return;
    }

    if (!validateProbabilities()) {
      return;
    }

    if (tournamentActive) return;
    tournamentActive = true;
    setUILocked(true);

    const existingParticipants = arena.querySelectorAll('.participant');
    existingParticipants.forEach((p) => p.remove());
    const existingNames = arena.querySelectorAll('.participant-name');
    existingNames.forEach((p) => p.remove());
    const existingSmoke = arena.querySelectorAll('.smoke-effect');
    existingSmoke.forEach((s) => s.remove());

    participants = names.map((name, idx) => {
      const color = `hsl(${(idx * 360) / names.length}, 70%, 60%)`;
      return {
        name,
        color,
        probability: probabilities[name],
        eliminated: false,
        x: 0,
        y: 0,
      };
    });

    runTournament();
  }

  async function runTournament() {
    const winner = selectWinnerByProbability(participants);

    let groups = divideIntoGroups(participants);

    await enterArena(groups);
    await sleep(1500);

    const { fighter1, fighter2 } = selectFightersForBattle(groups, winner);

    if (!fighter1 || !fighter2) {
      tournamentActive = false;
      setUILocked(false);
      return;
    }

    await moveToBattle([fighter1, fighter2], groups);
    await battle(fighter1, fighter2, winner);
    await showFinalWinner(winner);

    tournamentActive = false;
    setUILocked(false);
  }

  function selectWinnerByProbability(participants) {
    const totalProb = participants.reduce((sum, p) => sum + p.probability, 0);
    let random = Math.random() * totalProb;

    for (let p of participants) {
      random -= p.probability;
      if (random <= 0) return p;
    }
    return participants[0];
  }

  function divideIntoGroups(participants) {
    const shuffled = [...participants].sort(() => Math.random() - 0.5);
    const mid = Math.ceil(shuffled.length / 2);
    return [shuffled.slice(0, mid), shuffled.slice(mid)];
  }

  function selectFightersForBattle(groups, winner) {
    const winnerInGroup0 = groups[0].some((p) => p === winner);

    // fighter1 –≤—Å–µ–≥–¥–∞ –∏–∑ –ª–µ–≤–æ–π –≥—Ä—É–ø–ø—ã (–≥—Ä—É–ø–ø–∞ 0), fighter2 –∏–∑ –ø—Ä–∞–≤–æ–π (–≥—Ä—É–ø–ø–∞ 1)
    let fighter1, fighter2;

    if (winnerInGroup0) {
      fighter1 = winner;
      fighter2 = groups[1][Math.floor(Math.random() * groups[1].length)];
    } else {
      fighter1 = groups[0][Math.floor(Math.random() * groups[0].length)];
      fighter2 = winner;
    }

    return { fighter1, fighter2 };
  }

  async function enterArena(groups) {
    const arenaRect = arena.getBoundingClientRect();
    const leftX = arenaRect.width * 0.15;
    const rightX = arenaRect.width * 0.85;
    const centerY = arenaRect.height / 2;
    const spacing = Math.min(
      60,
      arenaRect.height / (Math.max(groups[0].length, groups[1].length) + 1)
    );

    groups[0].forEach((p, idx) => {
      p.x = leftX;
      // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ª–∏–Ω–∏—é: –≤—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–∫–∞ –±—ã–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
      const totalHeight = (groups[0].length - 1) * spacing;
      p.y = centerY - totalHeight / 2 + idx * spacing;
      createParticipantElement(p, idx * 150);
    });

    groups[1].forEach((p, idx) => {
      p.x = rightX;
      // –¶–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –ª–∏–Ω–∏—é: –≤—ã—á–∏—Å–ª—è–µ–º —Å–º–µ—â–µ–Ω–∏–µ —Ç–∞–∫, —á—Ç–æ–±—ã —Å—Ä–µ–¥–Ω—è—è —Ç–æ—á–∫–∞ –±—ã–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É
      const totalHeight = (groups[1].length - 1) * spacing;
      p.y = centerY - totalHeight / 2 + idx * spacing;
      createParticipantElement(p, idx * 150);
    });

    await sleep(Math.max(groups[0].length, groups[1].length) * 150 + 1000);
  }

  function createParticipantElement(p, delay = 0) {
    const smoke = document.createElement('div');
    smoke.className = 'smoke-effect';
    smoke.style.left = p.x - 40 + 'px';
    smoke.style.top = p.y - 40 + 'px';
    smoke.style.animationDelay = delay + 'ms';
    arena.appendChild(smoke);

    setTimeout(() => {
      smoke.remove();
    }, delay + 1500);

    const el = document.createElement('div');
    el.className = 'participant';
    el.style.backgroundColor = p.color;
    el.style.color = p.color;
    el.style.left = p.x - 15 + 'px';
    el.style.top = p.y - 15 + 'px';
    el.style.animationDelay = delay + 'ms';
    el.dataset.name = p.name;

    const nameEl = document.createElement('div');
    nameEl.className = 'participant-name';
    nameEl.textContent = p.name;
    nameEl.style.left = p.x + 'px';
    nameEl.style.top = p.y + 'px';
    nameEl.style.animationDelay = delay + 500 + 'ms';

    arena.appendChild(el);
    arena.appendChild(nameEl);

    p.element = el;
    p.nameElement = nameEl;
  }

  async function moveToBattle(fighters, groups) {
    const arenaRect = arena.getBoundingClientRect();
    const centerX = arenaRect.width / 2;
    const centerY = arenaRect.height / 2;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, –∫ –∫–∞–∫–æ–π –≥—Ä—É–ø–ø–µ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –∫–∞–∂–¥—ã–π –±–æ–µ—Ü
    const fighter1InGroup0 = groups[0].includes(fighters[0]);
    const fighter2InGroup0 = groups[0].includes(fighters[1]);

    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–µ—Ä–≤–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    fighters[0].x = centerX - 80;
    fighters[0].y = centerY;
    fighters[0].element.style.animation = 'none';
    fighters[0].nameElement.style.animation = 'none';
    fighters[0].element.style.opacity = '1';
    fighters[0].nameElement.style.opacity = '1';
    fighters[0].element.style.transform = 'scale(1.5)';
    fighters[0].element.style.transition = 'all 1.5s ease-out';
    fighters[0].nameElement.style.fontSize = '18px';
    fighters[0].nameElement.style.fontWeight = '900';
    fighters[0].nameElement.style.transition = 'all 1.5s ease-out';

    fighters[0].element.style.left = fighters[0].x - 15 + 'px';
    fighters[0].element.style.top = fighters[0].y - 15 + 'px';
    fighters[0].nameElement.style.left = fighters[0].x + 'px';
    fighters[0].nameElement.style.top = fighters[0].y + 'px';

    // –°–¥–≤–∏–≥–∞–µ–º –≥—Ä—É–ø–ø—É –ø–µ—Ä–≤–æ–≥–æ –±–æ–π—Ü–∞ –Ω–∞–∑–∞–¥ –∏ –¥–µ–ª–∞–µ–º —Å–µ—Ä–æ–π
    const group1 = fighter1InGroup0 ? groups[0] : groups[1];
    const newX1 = fighter1InGroup0 ? arenaRect.width * 0.05 : arenaRect.width * 0.95;

    group1.forEach(p => {
      if (p !== fighters[0]) {
        p.element.classList.add('inactive');
        p.nameElement.classList.add('inactive');
        p.element.style.transition = 'all 1.0s ease-out';
        p.nameElement.style.transition = 'all 1.0s ease-out';
        p.x = newX1;
        p.element.style.left = (p.x - 15) + 'px';
        p.nameElement.style.left = p.x + 'px';
      }
    });

    // –ù–∞–¥–ø–∏—Å—å "–§–ò–ù–ê–õ–ò–°–¢ 1: –∏–º—è" –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–≤–∞–ª–æ–≤
    const finalist1Label = document.createElement('div');
    finalist1Label.style.position = 'absolute';
    finalist1Label.style.top = '15%';
    finalist1Label.style.left = '50%';
    finalist1Label.style.transform = 'translate(-50%, -50%) scale(0)';
    finalist1Label.style.fontSize = '28px';
    finalist1Label.style.fontWeight = '900';
    finalist1Label.style.color = '#ffd700';
    finalist1Label.style.textAlign = 'center';
    finalist1Label.style.textShadow = '0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
    finalist1Label.style.zIndex = '200';
    finalist1Label.style.animation = 'winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
    finalist1Label.innerHTML = `–§–ò–ù–ê–õ–ò–°–¢ 1: <span style="color: #fff;">${fighters[0].name}</span>`;
    arena.appendChild(finalist1Label);

    await sleep(2000);

    finalist1Label.style.transition = 'all 0.5s ease-out';
    finalist1Label.style.transform = 'translate(-50%, -50%) scale(0)';
    finalist1Label.style.opacity = '0';
    setTimeout(() => finalist1Label.remove(), 500);

    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –≤—Ç–æ—Ä–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
    fighters[1].x = centerX + 80;
    fighters[1].y = centerY;
    fighters[1].element.style.animation = 'none';
    fighters[1].nameElement.style.animation = 'none';
    fighters[1].element.style.opacity = '1';
    fighters[1].nameElement.style.opacity = '1';
    fighters[1].element.style.transform = 'scale(1.5)';
    fighters[1].element.style.transition = 'all 1.5s ease-out';
    fighters[1].nameElement.style.fontSize = '18px';
    fighters[1].nameElement.style.fontWeight = '900';
    fighters[1].nameElement.style.transition = 'all 1.5s ease-out';

    fighters[1].element.style.left = fighters[1].x - 15 + 'px';
    fighters[1].element.style.top = fighters[1].y - 15 + 'px';
    fighters[1].nameElement.style.left = fighters[1].x + 'px';
    fighters[1].nameElement.style.top = fighters[1].y + 'px';

    // –°–¥–≤–∏–≥–∞–µ–º –≥—Ä—É–ø–ø—É –≤—Ç–æ—Ä–æ–≥–æ –±–æ–π—Ü–∞ –Ω–∞–∑–∞–¥ –∏ –¥–µ–ª–∞–µ–º —Å–µ—Ä–æ–π
    const group2 = fighter2InGroup0 ? groups[0] : groups[1];
    const newX2 = fighter2InGroup0 ? arenaRect.width * 0.05 : arenaRect.width * 0.95;

    group2.forEach(p => {
      if (p !== fighters[1]) {
        p.element.classList.add('inactive');
        p.nameElement.classList.add('inactive');
        p.element.style.transition = 'all 1.0s ease-out';
        p.nameElement.style.transition = 'all 1.0s ease-out';
        p.x = newX2;
        p.element.style.left = (p.x - 15) + 'px';
        p.nameElement.style.left = p.x + 'px';
      }
    });

    await sleep(500);

    // –ù–∞–¥–ø–∏—Å—å "–§–ò–ù–ê–õ–ò–°–¢ 2: –∏–º—è" –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–≤–∞–ª–æ–≤
    const finalist2Label = document.createElement('div');
    finalist2Label.style.position = 'absolute';
    finalist2Label.style.top = '15%';
    finalist2Label.style.left = '50%';
    finalist2Label.style.transform = 'translate(-50%, -50%) scale(0)';
    finalist2Label.style.fontSize = '28px';
    finalist2Label.style.fontWeight = '900';
    finalist2Label.style.color = '#ffd700';
    finalist2Label.style.textAlign = 'center';
    finalist2Label.style.textShadow = '0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
    finalist2Label.style.zIndex = '200';
    finalist2Label.style.animation = 'winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
    finalist2Label.innerHTML = `–§–ò–ù–ê–õ–ò–°–¢ 2: <span style="color: #fff;">${fighters[1].name}</span>`;
    arena.appendChild(finalist2Label);

    await sleep(2000);

    finalist2Label.style.transition = 'all 0.5s ease-out';
    finalist2Label.style.transform = 'translate(-50%, -50%) scale(0)';
    finalist2Label.style.opacity = '0';
    setTimeout(() => finalist2Label.remove(), 500);

    await sleep(500);
  }

  async function battle(fighter1, fighter2, predeterminedWinner) {
    battleOverlay.classList.add('active');

    const participantsEl = document.getElementById('battleParticipants');
    participantsEl.innerHTML = `
      <div class="battle-participant-pill" style="border-color:${fighter1.color}; box-shadow:0 0 20px ${fighter1.color}55;">
        <span class="battle-name-text">${fighter1.name}</span>
      </div>
      <div class="battle-vs">VS</div>
      <div class="battle-participant-pill" style="border-color:${fighter2.color}; box-shadow:0 0 20px ${fighter2.color}55;">
        <span class="battle-name-text">${fighter2.name}</span>
      </div>
    `;

    // –ù–∞–¥–ø–∏—Å—å –æ –∏–≥—Ä–µ –ø–µ—Ä–µ–¥ –æ–±—Ä–∞—Ç–Ω—ã–º –æ—Ç—Å—á–µ—Ç–æ–º
    const gameAnnouncement = document.createElement('div');
    gameAnnouncement.style.position = 'absolute';
    gameAnnouncement.style.top = '70%';
    gameAnnouncement.style.left = '50%';
    gameAnnouncement.style.transform = 'translate(-50%, -50%) scale(0)';
    gameAnnouncement.style.fontSize = '24px';
    gameAnnouncement.style.fontWeight = '900';
    gameAnnouncement.style.color = '#ffd700';
    gameAnnouncement.style.textAlign = 'center';
    gameAnnouncement.style.textShadow = '0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
    gameAnnouncement.style.zIndex = '200';
    gameAnnouncement.style.padding = '12px 24px';
    gameAnnouncement.style.borderRadius = '15px';
    gameAnnouncement.style.background = 'rgba(0,0,0,0.5)';
    gameAnnouncement.style.border = '2px solid rgba(255,215,0,0.5)';
    gameAnnouncement.style.animation = 'winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
    gameAnnouncement.textContent = '–ò–ì–†–ê –í –§–ò–ù–ê–õ–ï: –ö–ê–ú–ï–ù–¨-–ù–û–ñ–ù–ò–¶–´-–ë–£–ú–ê–ì–ê';
    battleOverlay.appendChild(gameAnnouncement);

    await sleep(3000);

    gameAnnouncement.style.transition = 'all 0.5s ease-out';
    gameAnnouncement.style.transform = 'translate(-50%, -50%) scale(0)';
    gameAnnouncement.style.opacity = '0';
    setTimeout(() => gameAnnouncement.remove(), 500);

    await sleep(500);

    const choices = ['‚úä', '‚úã', '‚úåÔ∏è'];

    let choice1, choice2;

    do {
      choice1 = choices[Math.floor(Math.random() * 3)];
      choice2 = choices[Math.floor(Math.random() * 3)];

      let rpsWinner = null;
      if (choice1 === choice2) {
        continue;
      } else if (
        (choice1 === '‚úä' && choice2 === '‚úåÔ∏è') ||
        (choice1 === '‚úåÔ∏è' && choice2 === '‚úã') ||
        (choice1 === '‚úã' && choice2 === '‚úä')
      ) {
        rpsWinner = fighter1;
      } else {
        rpsWinner = fighter2;
      }

      if (rpsWinner === predeterminedWinner) {
        break;
      }
    } while (true);

    const icon1 = document.getElementById('icon1');
    const icon2 = document.getElementById('icon2');

    icon1.textContent = '‚úä';
    icon2.textContent = '‚úä';
    icon1.classList.add('shaking');
    icon2.classList.add('shaking');

    const countdown = document.createElement('div');
    countdown.style.position = 'absolute';
    countdown.style.bottom = '15%';
    countdown.style.left = '50%';
    countdown.style.transform = 'translate(-50%, 50%)';
    countdown.style.fontSize = '52px';
    countdown.style.padding = '8px 24px';
    countdown.style.borderRadius = '999px';
    countdown.style.background = 'rgba(0,0,0,0.35)';
    countdown.style.border = '2px solid rgba(255,255,255,0.4)';
    countdown.style.fontWeight = '900';
    countdown.style.color = '#fff';
    countdown.style.textShadow =
      '0 0 20px rgba(255,255,255,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
    countdown.style.zIndex = '150';
    battleOverlay.appendChild(countdown);

    countdown.textContent = '3';
    await sleep(1000);

    countdown.textContent = '2';
    await sleep(1000);

    countdown.textContent = '1';
    await sleep(1000);

    countdown.remove();

    icon1.classList.remove('shaking');
    icon2.classList.remove('shaking');
    icon1.textContent = choice1;
    icon2.textContent = choice2;
    icon1.classList.add('show');
    icon2.classList.add('show');

    await sleep(1500);

    if (predeterminedWinner === fighter1) {
      icon1.classList.add('winner');
    } else {
      icon2.classList.add('winner');
    }

    await sleep(1000);

    // –°—Ä–∞–∑—É –Ω–∞—á–∏–Ω–∞–µ–º –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Ü–µ–Ω—Ç—Ä –∏ —Å–∫—Ä—ã–≤–∞—Ç—å –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö
    const loser = predeterminedWinner === fighter1 ? fighter2 : fighter1;

    // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Ü–µ–Ω—Ç—Ä
    const arenaRect = arena.getBoundingClientRect();
    const centerX = arenaRect.width / 2;
    const centerY = arenaRect.height / 2;

    predeterminedWinner.x = centerX;
    predeterminedWinner.y = centerY;
    predeterminedWinner.element.style.transition = 'all 1.5s ease-out';
    predeterminedWinner.element.style.left = (centerX - 15) + 'px';
    predeterminedWinner.element.style.top = (centerY - 15) + 'px';
    predeterminedWinner.element.style.transform = 'scale(2)';

    predeterminedWinner.nameElement.style.transition = 'all 1.5s ease-out';
    predeterminedWinner.nameElement.style.left = centerX + 'px';
    predeterminedWinner.nameElement.style.top = (centerY - 60) + 'px';
    predeterminedWinner.nameElement.style.transform = 'translateX(-50%)';
    predeterminedWinner.nameElement.style.fontSize = '24px';

    await sleep(1500);

    icon1.classList.remove('show', 'winner', 'shaking');
    icon2.classList.remove('show', 'winner', 'shaking');
    battleOverlay.classList.remove('active');
  }

  function createConfetti() {
    const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#f7dc6f', '#bb8fce', '#85c1e2'];
    const confettiCount = 150;

    for (let i = 0; i < confettiCount; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * window.innerWidth + 'px';
        confetti.style.top = '-10px';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animation = `confettiFall ${3 + Math.random() * 2}s linear forwards`;
        confetti.style.animationDelay = Math.random() * 0.5 + 's';
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 6000);
      }, i * 15);
    }
  }

  function createCelebrationEmojis() {
    const emojis = ['üéâ', 'üéä', 'üåü', '‚ú®', 'üî•', 'üí´', '‚≠ê', 'üèÜ', 'üëë', 'üí™'];
    const count = 20;

    for (let i = 0; i < count; i++) {
      setTimeout(() => {
        const emoji = document.createElement('div');
        emoji.className = 'celebration-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = (Math.random() * 100) + '%';
        emoji.style.top = (Math.random() * 100) + '%';
        emoji.style.animationDelay = (Math.random() * 0.5) + 's';
        document.body.appendChild(emoji);
        setTimeout(() => emoji.remove(), 3500);
      }, i * 100);
    }
  }

  function createCelebrationWords() {
    const words = [
      '–í–ê–£', '–ß–ï–ú–ü–ò–û–ù', '–ú–û–õ–û–î–ï–¶', '–ö–†–ê–°–ê–í–ê', '–õ–ï–ì–ï–ù–î–ê', '–í–ü–ï–†–Å–î', '–¢–û–ü–ß–ò–ö', '–ü–û–ë–ï–î–ê',
      '–û–ì–û–ù–¨', '–¢–´ –õ–£–ß–®–ò–ô', '–î–ê–í–ê–ô –ï–©–Å', '–ù–ï–í–ï–†–û–Ø–¢–ù–û', '–°–£–ü–ï–†',
      '–ù–ê–î–û –ñ–ï –ö–¢–û –í–´–ü–ê–õ', '–ö–†–ê–°–ê–í–ß–ò–ö', '–ú–ê–°–¢–ï–†', '–ì–ï–ù–ò–ô', '–ë–û–°–°', '–ö–¢–û –ë–´ –ú–û–ì –ü–û–î–£–ú–ê–¢–¨',
      '–≠–ü–ò–ß–ù–û', '–ë–†–ê–í–û', '–ì–ì', '–†–ï–°–ü–ï–ö–¢', '–®–ò–ö–ê–†–ù–û', '–ò–ú–ë–ê', '–ö–†–£–¢–Ø–ö', '–ú–û–©–ù–û'
    ];

    const gridCols = 4;
    const gridRows = 3;
    const positions = [];

    for (let row = 0; row < gridRows; row++) {
      for (let col = 0; col < gridCols; col++) {
        positions.push({
          left: (col * (100 / gridCols)) + (100 / gridCols / 2),
          top: (row * (100 / gridRows)) + (100 / gridRows / 2)
        });
      }
    }

    positions.sort(() => Math.random() - 0.5);

    const wordsToShow = 12;

    for (let i = 0; i < wordsToShow; i++) {
      setTimeout(() => {
        const word = document.createElement('div');
        word.className = 'celebration-word';
        word.textContent = words[Math.floor(Math.random() * words.length)];

        const pos = positions[i % positions.length];
        word.style.left = (pos.left + (Math.random() - 0.5) * 10) + '%';
        word.style.top = (pos.top + (Math.random() - 0.5) * 10) + '%';
        word.style.animationDelay = (Math.random() * 0.3) + 's';

        document.body.appendChild(word);
        setTimeout(() => word.remove(), 4500);
      }, i * 120);
    }
  }

  async function showFinalWinner(winner) {
    // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å —É–∂–µ –≤ —Ü–µ–Ω—Ç—Ä–µ –±–ª–∞–≥–æ–¥–∞—Ä—è battle(), –ø—Ä–æ—Å—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏–µ
    const winnerEl = document.getElementById('winnerAnnouncement');
    const winnerText = document.getElementById('winnerText');
    winnerText.innerHTML = `
      <span class="winner-emoji">üéâ</span>
      <span class="winner-name">${winner.name}</span>
      <span class="winner-emoji">üéâ</span>
    `;

    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫—Ä–æ–º–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ü–†–ò –æ–±—ä—è–≤–ª–µ–Ω–∏–∏
    participants.forEach((p) => {
      if (p !== winner && p.element) {
        p.element.style.transition = 'opacity 1.5s ease-out';
        p.element.style.opacity = '0';
        if (p.nameElement) {
          p.nameElement.style.transition = 'opacity 1.5s ease-out';
          p.nameElement.style.opacity = '0';
        }
      }
    });

    winnerEl.classList.add('show');

    createConfetti();
    createCelebrationEmojis();
    createCelebrationWords();

    await sleep(5000);

    winnerEl.classList.remove('show');

    // –£–¥–∞–ª—è–µ–º —Å–∫—Ä—ã—Ç—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    participants.forEach((p) => {
      if (p !== winner) {
        if (p.element) p.element.remove();
        if (p.nameElement) p.nameElement.remove();
      }
    });
  }

  function sleep(ms) {
    return new Promise((resolve) => setTimeout(resolve, ms));
  }

  // ===== INITIALIZATION =====
  loadState();
  renderParticipants();
  validateProbabilities();

  // –î–µ–ª–∞–µ–º startTournament –≥–ª–æ–±–∞–ª—å–Ω–æ–π –¥–ª—è onclick –≤ HTML
  window.startTournament = startTournament;

  // ===== WINDOW HELPERS =====
  // –§—É–Ω–∫—Ü–∏–∏-–æ–±–µ—Ä—Ç–∫–∏ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
  function lockProbabilityInputs() {
    setUILocked(true);
  }

  function unlockProbabilityInputs() {
    setUILocked(false);
  }

  // –≠–∫—Å–ø–æ—Ä—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Ç—É—Ä–Ω–∏—Ä–∞ –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å –¥—Ä—É–≥–∏–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
  window.tournamentState = {
    get names() { return names.slice(); },
    get probabilities() { return { ...probabilities }; },
    lockProbabilityInputs,
    unlockProbabilityInputs,
    setTournamentRunning(isRunning) {
      tournamentActive = !!isRunning;
      validateAllNames();
    }
  };
</script>

<div class="winner-announcement" id="winnerAnnouncement">
  <h2 id="winnerText"></h2>
</div>

</body>
</html>
