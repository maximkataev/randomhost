<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>–¢—É—Ä–Ω–∏—Ä "–ß–µ—Å—Ç–Ω–∞—è –∂–µ—Ä–µ–±—å—ë–≤–∫–∞"</title>
  <meta name="description" content="–ù–∞–±–ª—é–¥–∞–π –∑–∞ —ç–ø–∏—á–Ω—ã–º —Ç—É—Ä–Ω–∏—Ä–æ–º! –£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞ –ø–æ —á–µ—Å—Ç–Ω—ã–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <link rel="canonical" href="https://randomhost.online/tournament.html">

  <!-- Open Graph -->
  <meta property="og:locale" content="ru_RU">
  <meta property="og:type" content="website">
  <meta property="og:title" content="–¢—É—Ä–Ω–∏—Ä &quot;–ß–µ—Å—Ç–Ω–∞—è –∂–µ—Ä–µ–±—å—ë–≤–∫–∞&quot;">
  <meta property="og:description" content="–£—á–∞—Å—Ç–Ω–∏–∫–∏ —Å—Ä–∞–∂–∞—é—Ç—Å—è –≤ –∫–∞–º–µ–Ω—å-–Ω–æ–∂–Ω–∏—Ü—ã-–±—É–º–∞–≥–∞. –ß–µ—Å—Ç–Ω—ã–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏, —ç–ø–∏—á–Ω—ã–µ –ø–æ–±–µ–¥—ã.">
  <meta property="og:url" content="https://randomhost.online/tournament.html">
  <meta property="og:site_name" content="–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä-–∏–≥—Ä—ã">

  <!-- Icons -->
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/2694.svg" type="image/svg+xml">
  <meta name="theme-color" content="#764ba2">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      touch-action: manipulation;
    }

    /* ===== DESKTOP –ú–ï–ù–Æ ===== */
    .top-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .desktop-menu-toggle {
      position: relative;
      background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow:
        0 4px 15px rgba(0,0,0,0.3),
        0 0 0 0 rgba(255,255,255,0.4);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
    }

    .desktop-menu-toggle::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2, #667eea);
      background-size: 200% 200%;
      animation: gradientSpin 3s ease infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    @keyframes gradientSpin {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .desktop-menu-toggle:hover::before {
      opacity: 1;
    }

    .desktop-menu-toggle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow:
        0 8px 25px rgba(0,0,0,0.4),
        0 0 0 8px rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
    }

    .desktop-menu-toggle:active {
      transform: translateY(-1px) scale(0.98);
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 18px;
      position: relative;
      transition: transform 0.3s ease;
    }

    .menu-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background: #fff;
      border-radius: 2px;
      position: absolute;
      left: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .menu-icon span:nth-child(1) {
      top: 0;
    }

    .menu-icon span:nth-child(2) {
      top: 50%;
      margin-top: -1.5px;
    }

    .menu-icon span:nth-child(3) {
      bottom: 0;
    }

    .desktop-menu-toggle:hover .menu-icon {
      transform: scale(1.1);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(1) {
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(45deg);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(2) {
      opacity: 0;
      transform: rotate(180deg) scale(0);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(3) {
      bottom: auto;
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(-45deg);
    }

    .desktop-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 15px;
      background: linear-gradient(135deg, rgba(15,15,35,0.98), rgba(30,20,50,0.98));
      backdrop-filter: blur(20px);
      border-radius: 16px;
      box-shadow:
        0 10px 40px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.1) inset;
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(-10px);
      transition:
        max-height 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55),
        opacity 0.3s ease,
        transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      min-width: 240px;
    }

    .desktop-dropdown.active {
      max-height: 600px;
      opacity: 1;
      transform: translateY(0);
    }

    .desktop-dropdown a {
      position: relative;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .desktop-dropdown a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      transform: translateX(-4px);
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(102,126,234,0.2), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .desktop-dropdown a:last-child {
      border-bottom: none;
    }

    .desktop-dropdown a:hover {
      background: rgba(102,126,234,0.15);
      padding-left: 24px;
      color: #ffd43b;
      text-shadow: 0 0 10px rgba(255,212,59,0.5);
    }

    .desktop-dropdown a:hover::before {
      transform: translateX(0);
    }

    .desktop-dropdown a:hover::after {
      opacity: 1;
    }

    .desktop-dropdown a:active {
      background: rgba(118,75,162,0.3);
      transform: scale(0.98);
    }

    .desktop-dropdown a span:first-child {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a:hover span:first-child {
      transform: scale(1.2) rotate(10deg);
    }

    /* ===== MOBILE –ú–ï–ù–Æ (–°–ö–†–´–¢–û –ü–û –î–ï–§–û–õ–¢–£ –ù–ê DESKTOP) ===== */
    .menu-container {
      display: none;
    }

    /* ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ===== */
    .main-container {
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      align-items: center;
      max-width: 1200px;
      width: 100%;
    }

    .game-container {
      flex: 1;
      text-align: center;
      perspective: 1000px;
      position: relative;
    }

.arena {
  width: 100%;
  height: 600px;
  position: relative;
  border-radius: 24px;
  overflow: hidden;
  border: 3px solid rgba(255,255,255,0.15);
  box-shadow:
    0 12px 40px rgba(0,0,0,0.5),
    0 0 40px rgba(102,126,234,0.35);
  background:
    radial-gradient(circle at 50% 0%, rgba(255,255,255,0.08), transparent 60%),
    radial-gradient(circle at 0% 100%, rgba(0,255,255,0.08), transparent 55%),
    radial-gradient(circle at 100% 100%, rgba(255,0,255,0.08), transparent 55%),
    linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px),
    linear-gradient(180deg, rgba(255,255,255,0.04) 1px, transparent 1px),
    #0b1020;
  background-size:
    100% 100%,
    100% 100%,
    100% 100%,
    48px 48px,
    48px 48px,
    auto;
}

.arena::before {
  content: '';
  position: absolute;
  inset: 24px;
  border-radius: 20px;
  border: 2px solid rgba(255,255,255,0.08);
  box-shadow: 0 0 30px rgba(0,0,0,0.7) inset;
  pointer-events: none;
}

.arena::after {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  width: 3px;
  height: 100%;
  transform: translateX(-50%);
  background: linear-gradient(
    180deg,
    rgba(255,255,255,0) 0%,
    rgba(255,255,255,0.35) 20%,
    rgba(255,255,255,0.35) 80%,
    rgba(255,255,255,0) 100%
  );
  opacity: 0.45;
  pointer-events: none;
}



    .settings-panel {
      width: 450px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .settings-title {
      color: #fff;
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .settings-actions {
      display: flex;
      gap: 8px;
    }

    .equalize-btn, .collapse-btn {
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(102,126,234,0.8), rgba(118,75,162,0.8));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
    }

    .collapse-btn {
      display: none;
    }

    .equalize-btn:hover, .collapse-btn:hover {
      background: linear-gradient(135deg, rgba(118,75,162,1), rgba(102,126,234,1));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      border-color: rgba(255,255,255,0.5);
    }

    .equalize-btn:active, .collapse-btn:active {
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .names-list-wrapper {
      transition: max-height 0.3s ease;
    }

    .names-list-wrapper.collapsed {
      max-height: 0;
      overflow: hidden;
    }

    .names-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-height: 500px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-right: 5px;
    }
    .names-list::-webkit-scrollbar {
      display: none;
    }

    .headers-row {
      display: flex;
      align-items: center;
      gap: 0px;
      margin-bottom: 10px;
      padding: 0 5px;
    }

    .header-name {
      flex: 1;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: left;
    }

    .header-probability {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      width: 120px;
      flex-shrink: 0;
    }

    .header-remove {
      width: 44px;
    }

    .name-item {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .name-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      transition: 0.3s;
    }
    .name-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.2);
    }
    .name-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .name-input.error-state {
      border-color: #ef4444 !important;
      background: rgba(239,68,68,0.1) !important;
    }

    .name-input.error-state::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .probability-controls {
      display: flex;
      gap: 5px;
      width: 120px;
      flex-shrink: 0;
    }

    .prob-btn {
      padding: 5px 10px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .prob-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .prob-btn:active {
      transform: scale(0.95);
    }

    .probability-input {
      width: 55px;
      padding: 4px;
      background: rgba(255,255,255,0.1);
      color: #ffd43b;
      border: 2px solid rgba(255,212,59,0.3);
      border-radius: 5px;
      text-align: center;
      font-weight: 800;
      font-size: 14px;
      transition: 0.2s;
      flex-shrink: 0;
    }

    /* –£–±–∏—Ä–∞–µ–º —Å—Ç—Ä–µ–ª–æ—á–∫–∏ –∏–∑ number input */
    .probability-input::-webkit-outer-spin-button,
    .probability-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .probability-input[type=number] {
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .probability-input.error {
      border-color: #ef4444;
      background: rgba(239,68,68,0.2);
    }

    .probability-input.manual {
      background: rgba(255,244,204,0.25);
      border-color: #F59E0B;
      box-shadow: 0 0 0 3px rgba(245,158,11,0.25);
    }

    .prob-btn,
    .remove-btn,
    .add-btn-small {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .equalize-btn {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .prob-btn:hover,
    .remove-btn:hover,
    .add-btn-small:hover,
    .equalize-btn:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    .probability-input:focus {
      outline: none;
      border-color: rgba(255,212,59,0.6);
      background: rgba(255,255,255,0.15);
    }

    .remove-btn {
      padding: 8px 12px;
      background: rgba(239,68,68,0.2);
      color: #fff;
      border: 2px solid rgba(239,68,68,0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      transition: 0.2s;
      width: 44px;
      flex-shrink: 0;
    }

    .remove-btn:hover {
      background: rgba(239,68,68,0.4);
      border-color: rgba(239,68,68,0.5);
      transform: scale(1.05);
    }

    .remove-btn:active {
      transform: scale(0.95);
    }

    .add-name-container {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .add-btn-small {
      padding: 10px 15px;
      background: rgba(34,197,94,0.7);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 20px;
      transition: 0.3s;
    }
    .add-btn-small:hover {
      background: rgba(34,197,94,0.9);
      transform: scale(1.1);
    }

    .add-btn-small:active {
      transform: scale(0.95);
    }

    .start-btn {
      width: auto;
      min-width: 200px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 800;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      margin-top: 20px;
    }

    .start-btn:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .start-btn:hover:not(:disabled):before {
      width: 300px;
      height: 300px;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .start-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:disabled,
    input:disabled {
      opacity: 0.5;
      cursor: not-allowed !important;
    }

    .error-message {
      display: none !important;
    }

    /* ===== ARENA ELEMENTS ===== */
    .participant {
      position: absolute;
      width: 30px;
      height: 30px;
      border-radius: 50%;
      transition: all 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      box-shadow: 0 0 20px currentColor;
      opacity: 0;
      transform: scale(0);
      animation: smokeAppear 1.2s ease-out forwards;
    }

    @keyframes smokeAppear {
      0% {
        opacity: 0;
        transform: scale(0) translateY(50px);
        filter: blur(10px);
      }
      50% {
        opacity: 0.5;
        filter: blur(5px);
      }
      100% {
        opacity: 1;
        transform: scale(1) translateY(0);
        filter: blur(0);
      }
    }

    .smoke-effect {
      position: absolute;
      width: 80px;
      height: 80px;
      background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, transparent 70%);
      border-radius: 50%;
      pointer-events: none;
      animation: smokeExpand 1.5s ease-out forwards;
      z-index: 1;
    }

    @keyframes smokeExpand {
      0% {
        transform: scale(0);
        opacity: 0.8;
      }
      100% {
        transform: scale(3);
        opacity: 0;
      }
    }

    .participant-name {
      position: absolute;
      color: #fff;
      font-size: 14px;
      font-weight: 700;
      white-space: nowrap;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
      pointer-events: none;
      transform: translate(-50%, calc(-100% - 10px));
      opacity: 0;
      animation: nameAppear 1s ease-out 0.5s forwards;
    }

    @keyframes nameAppear {
      from {
        opacity: 0;
        transform: translate(-50%, calc(-100% - 5px));
      }
      to {
        opacity: 1;
        transform: translate(-50%, calc(-100% - 10px));
      }
    }

    .battle-overlay {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
    }

    .battle-overlay.active {
      display: flex;
    }

    .rps-icons {
      display: flex;
      gap: 60px;
      margin-bottom: 40px;
    }

    .rps-icon {
      font-size: 120px;
      opacity: 0;
      transform: scale(0);
      transition: all 0.4s ease;
    }

    .rps-icon:first-child {
      transform: rotate(90deg) scale(0);
    }

    .rps-icon:last-child {
      transform: rotate(-90deg) scale(0);
    }

    .rps-icon.shaking {
      opacity: 1;
      animation: shake 0.3s ease-in-out infinite;
    }

    @keyframes shake {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      25% { transform: translateY(-15px) rotate(-10deg); }
      50% { transform: translateY(-5px) rotate(0deg); }
      75% { transform: translateY(-15px) rotate(10deg); }
    }

    .rps-icon:first-child.shaking {
      animation: shakeLeft 0.3s ease-in-out infinite;
    }

    .rps-icon:last-child.shaking {
      animation: shakeRight 0.3s ease-in-out infinite;
    }

    @keyframes shakeLeft {
      0%, 100% { transform: translateY(0) rotate(85deg); }
      25% { transform: translateY(-15px) rotate(80deg); }
      50% { transform: translateY(-5px) rotate(90deg); }
      75% { transform: translateY(-15px) rotate(100deg); }
    }

    @keyframes shakeRight {
      0%, 100% { transform: translateY(0) rotate(-85deg); }
      25% { transform: translateY(-15px) rotate(-80deg); }
      50% { transform: translateY(-5px) rotate(-90deg); }
      75% { transform: translateY(-15px) rotate(-100deg); }
    }

    .rps-icon.show {
      opacity: 1;
      animation: none;
    }

    .rps-icon:first-child.show {
      transform: rotate(90deg) scale(1);
    }

    .rps-icon:last-child.show {
      transform: rotate(-90deg) scale(1);
    }

    .rps-icon.winner {
      filter: drop-shadow(0 0 30px rgba(255,215,0,0.8));
      animation: pulse 0.5s ease-in-out;
    }

    .rps-icon:first-child.winner {
      transform: rotate(90deg) scale(1.3);
    }

    .rps-icon:last-child.winner {
      transform: rotate(-90deg) scale(1.3);
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1.3); }
      50% { transform: scale(1.5); }
    }

    .rps-icon:first-child.winner {
      animation: pulseLeft 0.5s ease-in-out;
    }

    .rps-icon:last-child.winner {
      animation: pulseRight 0.5s ease-in-out;
    }

    @keyframes pulseLeft {
      0%, 100% { transform: rotate(90deg) scale(1.3); }
      50% { transform: rotate(90deg) scale(1.5); }
    }

    @keyframes pulseRight {
      0%, 100% { transform: rotate(-90deg) scale(1.3); }
      50% { transform: rotate(-90deg) scale(1.5); }
    }

    .battle-participants {
      display: flex;
      gap: 80px;
      margin-bottom: 40px;
      font-size: 24px;
      color: #fff;
      font-weight: 700;
    }

    .battle-participant-pill {
    padding: 10px 18px;
    border-radius: 999px;
    border: 2px solid rgba(255,255,255,0.4);
    background: radial-gradient(circle at 0% 0%, rgba(255,255,255,0.18), transparent 55%);
    box-shadow: 0 6px 18px rgba(0,0,0,0.45);
    min-width: 140px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    backdrop-filter: blur(6px);
    }

    .battle-name-text {
    text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
    }

    .battle-vs {
    font-size: 24px;
    font-weight: 900;
    color: #ffd43b;
    text-shadow:
        0 0 12px rgba(255,212,59,0.9),
        0 0 24px rgba(255,212,59,0.6);
}

    .winner-announcement {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95));
      padding: 40px 60px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      z-index: 1001;
      display: none;
      text-align: center;
    }

    .winner-announcement.show {
      display: block;
      animation: winnerAppear 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes winnerAppear {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    }

    .winner-announcement h2 {
      color: #fff;
      font-size: 36px;
      margin: 0;
      text-align: center;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      line-height: 1.2;
    }

    .winner-name {
      display: block;
      margin: 8px 0 0;
      font-size: 1.4em;
      letter-spacing: 0.03em;
    }

    .winner-emoji {
      font-size: 1.2em;
    }

    /* ===== CONFETTI & CELEBRATION ===== */
    .confetti {
      position: fixed;
      width: 10px;
      height: 10px;
      pointer-events: none;
      z-index: 2000;
    }

    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotate(720deg);
        opacity: 0;
      }
    }

    .celebration-word {
      position: fixed;
      font-size: 48px;
      font-weight: 900;
      color: #ffd700;
      text-shadow:
        0 0 10px rgba(255,215,0,0.8),
        0 0 20px rgba(255,215,0,0.6),
        0 0 30px rgba(255,215,0,0.4),
        3px 3px 6px rgba(0,0,0,0.5);
      pointer-events: none;
      z-index: 2000;
      animation: celebrationFloat 3s ease-out forwards;
      opacity: 0;
    }

    @keyframes celebrationFloat {
      0% {
        opacity: 0;
        transform: scale(0.5) translateY(0) rotate(-10deg);
      }
      20% {
        opacity: 1;
        transform: scale(1.2) translateY(-30px) rotate(5deg);
      }
      80% {
        opacity: 0.8;
      }
      100% {
        opacity: 0;
        transform: scale(0.8) translateY(-200px) rotate(15deg);
      }
    }

    .champion-trophy {
      font-size: 80px;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation: trophyAppear 1s ease-out forwards;
      filter: drop-shadow(0 0 20px rgba(255,215,0,0.8));
    }

    @keyframes trophyAppear {
      0% {
        transform: translate(-50%, -50%) scale(0) rotate(-180deg);
        opacity: 0;
      }
      60% {
        transform: translate(-50%, -50%) scale(1.2) rotate(10deg);
      }
      100% {
        transform: translate(-50%, -50%) scale(1) rotate(0deg);
        opacity: 1;
      }
    }

    .spotlight {
      position: absolute;
      width: 300px;
      height: 300px;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255,255,255,0.3), transparent);
      pointer-events: none;
      animation: spotlightPulse 2s ease-in-out infinite;
    }

    @keyframes spotlightPulse {
      0%, 100% {
        opacity: 0.6;
        transform: scale(1);
      }
      50% {
        opacity: 0.9;
        transform: scale(1.1);
      }
    }

    .finalist-label {
      position: absolute;
      top: -60px;
      left: 50%;
      transform: translateX(-50%);
      background: linear-gradient(135deg, #ffd700, #ffed4e);
      color: #1a1a2e;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: 1px;
      box-shadow: 0 4px 15px rgba(255,215,0,0.5);
      animation: labelGlow 2s ease-in-out infinite;
      white-space: nowrap;
    }

    @keyframes labelGlow {
      0%, 100% {
        box-shadow: 0 4px 15px rgba(255,215,0,0.5);
      }
      50% {
        box-shadow: 0 4px 25px rgba(255,215,0,0.9);
      }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }

      .settings-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-container {
        width: 100%;
      }
    }

    @media (max-width: 918px) {
      html, body {
        max-width: 100%;
        overflow-x: hidden;
      }
      body {
        padding: calc(66px + var(--safe-top)) var(--safe-right) calc(20px + var(--safe-bottom)) var(--safe-left);
      }

      /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –±—É—Ä–≥–µ—Ä-–º–µ–Ω—é, —Å–∫—Ä—ã–≤–∞–µ–º –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ */
      .top-buttons {
        display: none;
      }

      .menu-container {
        display: block;
        position: fixed;
        top: var(--safe-top);
        left: var(--safe-left);
        right: var(--safe-right);
        z-index: 1000;
        padding: 12px 16px;
        background: linear-gradient(180deg, rgba(102,126,234,0.95) 0%, rgba(118,75,162,0.85) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .menu-title {
        color: #fff;
        font-size: 18px;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .burger-btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 4px;
        transition: all 0.3s ease;
      }

      .burger-btn:hover {
        background: rgba(255,255,255,0.3);
      }

      .burger-btn span {
        display: block;
        width: 24px;
        height: 3px;
        background: #fff;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .burger-btn.active span:nth-child(1) {
        transform: rotate(45deg) translateY(7px);
      }

      .burger-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .burger-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translateY(-7px);
      }

      .menu-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, rgba(102,126,234,0.98) 0%, rgba(118,75,162,0.98) 100%);
        backdrop-filter: blur(10px);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .menu-dropdown.active {
        max-height: 500px;
      }

      .menu-dropdown a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        transition: background 0.2s;
      }

      .menu-dropdown a:last-child {
        border-bottom: none;
      }

      .menu-dropdown a:hover {
        background: rgba(255,255,255,0.15);
      }

      .menu-dropdown a:active {
        background: rgba(255,255,255,0.25);
      }

      /* –ú–æ–±–∏–ª—å–Ω–∞—è —Ä–∞—Å–∫–ª–∞–¥–∫–∞ */
      .main-container {
        flex-direction: column;
        gap: 20px;
      }

      .collapse-btn {
        display: block;
      }

      .arena {
        height: 400px;
      }

      .rps-icon {
        font-size: 80px;
      }

      .battle-participants {
        font-size: 18px;
        gap: 40px;
      }

      .winner-announcement {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>
  <!-- Desktop Menu -->
  <!-- DESKTOP –ú–ï–ù–Æ -->
  <div class="top-buttons">
    <button class="desktop-menu-toggle" id="desktopMenuToggle" aria-label="–ú–µ–Ω—é">
      <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    <nav class="desktop-dropdown" id="desktopDropdown">
      <a href="/"><span>üè†</span> –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html"><span>üé°</span> –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html"><span>üé±</span> –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html"><span>üîÆ</span> –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html"><span>üéØ</span> –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html"><span>üèÅ</span> –ì–æ–Ω–∫–∏</a>
      <a href="trading.html"><span>üìà</span> –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html"><span>‚öîÔ∏è</span> –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <!-- MOBILE –ú–ï–ù–Æ -->
  <div class="menu-container">
    <div class="menu-header">
      <button class="burger-btn" id="burgerBtn" aria-label="–ú–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="menu-dropdown" id="menuDropdown">
      <a href="/">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html">üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html">üé± –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html">üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html">üéØ –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html">üèÅ –ì–æ–Ω–∫–∏</a>
      <a href="trading.html">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <div class="main-container">
    <!-- Game Container -->
    <div class="game-container">
      <div class="arena" id="arena">
        <!-- Battle Overlay -->
        <div class="battle-overlay" id="battleOverlay">
          <div class="battle-participants" id="battleParticipants"></div>
          <div class="rps-icons" id="rpsIcons">
            <div class="rps-icon" id="icon1"></div>
            <div class="rps-icon" id="icon2"></div>
          </div>
        </div>
      </div>
      <button class="start-btn" id="startBtn" onclick="startTournament()">–ù–∞—á–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä</button>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h2 class="settings-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <div class="settings-actions">
          <button class="equalize-btn" id="equalizeBtn" title="–£—Ä–∞–≤–Ω—è—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏">–£—Ä–∞–≤–Ω—è—Ç—å</button>
          <button class="collapse-btn" id="collapseBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫">
            <span id="collapseIcon">‚ñº</span>
          </button>
        </div>
      </div>

      <div class="names-list-wrapper" id="namesListWrapper">
        <div class="headers-row">
          <div class="header-name">–ò–º—è</div>
          <div class="header-probability">üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
          <div class="header-remove"></div>
        </div>
        <div class="names-list" id="namesList"></div>
      </div>

      <div class="add-name-container">
        <input type="text" class="name-input" id="newNameInput" placeholder="–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫" maxlength="15">
        <button class="add-btn-small" id="addNameBtn" title="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞">‚ûï</button>
      </div>

      <div id="errorMessage" class="error-message" style="display:none;"></div>
    </div>
  </div>

  <div class="winner-announcement" id="winnerAnnouncement">
    <h2 id="winnerText"></h2>
  </div>

  <script>
    const NAMES_KEY = 'tournament_names';
    const PROB_KEY = 'tournament_probabilities';
    const LOCKED_KEY = 'tournament_locked';
    const MAX_PARTICIPANTS = 20;
    const MIN_PROBABILITY = 0.05;

    const namesList = document.getElementById('namesList');
    const newNameInput = document.getElementById('newNameInput');
    const addNameBtn = document.getElementById('addNameBtn');
    const startBtn = document.getElementById('startBtn');
    const errorMessage = document.getElementById('errorMessage');
    const arena = document.getElementById('arena');
    const battleOverlay = document.getElementById('battleOverlay');
    const equalizeBtn = document.getElementById('equalizeBtn');
    const collapseBtn = document.getElementById('collapseBtn');
    const collapseIcon = document.getElementById('collapseIcon');
    const namesListWrapper = document.getElementById('namesListWrapper');

    let names = ['–£—á–∞—Å—Ç–Ω–∏–∫ 1', '–£—á–∞—Å—Ç–Ω–∏–∫ 2'];
    let probabilities = {};
    let lockedParticipants = {};
    let hasCustomProbabilities = false;
    let isLoadingFromStorage = false;

    const defaultNewNamePlaceholder = '–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫';

    function resetNewNamePlaceholder() {
      newNameInput.placeholder = defaultNewNamePlaceholder;
      newNameInput.classList.remove('error-state');
    }

    function showErrorInPlaceholder(msg) {
      newNameInput.placeholder = msg;
      newNameInput.classList.add('error-state');
      setTimeout(() => resetNewNamePlaceholder(), 3000);
    }

    // ===== –ó–ê–ì–†–£–ó–ö–ê –ò–ú–Å–ù =====
    try {
      const saved = JSON.parse(localStorage.getItem(NAMES_KEY) || '[]');
      if (Array.isArray(saved) && saved.length) {
        names = saved;

        // –í–∞–ª–∏–¥–∞—Ü–∏—è 1: –ï—Å–ª–∏ 1 —É—á–∞—Å—Ç–Ω–∏–∫ - –¥–æ–±–∞–≤–ª—è–µ–º –≤—Ç–æ—Ä–æ–≥–æ
        if (names.length === 1) {
          names.push('–£—á–∞—Å—Ç–Ω–∏–∫ 2');
        }

        // –í–∞–ª–∏–¥–∞—Ü–∏—è 2: –ï—Å–ª–∏ –±–æ–ª–µ–µ 20 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ - –±–µ—Ä—ë–º –ø–µ—Ä–≤—ã—Ö 20
        if (names.length > MAX_PARTICIPANTS) {
          names = names.slice(0, MAX_PARTICIPANTS);
        }

        names.forEach((n) => {
          if (!(n in probabilities)) {
            probabilities[n] = MIN_PROBABILITY;
          }
        });
      } else {
        localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      }
    } catch(e) {}

    const saveNames = () => {
      try {
        localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      } catch(e) {}
    };

    // ===== –ó–ê–ì–†–£–ó–ö–ê –í–ï–†–û–Ø–¢–ù–û–°–¢–ï–ô =====
    function loadProbabilities() {
      isLoadingFromStorage = true;

      try {
        const saved = JSON.parse(localStorage.getItem(PROB_KEY) || '{}');
        const savedLocked = JSON.parse(localStorage.getItem(LOCKED_KEY) || '{}');

        if (saved?.hasCustomProbabilities && saved?.probabilities && Object.keys(saved.probabilities).length) {
          probabilities = { ...saved.probabilities };
          lockedParticipants = { ...savedLocked };
          hasCustomProbabilities = true;

          // –£–¥–∞–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –≤ names
          Object.keys(probabilities).forEach((n) => { if (!names.includes(n)) delete probabilities[n]; });
          Object.keys(lockedParticipants).forEach((n) => { if (!names.includes(n)) delete lockedParticipants[n]; });

          // –î–æ–±–∞–≤–ª—è–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (–µ—Å–ª–∏ –±—ã–ª–∏ –æ–±—Ä–µ–∑–∞–Ω—ã –¥–æ 20)
          names.forEach((n) => { if (!(n in probabilities)) probabilities[n] = MIN_PROBABILITY; });

          // –í–∞–ª–∏–¥–∞—Ü–∏—è 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –º–µ–Ω–µ–µ 5%
          validateAndFixProbabilities();
        } else {
          setEqualProbabilities();
        }
      } catch(e) {
        setEqualProbabilities();
      }

      isLoadingFromStorage = false;
    }

    function validateAndFixProbabilities() {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –º–µ–Ω–µ–µ 5%
      const belowMin = names.filter(n => (probabilities[n] ?? 0) < MIN_PROBABILITY);

      if (belowMin.length === 0) {
        // –í—Å—ë –æ–∫, –ø—Ä–æ—Å—Ç–æ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ–º
        const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
        if (Math.abs(sum - 1) > 1e-4) {
          const k = 1 / sum;
          names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
        }
        return;
      }

      // –ï—Å—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∏ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é < 5%
      // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º 5%
      belowMin.forEach(n => probabilities[n] = MIN_PROBABILITY);

      // –°—á–∏—Ç–∞–µ–º —Å—É–º–º—É –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –Ω–∞ 5%
      const fixedSum = belowMin.length * MIN_PROBABILITY;
      const others = names.filter(n => !belowMin.includes(n));

      if (others.length === 0) {
        // –í—Å–µ –±—ã–ª–∏ –Ω–∏–∂–µ 5% - –¥–µ–ª–∞–µ–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        setEqualProbabilities();
        return;
      }

      // –°—á–∏—Ç–∞–µ–º —Ç–µ–∫—É—â—É—é —Å—É–º–º—É –æ—Å—Ç–∞–ª—å–Ω—ã—Ö
      const othersSum = others.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      const remainForOthers = 1 - fixedSum;

      if (othersSum <= 0 || remainForOthers <= 0) {
        setEqualProbabilities();
        return;
      }

      // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –æ—Å—Ç–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–ø–æ—Ä—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
      const k = remainForOthers / othersSum;
      others.forEach(nm => probabilities[nm] = (probabilities[nm] || 0) * k);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø–æ–ª—É—á–∏–ª–∏—Å—å –ª–∏ —Å–Ω–æ–≤–∞ –∑–Ω–∞—á–µ–Ω–∏—è –Ω–∏–∂–µ 5%
      const stillBelowMin = others.filter(nm => probabilities[nm] < MIN_PROBABILITY);
      if (stillBelowMin.length > 0) {
        // –ï—Å–ª–∏ –¥–∞ - –¥–µ–ª–∞–µ–º —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        setEqualProbabilities();
      }
    }

    function setEqualProbabilities() {
      const p = 1 / (names.length || 1);
      probabilities = {};
      names.forEach((nm) => probabilities[nm] = p);
      lockedParticipants = {};
      hasCustomProbabilities = false;

      if (!isLoadingFromStorage) {
        saveProbabilities();
      }
    }

    function equalizeProbabilities() {
      setEqualProbabilities();
      renderParticipants();
    }

    function saveProbabilities() {
      try {
        const cleanP = {};
        names.forEach((nm) => { cleanP[nm] = probabilities[nm] ?? MIN_PROBABILITY; });

        const cleanLocked = {};
        names.forEach((nm) => { if (lockedParticipants[nm]) cleanLocked[nm] = true; });

        localStorage.setItem(PROB_KEY, JSON.stringify({
          probabilities: cleanP,
          hasCustomProbabilities
        }));
        localStorage.setItem(LOCKED_KEY, JSON.stringify(cleanLocked));
      } catch(_) {}
    }

    function validateAllNames() {
      let allValid = true;

      const nameInputs = namesList.querySelectorAll('.name-input');
      nameInputs.forEach(input => {
        const value = input.value.trim();
        if (!value || value.length === 0 || input.value.length > 15) {
          allValid = false;
        }
      });

      startBtn.disabled = !allValid || tournamentActive;

      return allValid;
    }

    function validateProbabilities() {
      const sum = names.reduce((s, n) => s + (probabilities[n] || 0), 0);

      if (Math.abs(sum - 1) > 0.001) {
        showErrorInPlaceholder(`–°—É–º–º–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100% (—Å–µ–π—á–∞—Å ${(sum * 100).toFixed(1)}%)`);
        return false;
      }

      for (let name of names) {
        if ((probabilities[name] || 0) < MIN_PROBABILITY) {
          showErrorInPlaceholder(`–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ‚Äî ${MIN_PROBABILITY * 100}%`);
          return false;
        }
      }

      return true;
    }

    function getProbabilityPercent(name) {
      if (!hasCustomProbabilities && names.length) return (100 / names.length).toFixed(1);
      return (((probabilities[name] || 0) * 100).toFixed(1));
    }

    function getRealisticMaxPercent(name) {
      const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
      const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);

      const otherLockedSum = otherLocked.reduce(
        (s, nm) => s + (probabilities[nm] || 0),
        0
      );

      const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;
      const rawMax = (1 - otherLockedSum - minUnlockedTotal) * 100;

      // –û–±—Ä–µ–∑–∞–µ–º –æ—Ç MIN –¥–æ 100
      return Math.max(MIN_PROBABILITY * 100, Math.min(100, rawMax));
    }

    function normalizeProbabilities() {
      const unlocked = names.filter(n => !lockedParticipants[n]);
      if (unlocked.length === 0) return;

      const lockedSum = names.filter(n => lockedParticipants[n])
        .reduce((s, n) => s + (probabilities[n] || 0), 0);
      const remaining = 1 - lockedSum;

      if (remaining < 0.001) {
        unlocked.forEach(n => { probabilities[n] = MIN_PROBABILITY; });
        return;
      }

      const perUnlocked = remaining / unlocked.length;
      unlocked.forEach(n => {
        probabilities[n] = Math.max(MIN_PROBABILITY, perUnlocked);
      });
    }

    function changeProbability(name, delta) {
      const cur = parseFloat(getProbabilityPercent(name)) || 0;
      const maxPossible = 100 - (names.length - 1) * (MIN_PROBABILITY * 100);
      const next = Math.max(MIN_PROBABILITY * 100, Math.min(maxPossible, cur + delta));

      // –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å (–¥–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º/–º–∏–Ω–∏–º—É–º), –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º
      if (Math.abs(next - cur) < 0.01) {
        return;
      }

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –ø—Ä–∏–≤–µ–¥—ë—Ç –ª–∏ —ç—Ç–æ –∫ –Ω–∞—Ä—É—à–µ–Ω–∏—é –ø—Ä–∞–≤–∏–ª–∞ MIN%
      const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
      const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
      const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      const newProbForThis = next / 100;
      const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
      const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;

      // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å 0.001 (0.1%)
      if (remainForUnlocked < minUnlockedTotal - 0.001) {
        const realisticMax = getRealisticMaxPercent(name);
        showErrorInPlaceholder(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
        return;
      }

      setProbabilityManual(name, next);
      renderParticipants();
    }

    function setProbabilityManual(name, percentValue) {
      const maxPossible = getRealisticMaxPercent(name);

      if (isNaN(percentValue) || percentValue < MIN_PROBABILITY * 100 || percentValue > maxPossible) {
        showErrorInPlaceholder(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${maxPossible.toFixed(1)}%`);
        return false;
      }

      hasCustomProbabilities = true;
      lockedParticipants[name] = true;
      probabilities[name] = percentValue / 100;

      normalizeProbabilities();
      saveProbabilities();

      return true;
    }

    function removeParticipant(idx) {
      if (names.length <= 2) {
        showErrorInPlaceholder('–ú–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞!');
        return;
      }

      const name = names[idx];
      names.splice(idx, 1);
      delete probabilities[name];
      delete lockedParticipants[name];

      saveNames();
      normalizeProbabilities();
      saveProbabilities();

      renderParticipants();
      validateProbabilities();
    }

    function addNewParticipant() {
      const newName = newNameInput.value.trim();

      if (!newName) {
        newNameInput.classList.add('error-state');
        newNameInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
        return;
      }

      if (names.includes(newName)) {
        showErrorInPlaceholder('–≠—Ç–æ –∏–º—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!');
        return;
      }

      if (names.length >= MAX_PARTICIPANTS) {
        showErrorInPlaceholder(`–ú–∞–∫—Å–∏–º—É–º ${MAX_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!`);
        return;
      }

      names.push(newName);

      // –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –≤—Å–µ–≥–¥–∞ –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –∏ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ–ª—é –æ—Ç –Ω–µ–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö
      if (!hasCustomProbabilities) {
        // –†–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
        const equal = 1 / names.length;
        names.forEach(nm => probabilities[nm] = equal);
      } else {
        // –î–∞—ë–º –Ω–æ–≤–æ–º—É —É—á–∞—Å—Ç–Ω–∏–∫—É –≤—Ä–µ–º–µ–Ω–Ω—É—é –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (–±—É–¥–µ—Ç –ø–µ—Ä–µ—Å—á–∏—Ç–∞–Ω–∞ –≤ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏)
        probabilities[newName] = MIN_PROBABILITY;
      }

      normalizeProbabilities();

      saveNames();
      saveProbabilities();
      renderParticipants();
      validateProbabilities();

      newNameInput.value = '';
      resetNewNamePlaceholder();
    }

    // Event listeners
    if (addNameBtn) {
      addNameBtn.addEventListener('click', addNewParticipant);
    }

    if (newNameInput) {
      newNameInput.addEventListener('input', () => {
        const v = newNameInput.value.trim();

        if (!v || v.length === 0) {
          newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
          newNameInput.style.background = 'rgba(255,255,255,0.1)';
          newNameInput.classList.remove('error-state');
          return;
        }

        const dup = names.some((n) => n.toLowerCase() === v.toLowerCase());
        if (dup) {
          newNameInput.style.borderColor = '#ef4444';
          newNameInput.style.background = 'rgba(239,68,68,0.1)';
          newNameInput.classList.add('error-state');
        } else {
          newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
          newNameInput.style.background = 'rgba(255,255,255,0.1)';
          newNameInput.classList.remove('error-state');
        }
      });

      newNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          addNewParticipant();
        }
      });

      newNameInput.addEventListener('focus', () => {
        resetNewNamePlaceholder();
        newNameInput.style.borderColor = 'rgba(255,255,255,0.5)';
        newNameInput.style.background = 'rgba(255,255,255,0.2)';
      });
    }

    if (equalizeBtn) {
      equalizeBtn.addEventListener('click', equalizeProbabilities);
    }

    // Collapse functionality
    let listCollapsed = false;

    if (collapseBtn) {
      collapseBtn.addEventListener('click', () => {
        listCollapsed = !listCollapsed;
        namesListWrapper.classList.toggle('collapsed', listCollapsed);
        collapseIcon.textContent = listCollapsed ? '‚ñ≤' : '‚ñº';
      });
    }

    function renderParticipants() {
      namesList.innerHTML = '';

      names.forEach((name, idx) => {
        const row = document.createElement('div');
        row.className = 'name-item';

        const input = document.createElement('input');
        input.type = 'text';
        input.className = 'name-input';
        input.value = name;
        input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';

        input.addEventListener('input', () => {
          input.value = input.value.replace(/\s+/g, '');
          const v = input.value.trim();

          if (!v || v.length === 0) {
            input.classList.add('error-state');
            input.style.borderColor = '#ef4444';
            input.style.background = 'rgba(239,68,68,0.1)';

            const oldName = names[idx];
            if (oldName in probabilities) {
              probabilities[''] = probabilities[oldName];
              delete probabilities[oldName];
            }
            if (oldName in lockedParticipants) {
              lockedParticipants[''] = lockedParticipants[oldName];
              delete lockedParticipants[oldName];
            }

            names[idx] = '';
            validateAllNames();
            return;
          }

          const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
          if (dup) {
            input.classList.add('error-state');
            input.style.borderColor = '#ef4444';
            input.style.background = 'rgba(239,68,68,0.1)';
            validateAllNames();
            return;
          }

          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';

          const oldName = names[idx];
          if (v !== oldName) {
            names[idx] = v;

            if (probabilities[oldName] !== undefined) {
              probabilities[v] = probabilities[oldName];
              delete probabilities[oldName];
            }
            if (lockedParticipants[oldName]) {
              lockedParticipants[v] = true;
              delete lockedParticipants[oldName];
            }

            saveNames();
            saveProbabilities();
          }

          validateAllNames();
        });

        input.addEventListener('blur', () => {
          const v = input.value.trim();

          if (!v || v.length === 0) {
            input.value = '';
            input.classList.add('error-state');
            input.style.borderColor = '#ef4444';
            input.style.background = 'rgba(239,68,68,0.1)';
            input.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
            validateAllNames();
            return;
          }

          const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
          if (dup) {
            input.value = names[idx];
            input.classList.remove('error-state');
            input.style.borderColor = 'rgba(255,255,255,0.2)';
            input.style.background = 'rgba(255,255,255,0.1)';
            showErrorInPlaceholder('–ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏!');
            validateAllNames();
            return;
          }

          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
          validateAllNames();
        });

        input.addEventListener('focus', () => {
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.5)';
          input.style.background = 'rgba(255,255,255,0.2)';
        });

        const probControls = document.createElement('div');
        probControls.className = 'probability-controls';

        const minusBtn = document.createElement('button');
        minusBtn.className = 'prob-btn';
        minusBtn.textContent = '‚àí';
        minusBtn.onclick = () => changeProbability(name, -1);

        const probInput = document.createElement('input');
        probInput.type = 'text';                      
        probInput.className = 'probability-input';
        probInput.setAttribute('inputmode', 'decimal');
        probInput.value = getProbabilityPercent(name);

        probInput.setAttribute('aria-label', '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö');
        if (lockedParticipants[name]) {
          probInput.classList.add('manual');
        }
        let lastValid = probInput.value;

        probInput.addEventListener('focus', () => {
          probInput.value = probInput.value.replace('%', '');
          lastValid = probInput.value;
        });

        probInput.addEventListener('input', () => {
          // –ó–∞–º–µ–Ω—è–µ–º –∑–∞–ø—è—Ç—É—é –Ω–∞ —Ç–æ—á–∫—É –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞
          probInput.value = probInput.value.replace(',', '.');

          const val = probInput.value.replace('%', '').trim();
          const num = parseFloat(val);
          const maxAllowed = getRealisticMaxPercent(name);

          if (val === '' || (num >= MIN_PROBABILITY * 100 && num <= maxAllowed)) {
            probInput.classList.remove('error');
          } else {
            probInput.classList.add('error');
          }
        });

        probInput.addEventListener('blur', () => {
          const val = probInput.value.replace('%', '').trim();
          const num = parseFloat(val);
          const maxAllowed = getRealisticMaxPercent(name);

          if (val === '' || isNaN(num) || num < MIN_PROBABILITY * 100 || num > maxAllowed) {
            probInput.value = lastValid;
            probInput.classList.remove('error');

            if (!isNaN(num) && (num < MIN_PROBABILITY * 100 || num > maxAllowed)) {
              showErrorInPlaceholder(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${maxAllowed.toFixed(1)}%`);
            }
          } else {
            const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
            const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
            const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
            const newProbForThis = num / 100;
            const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
            const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;

            if (remainForUnlocked < minUnlockedTotal - 0.001) {
              probInput.value = lastValid;
              probInput.classList.remove('error');

              const realisticMax = getRealisticMaxPercent(name);
              showErrorInPlaceholder(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
            } else if (setProbabilityManual(name, num)) {
              lastValid = getProbabilityPercent(name);
              renderParticipants();
            } else {
              probInput.value = lastValid;
              probInput.classList.remove('error');
            }
          }
        });

        probInput.addEventListener('keypress', (e) => {
          if (e.key === 'Enter') {
            e.preventDefault();
            probInput.blur();
          }
          if (!/[\d.]/.test(e.key) && e.key !== 'Enter') e.preventDefault();
        });

        const plusBtn = document.createElement('button');
        plusBtn.className = 'prob-btn';
        plusBtn.textContent = '+';
        plusBtn.onclick = () => changeProbability(name, 1);

        probControls.appendChild(minusBtn);
        probControls.appendChild(probInput);
        probControls.appendChild(plusBtn);

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-btn';
        removeBtn.textContent = '‚úï';
        removeBtn.onclick = () => removeParticipant(idx);

        row.appendChild(input);
        row.appendChild(probControls);
        row.appendChild(removeBtn);

        namesList.appendChild(row);
      });

      validateAllNames();
    }


    // ===== DESKTOP MENU =====
    const desktopMenuToggle = document.getElementById('desktopMenuToggle');
    const desktopDropdown = document.getElementById('desktopDropdown');
    let desktopMenuOpen = false;

    function toggleDesktopMenu() {
      desktopMenuOpen = !desktopMenuOpen;
      desktopDropdown.classList.toggle('active', desktopMenuOpen);
      desktopMenuToggle.classList.toggle('active', desktopMenuOpen);
    }

    if (desktopMenuToggle) {
      desktopMenuToggle.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDesktopMenu();
      });

      document.addEventListener('click', (e) => {
        if (desktopMenuOpen && !desktopDropdown.contains(e.target) && !desktopMenuToggle.contains(e.target)) {
          toggleDesktopMenu();
        }
      });
    }

    // ===== BURGER MENU (MOBILE) =====
    const burgerBtn = document.getElementById('burgerBtn');
    const menuDropdown = document.getElementById('menuDropdown');
    let menuOpen = false;

    function toggleMenu() {
      menuOpen = !menuOpen;
      menuDropdown.classList.toggle('active', menuOpen);
      burgerBtn.classList.toggle('active', menuOpen);
    }

    if (burgerBtn) {
      burgerBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleMenu();
      });

      document.addEventListener('click', (e) => {
        if (menuOpen && !menuDropdown.contains(e.target) && !burgerBtn.contains(e.target)) {
          toggleMenu();
        }
      });
    }

    // ===== UI LOCKING =====
    function setUILocked(locked) {
      startBtn.disabled = locked;
      addNameBtn.disabled = locked;
      newNameInput.disabled = locked;
      equalizeBtn.disabled = locked;
      if (collapseBtn) collapseBtn.disabled = locked;

      const allInputs = namesList.querySelectorAll('.name-input, .probability-input');
      const allButtons = namesList.querySelectorAll('.prob-btn, .remove-btn');

      allInputs.forEach(input => input.disabled = locked);
      allButtons.forEach(button => button.disabled = locked);

      if (locked) {
        document.querySelector('.settings-panel').style.opacity = '0.5';
        document.querySelector('.settings-panel').style.pointerEvents = 'none';
      } else {
        document.querySelector('.settings-panel').style.opacity = '1';
        document.querySelector('.settings-panel').style.pointerEvents = 'auto';
      }
    }

    // ===== TOURNAMENT LOGIC =====
    let participants = [];
    let tournamentActive = false;

    function startTournament() {
      if (!validateAllNames()) {
        showErrorInPlaceholder('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!');
        return;
      }

      if (!validateProbabilities()) {
        return;
      }

      if (tournamentActive) return;
      tournamentActive = true;
      setUILocked(true);

      // Clear arena completely (participants, names, and smoke effects)
      const existingParticipants = arena.querySelectorAll('.participant');
      existingParticipants.forEach(p => p.remove());
      const existingNames = arena.querySelectorAll('.participant-name');
      existingNames.forEach(p => p.remove());
      const existingSmoke = arena.querySelectorAll('.smoke-effect');
      existingSmoke.forEach(s => s.remove());

      // Create participants
      participants = names.map((name, idx) => {
        const color = `hsl(${(idx * 360) / names.length}, 70%, 60%)`;
        return {
          name,
          color,
          probability: probabilities[name],
          eliminated: false,
          x: 0,
          y: 0
        };
      });

      // Animate tournament
      runTournament();
    }

    async function runTournament() {
      console.log('\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
      console.log('üèÜ –°–¢–ê–†–¢ –¢–£–†–ù–ò–†–ê');
      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n');

      console.log('–í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏:');
      participants.forEach(p => {
        console.log(`  - ${p.name}: ${(p.probability * 100).toFixed(1)}%`);
      });
      const totalProbability = participants.reduce((sum, p) => sum + p.probability, 0);
      console.log(`\n–°—É–º–º–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π: ${(totalProbability * 100).toFixed(1)}%`);
      console.log('');

      // –®–ê–ì 1: –°—Ä–∞–∑—É –≤—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º (—Ä—É–ª–µ—Ç–∫–∞)
      const winner = selectWinnerByProbability(participants);
      console.log(`\nüéØ –ü–†–ï–î–û–ü–†–ï–î–ï–õ–Å–ù–ù–´–ô –ü–û–ë–ï–î–ò–¢–ï–õ–¨: ${winner.name}`);
      console.log(`   –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(winner.probability * 100).toFixed(1)}%\n`);

      // –®–ê–ì 2: –î–µ–ª–∏–º –Ω–∞ –≥—Ä—É–ø–ø—ã –¥–ª—è –≤–∏–∑—É–∞–ª–∞
      let groups = divideIntoGroups(participants);

      console.log('–ì—Ä—É–ø–ø–∞ 1:', groups[0].map(p => p.name).join(', '));
      console.log('–ì—Ä—É–ø–ø–∞ 2:', groups[1].map(p => p.name).join(', '));
      console.log('');

      await enterArena(groups);

      // –ü–∞—É–∑–∞ –ø–æ—Å–ª–µ –ø–æ—è–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤
      await sleep(1500);

      // –®–ê–ì 3: –í—ã–±–∏—Ä–∞–µ–º –±–æ–π—Ü–æ–≤ - –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
      const { fighter1, fighter2 } = selectFightersForBattle(groups, winner);

      if (!fighter1 || !fighter2) {
        tournamentActive = false;
        setUILocked(false);
        return;
      }

      console.log(`\n–ë–æ–π—Ü—ã –≤ –±–∏—Ç–≤–µ: ${fighter1.name} VS ${fighter2.name}`);

      // Move to center
      await moveToBattle([fighter1, fighter2]);

      // –®–ê–ì 4: –ë–∏—Ç–≤–∞ —Å –ø–æ–¥–±–æ—Ä–æ–º –∂–µ—Å—Ç–æ–≤ –ø–æ–¥ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
      await battle(fighter1, fighter2, winner);

      // Show final winner
      await showFinalWinner(winner);

      tournamentActive = false;
      setUILocked(false);
    }

    // –í—ã–±–æ—Ä –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º (–∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è —Ä—É–ª–µ—Ç–∫–∞)
    function selectWinnerByProbability(participants) {
      const totalProb = participants.reduce((sum, p) => sum + p.probability, 0);
      let random = Math.random() * totalProb;

      console.log('=== –í–´–ë–û–† –ü–û–ë–ï–î–ò–¢–ï–õ–Ø (–†–£–õ–ï–¢–ö–ê) ===');
      console.log('–û–±—â–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:', totalProb);
      console.log('–°–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ:', random);

      for (let p of participants) {
        console.log(`  –ü—Ä–æ–≤–µ—Ä–∫–∞ ${p.name}: random = ${random.toFixed(4)}, probability = ${p.probability.toFixed(4)}`);
        random -= p.probability;
        if (random <= 0) {
          console.log(`‚úì –í—ã–±—Ä–∞–Ω: ${p.name}`);
          return p;
        }
      }

      console.log(`‚úì –í—ã–±—Ä–∞–Ω (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é): ${participants[0].name}`);
      return participants[0];
    }

    function divideIntoGroups(participants) {
      const shuffled = [...participants].sort(() => Math.random() - 0.5);
      const mid = Math.ceil(shuffled.length / 2);
      return [shuffled.slice(0, mid), shuffled.slice(mid)];
    }

    // –í—ã–±–∏—Ä–∞–µ–º –±–æ–π—Ü–æ–≤ –¥–ª—è –±–∏—Ç–≤—ã - –æ–¥–∏–Ω –∏–∑ –Ω–∏—Ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
    function selectFightersForBattle(groups, winner) {
      console.log('\n=== –í–´–ë–û–† –ë–û–ô–¶–û–í –î–õ–Ø –ë–ò–¢–í–´ ===');

      // –ù–∞—Ö–æ–¥–∏–º –≤ –∫–∞–∫–æ–π –≥—Ä—É–ø–ø–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—å
      const winnerInGroup0 = groups[0].some(p => p === winner);
      const winnerGroup = winnerInGroup0 ? groups[0] : groups[1];
      const opponentGroup = winnerInGroup0 ? groups[1] : groups[0];

      console.log(`–ü–æ–±–µ–¥–∏—Ç–µ–ª—å ${winner.name} –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –≥—Ä—É–ø–ø–µ ${winnerInGroup0 ? 1 : 2}`);

      // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–¥—ë—Ç –≤ –±–æ–π
      const fighter1 = winner;

      // –ò–∑ –¥—Ä—É–≥–æ–π –≥—Ä—É–ø–ø—ã –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞
      const fighter2 = opponentGroup[Math.floor(Math.random() * opponentGroup.length)];

      console.log(`–ë–æ–µ—Ü –∏–∑ –≥—Ä—É–ø–ø—ã –ø–æ–±–µ–¥–∏—Ç–µ–ª—è: ${fighter1.name}`);
      console.log(`–ë–æ–µ—Ü –∏–∑ –¥—Ä—É–≥–æ–π –≥—Ä—É–ø–ø—ã: ${fighter2.name}`);

      return { fighter1, fighter2 };
    }

    async function enterArena(groups) {
      const arenaRect = arena.getBoundingClientRect();
      // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –±–ª–∏–∂–µ –∫ —Ü–µ–Ω—Ç—Ä—É (25% –æ—Ç –∫—Ä–∞—ë–≤)
      const leftX = arenaRect.width * 0.25;
      const rightX = arenaRect.width * 0.75;
      const spacing = Math.min(80, arenaRect.height / (Math.max(groups[0].length, groups[1].length) + 1));

      // –õ–µ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è —Å–ª–µ–≤–∞
      groups[0].forEach((p, idx) => {
        p.x = leftX;
        p.y = (idx + 1) * spacing + (arenaRect.height - groups[0].length * spacing) / 2;
        createParticipantElement(p, idx * 150);
      });

      // –ü—Ä–∞–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ - –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ª–∏–Ω–∏—è —Å–ø—Ä–∞–≤–∞
      groups[1].forEach((p, idx) => {
        p.x = rightX;
        p.y = (idx + 1) * spacing + (arenaRect.height - groups[1].length * spacing) / 2;
        createParticipantElement(p, idx * 150);
      });

      // –ñ–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      await sleep(Math.max(groups[0].length, groups[1].length) * 150 + 1000);
    }

    function createParticipantElement(p, delay = 0) {
      // –°–æ–∑–¥–∞–µ–º —ç—Ñ—Ñ–µ–∫—Ç –¥—ã–º–∞
      const smoke = document.createElement('div');
      smoke.className = 'smoke-effect';
      smoke.style.left = (p.x - 40) + 'px';
      smoke.style.top = (p.y - 40) + 'px';
      smoke.style.animationDelay = delay + 'ms';
      arena.appendChild(smoke);

      // –£–¥–∞–ª—è–µ–º –¥—ã–º –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        smoke.remove();
      }, delay + 1500);

      // –°–æ–∑–¥–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞
      const el = document.createElement('div');
      el.className = 'participant';
      el.style.backgroundColor = p.color;
      el.style.color = p.color;
        el.style.left = (p.x - 15) + 'px';
        el.style.top  = (p.y) + 'px';
      el.style.animationDelay = delay + 'ms';
      el.dataset.name = p.name;

      // –°–æ–∑–¥–∞–µ–º –∏–º—è
      const nameEl = document.createElement('div');
      nameEl.className = 'participant-name';
      nameEl.textContent = p.name;
      nameEl.style.left = p.x + 'px';
      nameEl.style.top = p.y + 'px';
      nameEl.style.animationDelay = (delay + 500) + 'ms';

      arena.appendChild(el);
      arena.appendChild(nameEl);

      p.element = el;
      p.nameElement = nameEl;
    }


    async function moveToBattle(fighters) {
      const arenaRect = arena.getBoundingClientRect();
      const centerX = arenaRect.width / 2;
      const centerY = arenaRect.height / 2;

      // –î–≤–∏–≥–∞–µ–º –±–æ–π—Ü–æ–≤ –≤ —Ü–µ–Ω—Ç—Ä –ø–æ –æ—á–µ—Ä–µ–¥–∏
      fighters.forEach((f, idx) => {
        const offsetX = idx === 0 ? -80 : 80;
        f.x = centerX + offsetX;
        f.y = centerY;

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –ø–æ—è–≤–ª–µ–Ω–∏—è
        f.element.style.animation = 'none';
        f.nameElement.style.animation = 'none';
        f.element.style.opacity = '1';
        f.nameElement.style.opacity = '1';
        f.element.style.transform = 'scale(1.5)';
        f.element.style.transition = 'all 1.5s ease-out';

        setTimeout(() => {
        f.element.style.left = f.x + 'px';
        f.element.style.top = f.y + 'px';
        f.nameElement.style.left = f.x + 'px';
        f.nameElement.style.top = f.y + 'px';
        }, idx * 800);


        // –î–µ–ª–∞–µ–º –∏–º—è –∫—Ä—É–ø–Ω–µ–µ
        f.nameElement.style.fontSize = '18px';
        f.nameElement.style.fontWeight = '900';
        f.nameElement.style.transition = 'all 1.5s ease-out';
      });

      await sleep(2000);

      // –°–æ–∑–¥–∞—ë–º –¥—Ä–∞–º–∞—Ç–∏—á–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ —Ñ–∏–Ω–∞–ª–∞
      const announcement = document.createElement('div');
      announcement.style.position = 'absolute';
      announcement.style.top = '20%';
      announcement.style.left = '50%';
      announcement.style.transform = 'translate(-50%, -50%) scale(0)';
      announcement.style.fontSize = '32px';
      announcement.style.fontWeight = '900';
      announcement.style.color = '#ffd700';
      announcement.style.textAlign = 'center';
      announcement.style.textShadow = '0 0 20px rgba(255,215,0,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
      announcement.style.zIndex = '200';
      announcement.style.animation = 'winnerAppear 1.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards';
      announcement.innerHTML = `üèÜ –§–ò–ù–ê–õ üèÜ<br><span style="font-size: 0.7em; color: #fff; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">${fighters[0].name} VS ${fighters[1].name}</span>`;
      arena.appendChild(announcement);

      await sleep(3000);

      announcement.style.animation = 'none';
      announcement.style.transform = 'translate(-50%, -50%) scale(0)';
      announcement.style.opacity = '0';
      setTimeout(() => announcement.remove(), 500);

      await sleep(500);
    }

    async function battle(fighter1, fighter2, predeterminedWinner) {
      // Show battle overlay
      battleOverlay.classList.add('active');

      const participantsEl = document.getElementById('battleParticipants');
    participantsEl.innerHTML = `
    <div class="battle-participant-pill" style="border-color:${fighter1.color}; box-shadow:0 0 20px ${fighter1.color}55;">
        <span class="battle-name-text">${fighter1.name}</span>
    </div>
    <div class="battle-vs">VS</div>
    <div class="battle-participant-pill" style="border-color:${fighter2.color}; box-shadow:0 0 20px ${fighter2.color}55;">
        <span class="battle-name-text">${fighter2.name}</span>
    </div>
    `;


      await sleep(500);

      // Rock, paper, scissors
      const choices = ['‚úä', '‚úã', '‚úåÔ∏è']; // rock, paper, scissors

      console.log('\n=== –ë–ò–¢–í–ê ===');
      console.log(`${fighter1.name} VS ${fighter2.name}`);
      console.log(`–ü—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–π –ø–æ–±–µ–¥–∏—Ç–µ–ª—å: ${predeterminedWinner.name}`);

      // –ü–æ–¥–±–∏—Ä–∞–µ–º –∂–µ—Å—Ç—ã —Ç–∞–∫, —á—Ç–æ–±—ã –ø–æ–±–µ–¥–∏–ª predeterminedWinner
      let choice1, choice2;
      let attempts = 0;

      // Keep trying until we get a winning combination for the predetermined winner
      do {
        attempts++;
        choice1 = choices[Math.floor(Math.random() * 3)];
        choice2 = choices[Math.floor(Math.random() * 3)];

        // Determine who would win with these choices
        let rpsWinner = null;
        if (choice1 === choice2) {
          // Tie - keep trying
          console.log(`  –ü–æ–ø—ã—Ç–∫–∞ ${attempts}: ${choice1} vs ${choice2} - –Ω–∏—á—å—è, –ø—Ä–æ–±—É–µ–º —Å–Ω–æ–≤–∞`);
          continue;
        } else if (
          (choice1 === '‚úä' && choice2 === '‚úåÔ∏è') || // rock beats scissors
          (choice1 === '‚úåÔ∏è' && choice2 === '‚úã') || // scissors beats paper
          (choice1 === '‚úã' && choice2 === '‚úä')     // paper beats rock
        ) {
          rpsWinner = fighter1;
        } else {
          rpsWinner = fighter2;
        }

        console.log(`  –ü–æ–ø—ã—Ç–∫–∞ ${attempts}: ${fighter1.name} ${choice1} vs ${fighter2.name} ${choice2} ‚Üí –ø–æ–±–µ–¥–∏—Ç–µ–ª—å RPS: ${rpsWinner.name}`);

        // If RPS winner matches predetermined winner, use these choices
        if (rpsWinner === predeterminedWinner) {
          console.log(`‚úì RPS —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º! –ò—Å–ø–æ–ª—å–∑—É–µ–º ${choice1} –∏ ${choice2}`);
          break;
        }
      } while (true);

      const icon1 = document.getElementById('icon1');
      const icon2 = document.getElementById('icon2');

      // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç—Ä—è—Å—É—â–∏–µ—Å—è –∫—É–ª–∞–∫–∏
      icon1.textContent = '‚úä';
      icon2.textContent = '‚úä';
      icon1.classList.add('shaking');
      icon2.classList.add('shaking');

      // –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π —Ç–∞–π–º–µ—Ä 3 2 1
      const countdown = document.createElement('div');
    countdown.style.position = 'absolute';
    countdown.style.top = '15%';
    countdown.style.left = '50%';
    countdown.style.transform = 'translate(-50%, -50%)';
    countdown.style.fontSize = '52px';
    countdown.style.padding = '8px 24px';
    countdown.style.borderRadius = '999px';
    countdown.style.background = 'rgba(0,0,0,0.35)';
    countdown.style.border = '2px solid rgba(255,255,255,0.4)';

      countdown.style.fontWeight = '900';
      countdown.style.color = '#fff';
      countdown.style.textShadow = '0 0 20px rgba(255,255,255,0.8), 3px 3px 6px rgba(0,0,0,0.8)';
      countdown.style.zIndex = '150';
      battleOverlay.appendChild(countdown);

      // 3
      countdown.textContent = '3';
      countdown.style.animation = 'pulse 0.5s ease-in-out';
      await sleep(1000);

      // 2
      countdown.textContent = '2';
      countdown.style.animation = 'none';
      setTimeout(() => countdown.style.animation = 'pulse 0.5s ease-in-out', 10);
      await sleep(1000);

      // 1
      countdown.textContent = '1';
      countdown.style.animation = 'none';
      setTimeout(() => countdown.style.animation = 'pulse 0.5s ease-in-out', 10);
      await sleep(1000);

      countdown.remove();

      // –í—Å–∫—Ä—ã–≤–∞–µ–º –∂–µ—Å—Ç—ã —Å –¥—Ä–∞–º–æ–π
      icon1.classList.remove('shaking');
      icon2.classList.remove('shaking');
      icon1.textContent = choice1;
      icon2.textContent = choice2;
      icon1.classList.add('show');
      icon2.classList.add('show');

      await sleep(3000);

      // Show winner
      if (predeterminedWinner === fighter1) {
        icon1.classList.add('winner');
      } else {
        icon2.classList.add('winner');
      }

      await sleep(1500);

      // Reset and hide overlay WITHOUT showing winner here
      icon1.classList.remove('show', 'winner', 'shaking');
      icon2.classList.remove('show', 'winner', 'shaking');
      battleOverlay.classList.remove('active');

      await sleep(300);
    }

    async function repositionGroups(groups) {
      const arenaRect = arena.getBoundingClientRect();
      const leftX = arenaRect.width * 0.2;
      const rightX = arenaRect.width * 0.8;

      // Reposition left group
      groups[0].forEach((p, idx) => {
        p.x = leftX;
        p.y = (arenaRect.height / (groups[0].length + 1)) * (idx + 1);

        if (p.element) {
        p.element.style.left = (p.x - 15) + 'px';
        p.element.style.top  = (p.y - 15) + 'px';
        }
        if (p.nameElement) {
        p.nameElement.style.left = p.x + 'px';
        p.nameElement.style.top  = p.y + 'px';
        }

      });

      // Reposition right group
      groups[1].forEach((p, idx) => {
        p.x = rightX;
        p.y = (arenaRect.height / (groups[1].length + 1)) * (idx + 1);

        if (p.element) {
        p.element.style.left = (p.x - 15) + 'px';
        p.element.style.top  = (p.y - 15) + 'px';
        }
        if (p.nameElement) {
        p.nameElement.style.left = p.x + 'px';
        p.nameElement.style.top  = p.y + 'px';
        }

      });

      await sleep(800);
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    function createConfetti() {
      const colors = ['#ffd700', '#ff6b6b', '#4ecdc4', '#45b7d1', '#f7dc6f', '#bb8fce', '#85c1e2'];
      const confettiCount = 150;

      for (let i = 0; i < confettiCount; i++) {
        setTimeout(() => {
          const confetti = document.createElement('div');
          confetti.className = 'confetti';
          confetti.style.left = Math.random() * window.innerWidth + 'px';
          confetti.style.top = '-10px';
          confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animation = `confettiFall ${3 + Math.random() * 2}s linear forwards`;
          confetti.style.animationDelay = Math.random() * 0.5 + 's';
          document.body.appendChild(confetti);

          setTimeout(() => confetti.remove(), 6000);
        }, i * 15);
      }
    }

    // –§—É–Ω–∫—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è celebration words
    function createCelebrationWords(name) {
      const words = [name, 'üèÜ', '–ß–ï–ú–ü–ò–û–ù', '‚≠ê', name, 'üëë', '–ü–û–ë–ï–î–ê'];
      words.forEach((word, idx) => {
        setTimeout(() => {
          const wordEl = document.createElement('div');
          wordEl.className = 'celebration-word';
          wordEl.textContent = word;
          wordEl.style.left = (20 + Math.random() * 60) + '%';
          wordEl.style.top = (30 + Math.random() * 40) + '%';
          wordEl.style.animationDelay = (idx * 0.2) + 's';
          document.body.appendChild(wordEl);

          setTimeout(() => wordEl.remove(), 3500);
        }, idx * 300);
      });
    }

    async function showFinalWinner(winner) {
      console.log('\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ');
      console.log(`ü•á –§–ò–ù–ê–õ–¨–ù–´–ô –ü–û–ë–ï–î–ò–¢–ï–õ–¨: ${winner.name}`);
      console.log(`   –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: ${(winner.probability * 100).toFixed(1)}%`);
      console.log('‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n');

      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
      const winnerEl = document.getElementById('winnerAnnouncement');
      const winnerText = document.getElementById('winnerText');
      winnerText.innerHTML = `<span class="winner-emoji">üèÜ</span> –ß–ï–ú–ü–ò–û–ù:<br><span class="winner-name">${winner.name}</span> <span class="winner-emoji">üèÜ</span>`;
      winnerEl.classList.add('show');

      // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –∏ celebration words –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å –ø–ª–∞—à–∫–æ–π
      createConfetti();
      createCelebrationWords(winner.name);

      await sleep(5000);

      winnerEl.classList.remove('show');

      await sleep(500);

      // –£–±–∏—Ä–∞–µ–º –≤—Å–µ—Ö –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
      participants.forEach(p => {
        if (p !== winner && p.element) {
          p.element.style.transition = 'all 0.8s ease-out';
          p.element.style.opacity = '0';
          p.element.style.transform = 'scale(0)';
          if (p.nameElement) {
            p.nameElement.style.opacity = '0';
          }
        }
      });

      await sleep(800);

      // –£–¥–∞–ª—è–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–æ–∏–≥—Ä–∞–≤—à–∏—Ö
      participants.forEach(p => {
        if (p !== winner) {
          if (p.element) p.element.remove();
          if (p.nameElement) p.nameElement.remove();
        }
      });

      // –ü–µ—Ä–µ–º–µ—â–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –≤ —Ü–µ–Ω—Ç—Ä
      const arenaRect = arena.getBoundingClientRect();
      const centerX = arenaRect.width / 2;
      const centerY = arenaRect.height / 2;

    winner.element.style.left = (centerX - 15) + 'px';
    winner.element.style.top  = (centerY - 15) + 'px';
    winner.element.style.transform = 'scale(2)';
    winner.nameElement.style.left = centerX + 'px';
    winner.nameElement.style.top  = centerY + 'px';
    winner.nameElement.style.fontSize = '24px';

    }

    function sleep(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    // ===== INITIALIZATION =====
    loadProbabilities();
    renderParticipants();
    validateProbabilities();
  </script>
</body>
</html>
