<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>–ë–∏–Ω–≥–æ - –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä</title>
  <meta name="description" content="–ò–≥—Ä–∞ –≤ –±–∏–Ω–≥–æ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∏ –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —á–∏—Å–ª–∞–º–∏. –ë—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞ –∑–∞ 8 —Ö–æ–¥–æ–≤!" />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <link rel="canonical" href="bingo.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="–ë–∏–Ω–≥–æ - –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä">
  <meta property="og:description" content="–ò–≥—Ä–∞ –≤ –±–∏–Ω–≥–æ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∏ –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —á–∏—Å–ª–∞–º–∏. –ë—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞ –∑–∞ 8 —Ö–æ–¥–æ–≤!">
  <meta property="og:url" content="bingo.html">
  <meta property="og:site_name" content="–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä">
  <meta property="og:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f3b1.svg">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="–ë–∏–Ω–≥–æ - –†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä">
  <meta name="twitter:description" content="–ò–≥—Ä–∞ –≤ –±–∏–Ω–≥–æ —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –∏ –≤—ã–ø–∞–¥–∞—é—â–∏–º–∏ —á–∏—Å–ª–∞–º–∏. –ë—ã—Å—Ç—Ä–∞—è –ø–æ–±–µ–¥–∞ –∑–∞ 8 —Ö–æ–¥–æ–≤!">
  <meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f3b1.svg">

  <!-- Icons -->
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f3b1.svg" type="image/svg+xml">
  <meta name="theme-color" content="#764ba2">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Kalam:wght@700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      touch-action: manipulation;
    }

    /* ===== DESKTOP –ú–ï–ù–Æ ===== */
    .top-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .desktop-menu-toggle {
      position: relative;
      background: linear-gradient(135deg, rgba(30,35,60,0.85), rgba(50,30,70,0.85));
      backdrop-filter: blur(12px);
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow:
        0 4px 15px rgba(0,0,0,0.3),
        0 0 0 0 rgba(255,255,255,0.4);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
    }

    .desktop-menu-toggle::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2, #667eea);
      background-size: 200% 200%;
      animation: gradientSpin 3s ease infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    @keyframes gradientSpin {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .desktop-menu-toggle:hover::before {
      opacity: 1;
    }

    .desktop-menu-toggle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow:
        0 8px 25px rgba(0,0,0,0.4),
        0 0 0 8px rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
    }

    .desktop-menu-toggle:active {
      transform: translateY(-1px) scale(0.98);
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 18px;
      position: relative;
      transition: transform 0.3s ease;
    }

    .menu-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background: #fff;
      border-radius: 2px;
      position: absolute;
      left: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .menu-icon span:nth-child(1) {
      top: 0;
    }

    .menu-icon span:nth-child(2) {
      top: 50%;
      margin-top: -1.5px;
    }

    .menu-icon span:nth-child(3) {
      bottom: 0;
    }

    .desktop-menu-toggle:hover .menu-icon {
      transform: scale(1.1);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(1) {
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(45deg);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(2) {
      opacity: 0;
      transform: rotate(180deg) scale(0);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(3) {
      bottom: auto;
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(-45deg);
    }

    .desktop-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 15px;
      background: linear-gradient(135deg, rgba(20,25,45,0.92), rgba(40,20,55,0.92));
      backdrop-filter: blur(20px);
      border-radius: 16px;
      box-shadow:
        0 10px 40px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.15) inset,
        0 0 20px rgba(102,126,234,0.2);
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(-10px);
      transition:
        max-height 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55),
        opacity 0.3s ease,
        transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      min-width: 240px;
    }

    .desktop-dropdown.active {
      max-height: 600px;
      opacity: 1;
      transform: translateY(0);
    }

    .desktop-dropdown a {
      position: relative;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .desktop-dropdown a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      transform: translateX(-4px);
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(102,126,234,0.2), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .desktop-dropdown a:last-child {
      border-bottom: none;
    }

    .desktop-dropdown a:hover {
      background: rgba(102,126,234,0.25);
      padding-left: 24px;
      color: #ffd43b;
      text-shadow: 0 0 10px rgba(255,212,59,0.5);
    }

    .desktop-dropdown a:hover::before {
      transform: translateX(0);
    }

    .desktop-dropdown a:hover::after {
      opacity: 1;
    }

    .desktop-dropdown a:active {
      background: rgba(118,75,162,0.3);
      transform: scale(0.98);
    }

    .desktop-dropdown a span:first-child {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a:hover span:first-child {
      transform: scale(1.2) rotate(10deg);
    }

    /* ===== MOBILE –ú–ï–ù–Æ (–°–ö–†–´–¢–û –ü–û –î–ï–§–û–õ–¢–£ –ù–ê DESKTOP) ===== */
    .menu-container {
      display: none;
    }

    /* ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ===== */
    .main-container {
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      align-items: center;
      max-width: 1200px;
      width: 100%;
    }

    .game-container {
      flex: 1;
      text-align: center;
      perspective: 1000px;
      position: relative;
    }

  .game-field {
    width: 100%;
    min-height: 600px;
    position: relative;
    border-radius: 24px;
      overflow: hidden;
      border: 3px solid rgba(255,255,255,0.15);
      box-shadow:
        0 12px 40px rgba(0,0,0,0.5),
        0 0 40px rgba(102,126,234,0.35);
      background:
        radial-gradient(circle at 50% 0%, rgba(255,255,255,0.08), transparent 60%),
        radial-gradient(circle at 0% 100%, rgba(0,255,255,0.08), transparent 55%),
        radial-gradient(circle at 100% 100%, rgba(255,0,255,0.08), transparent 55%),
        linear-gradient(90deg, rgba(255,255,255,0.04) 1px, transparent 1px),
        linear-gradient(180deg, rgba(255,255,255,0.04) 1px, transparent 1px),
        #0b1020;
      background-size:
        100% 100%,
        100% 100%,
        100% 100%,
        48px 48px,
        48px 48px,
        auto;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .game-field::before {
      content: '';
      position: absolute;
      inset: 24px;
      border-radius: 20px;
      border: 2px solid rgba(255,255,255,0.08);
      box-shadow: 0 0 30px rgba(0,0,0,0.7) inset;
      pointer-events: none;
    }

    .game-placeholder {
      color: rgba(255,255,255,0.82);
      font-size: 18px;
      font-weight: 600;
      line-height: 1.6;
      text-align: left;
      padding: 28px 32px;
      max-width: 520px;
      margin: 0 auto;
      border-radius: 16px;
      background: rgba(255,255,255,0.06);
      box-shadow: 0 10px 35px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.12);
      backdrop-filter: blur(6px);
    }

    @media (max-width: 768px) {
      .game-placeholder {
        font-size: 15px;
        line-height: 1.5;
        padding: 20px 24px;
        max-width: 100%;
        margin: 0 12px;
        text-align: center;
      }

      .game-placeholder ul {
        text-align: left !important;
      }

      .game-placeholder li {
        align-items: flex-start !important;
      }
    }

    /* ===== BINGO –ö–ê–†–¢–û–ß–ö–ò ===== */
    .bingo-container {
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding: 30px;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.3) transparent;
    }

    .bingo-container::-webkit-scrollbar {
      width: 8px;
    }

    .bingo-container::-webkit-scrollbar-track {
      background: transparent;
    }

    .bingo-container::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 4px;
    }

    .bingo-timer {
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      font-weight: 600;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
      letter-spacing: 1px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease;
      min-height: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      margin: 0 auto 4px;
      flex-shrink: 0;
    }

    .bingo-timer.visible {
      opacity: 1;
      visibility: visible;
    }

    .bingo-timer .countdown {
      color: #ffd43b;
      font-size: 18px;
      font-weight: 800;
      margin-left: 5px;
    }

    @media (max-width: 768px) {
      .bingo-timer {
        font-size: 12px;
        min-height: 20px;
        padding: 0 8px;
        white-space: nowrap;
        margin-top: 18px;
        margin-bottom: 12px;
      }

      .bingo-timer .countdown {
        font-size: 16px;
      }

      .bingo-status-bar {
        padding: 20px 25px;
        gap: 12px;
      }
    }

    .bingo-turn-info {
      color: #ffd43b;
      font-size: 18px;
      font-weight: 800;
      text-shadow: 0 2px 4px rgba(0,0,0,0.5);
    }

    .bingo-status-bar {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 10px;
      padding: 15px 25px;
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      border: 2px solid rgba(255,255,255,0.15);
      margin-bottom: 10px;
      overflow: hidden;
      position: relative;
      min-height: 80px;
    }

    .bingo-numbers-display {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      overflow-x: auto;
      scrollbar-width: thin;
      scrollbar-color: rgba(255,255,255,0.3) transparent;
      padding: 5px 0;
    }

    .bingo-numbers-display::-webkit-scrollbar {
      height: 6px;
    }

    .bingo-numbers-display::-webkit-scrollbar-track {
      background: transparent;
    }

    .bingo-numbers-display::-webkit-scrollbar-thumb {
      background: rgba(255,255,255,0.3);
      border-radius: 3px;
    }

    .bingo-drawn-number {
      font-size: 32px;
      color: #fff;
      filter: drop-shadow(0 0 10px rgba(255,212,59,0.4));
      background: linear-gradient(135deg, rgba(102,126,234,0.4), rgba(118,75,162,0.4));
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 12px;
      padding: 6px 12px;
      min-width: 50px;
      text-align: center;
      flex-shrink: 0;
      opacity: 0.6;
      transition: all 0.3s ease;
    }

    .bingo-drawn-number.current {
      font-size: 32px;
      opacity: 1;
      background: linear-gradient(135deg, rgba(255,212,59,0.4), rgba(255,165,0,0.4));
      border-color: #ffd43b;
      box-shadow: 0 0 10px rgba(255,212,59,0.45);
      transform: none;
      animation: none;
    }

    .bingo-drawn-number.new {
      animation: slideInFromRight 0.5s ease-out;
    }

    @keyframes pulseNumber {
      0%, 100% { transform: scale(1.1); }
      50% { transform: scale(1.2); }
    }

    @keyframes pulseDramatic {
      0%, 100% { transform: scale(1.05); box-shadow: 0 0 14px rgba(255,212,59,0.5); }
      50% { transform: scale(1.1); box-shadow: 0 0 20px rgba(255,212,59,0.7); }
    }

    @keyframes slideInFromRight {
      from {
        transform: translateX(100px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }


    .bingo-cards-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding-bottom: 20px;
      justify-content: center;
      align-items: flex-start;
    }

    .bingo-cards-grid .bingo-card {
      width: 200px;
      flex-shrink: 0;
    }

    .bingo-card {
      background: rgba(255,255,255,0.08);
      backdrop-filter: blur(12px);
      border: 2px solid rgba(255,255,255,0.15);
      border-radius: 12px;
      padding: 12px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transition: all 1.2s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.8s ease;
      opacity: 0;
      transform: translateY(20px) scale(0.9);
      animation: cardAppear 0.4s ease-out forwards;
    }

    .bingo-card.eliminated {
      opacity: 0.25;
      filter: grayscale(0.8) brightness(0.6);
    }

    @media (max-width: 768px) {
      .bingo-card.eliminated {
        order: 999;
      }
    }

    .bingo-card.active {
      border-color: #22c55e;
      box-shadow: 0 0 30px rgba(34,197,94,0.5);
      transform: translateY(-10px) scale(1.02);
      transition: all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .bingo-card.survived {
      border-color: #ffd43b;
      box-shadow: 0 0 40px rgba(255,212,59,0.7);
      background: linear-gradient(135deg, rgba(255,212,59,0.15), rgba(255,165,0,0.15));
      transform: scale(1.05);
      z-index: 10;
    }

    @keyframes cardAppear {
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .bingo-card.winner {
      border-color: #ffd43b;
      box-shadow: 0 0 40px rgba(255,212,59,0.6);
      animation: cardWin 0.6s ease-out, cardGlow 2s ease-in-out infinite 0.6s;
      background: linear-gradient(135deg, rgba(255,212,59,0.2), rgba(255,165,0,0.2));
      opacity: 1 !important;
      transform: translateY(0) scale(1) !important;
    }

    @keyframes cardWin {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    @keyframes cardGlow {
      0%, 100% { box-shadow: 0 0 40px rgba(255,212,59,0.6); }
      50% { box-shadow: 0 0 60px rgba(255,212,59,0.9); }
    }

    .bingo-card-header {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 2px solid rgba(255,255,255,0.2);
    }

    .bingo-card-icon {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
    }

    .bingo-card-name {
      color: #fff;
      font-size: 14px;
      font-weight: 800;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .bingo-card-numbers {
      display: flex;
      justify-content: space-around;
      gap: 6px;
      margin: 12px 0;
    }

    .bingo-number {
      position: relative;
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, rgba(102,126,234,0.3), rgba(118,75,162,0.3));
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      font-weight: 700;
      color: #fff;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.5));
      transition: all 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    }

    .bingo-number.matched {
      background: linear-gradient(135deg, rgba(34,197,94,0.7), rgba(22,163,74,0.7));
      border-color: #22c55e;
      box-shadow: 0 0 20px rgba(34,197,94,0.6);
      transform: scale(1.05);
    }

    .bingo-card.eliminated .bingo-number.matched {
      background: linear-gradient(135deg, rgba(102,126,234,0.3), rgba(118,75,162,0.3));
      border-color: rgba(255,255,255,0.3);
      box-shadow: none;
      transform: scale(1);
    }

    .bingo-progress-bar {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-top: 10px;
    }

    .bingo-progress-label {
      color: rgba(255,255,255,0.7);
      font-size: 11px;
      font-weight: 600;
    }

    .bingo-progress-track {
      flex: 1;
      height: 6px;
      background: rgba(255,255,255,0.1);
      border-radius: 3px;
      overflow: hidden;
    }

    .bingo-progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea, #764ba2);
      border-radius: 3px;
      transition: width 0.4s ease;
    }

    .bingo-card.winner .bingo-progress-fill {
      background: linear-gradient(90deg, #ffd43b, #ffa500);
    }

    /* ===== WINNER ANNOUNCEMENT ===== */
    .winner-announcement {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(102,126,234,0.98), rgba(118,75,162,0.98));
      padding: 50px 70px;
      border-radius: 24px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.7);
      z-index: 1001;
      display: none;
      text-align: center;
      backdrop-filter: blur(20px);
      border: 3px solid rgba(255,255,255,0.3);
    }

    @media (max-width: 768px) {
      .winner-announcement {
        padding: 24px 28px;
        border-radius: 16px;
        max-width: 90%;
        text-align: center !important;
        background: linear-gradient(135deg, rgba(102,126,234,0.95), rgba(118,75,162,0.95)) !important;
        border: 2px solid rgba(255,255,255,0.25) !important;
        box-shadow: 0 12px 40px rgba(0,0,0,0.6) !important;
      }

      .winner-announcement h2 {
        font-size: 24px !important;
        text-align: center !important;
        margin: 0 0 8px 0 !important;
        line-height: 1.2 !important;
      }

      .winner-announcement * {
        text-align: center !important;
      }

      .winner-name {
        font-size: 1.3em !important;
        margin: 8px 0 0 !important;
      }

      .winner-emoji {
        font-size: 1.1em !important;
      }
    }

    .winner-announcement.show {
      display: block;
      animation: winnerAppear 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes winnerAppear {
      0% { transform: translate(-50%, -50%) scale(0) rotate(-180deg); opacity: 0; }
      100% { transform: translate(-50%, -50%) scale(1) rotate(0deg); opacity: 1; }
    }

    .winner-announcement h2 {
      color: #fff;
      font-size: 42px;
      margin: 0;
      text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
      line-height: 1.3;
    }

    .winner-name {
      display: block;
      margin: 12px 0 0;
      font-size: 1.5em;
      letter-spacing: 0.05em;
      color: #ffd43b;
      text-shadow: 0 0 20px rgba(255,212,59,0.8);
    }

    .winner-emoji {
      font-size: 1.3em;
    }

    .confetti {
      position: fixed;
      width: 12px;
      height: 12px;
      z-index: 1000;
      pointer-events: none;
      animation: confetti-fall 3s ease-out forwards;
    }

    @keyframes confetti-fall {
      0% { transform: translateY(0) rotate(0deg); opacity: 1; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }

    .celebration-emoji {
      position: fixed;
      font-size: 70px;
      z-index: 1000;
      pointer-events: none;
      animation: emojiCelebrate 3s ease-out forwards;
    }

    @keyframes emojiCelebrate {
      0% { transform: scale(0) rotate(0deg); opacity: 0; }
      20% { transform: scale(1.5) rotate(180deg); opacity: 1; }
      80% { opacity: 1; }
      100% { transform: scale(0.5) rotate(360deg); opacity: 0; }
    }

    body.shake {
      animation: screenShake 0.5s ease-in-out;
    }

    @keyframes screenShake {
      0%, 100% { transform: translate(0, 0); }
      10% { transform: translate(-5px, 2px); }
      20% { transform: translate(5px, -2px); }
      30% { transform: translate(-3px, 3px); }
      40% { transform: translate(3px, -3px); }
      50% { transform: translate(-2px, 2px); }
      60% { transform: translate(2px, -2px); }
      70% { transform: translate(-3px, 3px); }
      80% { transform: translate(3px, -3px); }
      90% { transform: translate(-1px, 1px); }
    }

    /* ===== RESPONSIVE BINGO ===== */
    @media (max-width: 918px) {
      .bingo-container {
        padding: 15px;
        gap: 15px;
      }

      .bingo-status-bar {
        flex-direction: column;
        gap: 10px;
        padding: 15px;
      }

      .bingo-current-number {
        font-size: 36px;
      }

      .bingo-cards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
      }

      .bingo-number {
        width: 42px;
        height: 42px;
        font-size: 16px;
      }

      .bingo-card {
        padding: 10px;
      }

      .bingo-card-name {
        font-size: 12px;
      }
    }

    .settings-panel {
      width: 420px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .settings-title {
      color: #fff;
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .settings-actions {
      display: flex;
      gap: 8px;
    }

    .equalize-btn, .collapse-btn {
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(102,126,234,0.8), rgba(118,75,162,0.8));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
    }

    .collapse-btn {
      display: none;
    }

    .equalize-btn:hover, .collapse-btn:hover {
      background: linear-gradient(135deg, rgba(118,75,162,1), rgba(102,126,234,1));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      border-color: rgba(255,255,255,0.5);
    }

    .equalize-btn:active, .collapse-btn:active {
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .names-list-wrapper {
      max-height: 2000px;
      transition: max-height 0.3s ease;
    }

    .names-list-wrapper.collapsed {
      max-height: 0;
      overflow: hidden;
    }

    .names-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-height: none;
      overflow: visible;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-right: 5px;
    }
    .names-list::-webkit-scrollbar {
      display: none;
    }

    .headers-row {
      display: flex;
      align-items: center;
      gap: 0px;
      margin-bottom: 10px;
      padding: 0 5px;
    }

    .header-name {
      flex: 1;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: left;
    }

    .header-probability {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      width: 120px;
      flex-shrink: 0;
    }

    .header-remove {
      width: 44px;
    }

    .name-item {
      display: flex;
      gap: 8px;
      align-items: center;
      min-width: 0;
    }

    .name-input {
      flex: 1;
      min-width: 0;
      padding: 10px 15px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      transition: 0.3s;
    }
    .name-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.2);
    }
    .name-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .name-input.error-state {
      border-color: #ef4444 !important;
      background: rgba(239,68,68,0.1) !important;
    }

    .name-input.error-state::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .probability-controls {
      display: flex;
      gap: 5px;
      width: 120px;
      flex-shrink: 0;
    }

    .prob-btn {
      padding: 5px 10px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .prob-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .prob-btn:active {
      transform: scale(0.95);
    }

    .probability-input {
      width: 55px;
      padding: 4px;
      background: rgba(255,255,255,0.1);
      color: #ffd43b;
      border: 2px solid rgba(255,212,59,0.3);
      border-radius: 5px;
      text-align: center;
      font-weight: 800;
      font-size: 14px;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .probability-input::-webkit-outer-spin-button,
    .probability-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .probability-input[type=number] {
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .probability-input.error {
      border-color: #ef4444;
      background: rgba(239,68,68,0.2);
    }

    .probability-input.manual {
      background: rgba(255,244,204,0.25);
      border-color: #F59E0B;
      box-shadow: 0 0 0 3px rgba(245,158,11,0.25);
    }

    .prob-btn,
    .remove-btn,
    .add-btn-small {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .equalize-btn {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .prob-btn:hover,
    .remove-btn:hover,
    .add-btn-small:hover,
    .equalize-btn:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    .probability-input:focus {
      outline: none;
      border-color: rgba(255,212,59,0.6);
      background: rgba(255,255,255,0.15);
    }

    .remove-btn {
      padding: 8px 12px;
      background: rgba(239,68,68,0.2);
      color: #fff;
      border: 2px solid rgba(239,68,68,0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      transition: 0.2s;
      width: 44px;
      flex-shrink: 0;
    }

    .remove-btn:hover {
      background: rgba(239,68,68,0.4);
      border-color: rgba(239,68,68,0.5);
      transform: scale(1.05);
    }

    .remove-btn:active {
      transform: scale(0.95);
    }

    .add-name-container {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .add-btn-small {
      padding: 10px 15px;
      background: rgba(34,197,94,0.7);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 20px;
      transition: 0.3s;
    }
    .add-btn-small:hover {
      background: rgba(34,197,94,0.9);
      transform: scale(1.1);
    }

    .add-btn-small:active {
      transform: scale(0.95);
    }

    .start-btn {
      width: auto;
      min-width: 200px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 800;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      margin-top: 20px;
    }

    .start-btn:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .start-btn:hover:not(:disabled):before {
      width: 300px;
      height: 300px;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .start-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:disabled,
    input:disabled {
      opacity: 0.5;
      cursor: not-allowed !important;
    }

    .error-message {
      color: #fff;
      font-size: 13px;
      margin-top: 8px;
      min-height: 16px;
    }

    /* –¢—É–ª—Ç–∏–ø –¥–ª—è –æ—à–∏–±–æ–∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π */
    .probability-error-tooltip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95));
      color: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      z-index: 1002;
      font-weight: 700;
      font-size: 16px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.3);
      animation: tooltipAppear 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes tooltipAppear {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }

      .settings-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-container {
        width: 100%;
      }
    }

    @media (max-width: 918px) {
      html, body {
        max-width: 100%;
        overflow-x: hidden;
      }
      body {
        padding: calc(66px + var(--safe-top)) var(--safe-right) calc(20px + var(--safe-bottom)) var(--safe-left);
      }

      .top-buttons {
        display: none;
      }

      .menu-container {
        display: block;
        position: fixed;
        top: var(--safe-top);
        left: var(--safe-left);
        right: var(--safe-right);
        z-index: 1000;
        padding: 12px 16px;
        background: linear-gradient(180deg, rgba(102,126,234,0.95) 0%, rgba(118,75,162,0.85) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .menu-title {
        color: #fff;
        font-size: 18px;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .burger-btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 4px;
        transition: all 0.3s ease;
      }

      .burger-btn:hover {
        background: rgba(255,255,255,0.3);
      }

      .burger-btn span {
        display: block;
        width: 24px;
        height: 3px;
        background: #fff;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .burger-btn.active span:nth-child(1) {
        transform: rotate(45deg) translateY(7px);
      }

      .burger-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .burger-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translateY(-7px);
      }

      .menu-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, rgba(102,126,234,0.98) 0%, rgba(118,75,162,0.98) 100%);
        backdrop-filter: blur(10px);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .menu-dropdown.active {
        max-height: 500px;
      }

      .menu-dropdown a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        transition: background 0.2s;
      }

      .menu-dropdown a:last-child {
        border-bottom: none;
      }

      .menu-dropdown a:hover {
        background: rgba(255,255,255,0.15);
      }

      .menu-dropdown a:active {
        background: rgba(255,255,255,0.25);
      }

      .main-container {
        flex-direction: column;
        gap: 20px;
      }

      .collapse-btn {
        display: block;
      }

      .game-field {
        min-height: 400px;
      }

      .name-item {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
      }

      .name-item .name-input {
        flex: 1;
        min-width: 0;
      }

      .name-item .remove-btn {
        flex-shrink: 0;
      }

      .names-list-wrapper {
        max-height: none;
      }

      .names-list {
        max-height: none;
        overflow-y: visible;
        overflow: visible;
        width: 100%;
        max-width: 100%;
        flex: 1 1 auto;
      }

      .name-input.invalid {
        border-color: #ef4444 !important;
        background: rgba(239,68,68,0.1) !important;
      }

      h1 {
        font-size: clamp(24px, 6vw, 48px);
        margin-bottom: 30px;
        margin-top: 18px !important;
      }

      .probability-error-tooltip {
        max-width: 90%;
        padding: 16px 20px;
        font-size: 14px;
      }

      .add-name-container {
        display: flex;
        gap: 8px;
        margin-top: 15px;
      }

      .add-name-container .name-input {
        flex: 1;
        min-width: 0;
      }

      .add-btn-small {
        flex-shrink: 0;
        width: 44px;
        padding: 10px 0;
      }

      .settings-panel {
        width: 100%;
        max-width: 600px;
        padding: 20px 16px;
        margin: 0 auto;
      }

      .settings-header {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin-bottom: 10px;
      }

      .settings-actions {
        display: flex;
        justify-content: flex-end;
        width: 100%;
        gap: 8px;
        margin-bottom: 4px;
      }

      .settings-actions .collapse-btn {
        display: none !important;
      }

      .equalize-btn {
        padding: 8px 16px;
        font-size: 14px;
      }
    }
  </style>
</head>
<body>

  <!-- Desktop Menu -->
  <div class="top-buttons">
    <button class="desktop-menu-toggle" id="desktopMenuToggle" aria-label="–ú–µ–Ω—é">
      <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    <nav class="desktop-dropdown" id="desktopDropdown">
      <a href="index.html"><span>üè†</span> –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="bingo.html"><span>üé≤</span> –ë–∏–Ω–≥–æ</a>
      <a href="wheel-of-fortune.html"><span>üé°</span> –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html"><span>üé±</span> –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html"><span>üîÆ</span> –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html"><span>üéØ</span> –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html"><span>üèÅ</span> –ì–æ–Ω–∫–∏</a>
      <a href="trading.html"><span>üìà</span> –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html"><span>‚öîÔ∏è</span> –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div class="menu-container">
    <div class="menu-header">
      <div class="menu-title">–†–ê–ù–î–û–ú–ê–ô–ó–ï–†</div>
      <button class="burger-btn" id="burgerBtn" aria-label="–ú–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="menu-dropdown" id="menuDropdown">
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="bingo.html">üé≤ –ë–∏–Ω–≥–æ</a>
      <a href="wheel-of-fortune.html">üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html">üé± –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html">üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html">üéØ –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html">üèÅ –ì–æ–Ω–∫–∏</a>
      <a href="trading.html">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <div class="main-container">
    <!-- Game Container -->
    <div class="game-container">
      <h1 style="color: #fff; text-align: center; font-size: 48px; font-weight: 800; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.5);">–ë–ò–ù–ì–û üé≤</h1>
      <div class="game-field" id="gameField">
        <div class="game-placeholder">
          <div style="font-size: 14px; text-transform: uppercase; letter-spacing: 1px; color: rgba(255,255,255,0.7); margin-bottom: 6px;">–ü—Ä–∞–≤–∏–ª–∞</div>
          <div style="font-size: 18px; font-weight: 700; margin-bottom: 10px; color: #fff;">–£ –∫–∞–∂–¥–æ–≥–æ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∞ —Å–æ —Å–º–∞–π–ª–∏–∫–∞–º–∏:</div>
          <ul style="list-style: none; padding-left: 0; margin: 0; display: grid; gap: 6px;">
            <li style="display: flex; gap: 8px; align-items: center;"><span style="color: #ffd43b;">1)</span> –í—ã–ø–∞–¥–∞–µ—Ç —Å–ª—É—á–∞–π–Ω—ã–π —Å–º–∞–π–ª–∏–∫</li>
            <li style="display: flex; gap: 8px; align-items: center;"><span style="color: #ffd43b;">2)</span> –£ –∫–æ–≥–æ –æ–Ω –µ—Å—Ç—å –≤ –∫–∞—Ä—Ç–æ—á–∫–µ ‚Äî –æ—Å—Ç–∞—é—Ç—Å—è</li>
            <li style="display: flex; gap: 8px; align-items: center;"><span style="color: #ffd43b;">3)</span> –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤—ã–±—ã–≤–∞—é—Ç</li>
            <li style="display: flex; gap: 8px; align-items: center;"><span style="color: #ffd43b;">4)</span> –ü–æ–±–µ–∂–¥–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Å—Ç–∞–≤—à–∏–π—Å—è</li>
          </ul>
        </div>
      </div>
      <button class="start-btn" id="startBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h2 class="settings-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏ (2-10)</h2>
        <div class="settings-actions">
          <button class="equalize-btn" id="equalizeBtn" title="–£—Ä–∞–≤–Ω—è—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏">–£—Ä–∞–≤–Ω—è—Ç—å</button>
          <button class="collapse-btn" id="collapseBtn" title="–°–≤–µ—Ä–Ω—É—Ç—å —Å–ø–∏—Å–æ–∫">
            <span id="collapseIcon">‚ñº</span>
          </button>
        </div>
      </div>

      <div class="names-list-wrapper" id="namesListWrapper">
        <div class="headers-row">
          <div class="header-name">–ò–º—è</div>
          <div class="header-probability">üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
          <div class="header-remove"></div>
        </div>
        <div class="names-list" id="namesList"></div>
      </div>

      <div class="add-name-container">
        <input type="text" class="name-input" id="newNameInput" placeholder="–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫" maxlength="15">
        <button class="add-btn-small" id="addNameBtn" title="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞">‚ûï</button>
      </div>

      <div id="errorMessage" class="error-message"></div>
    </div>
  </div>

  <div class="winner-announcement" id="winnerAnnouncement"></div>

<script>
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

  const NAMES_KEY = 'shared_names_v1';
  const PROB_KEY = 'shared_probabilities_v2';
  const LOCKED_KEY = 'shared_locked_v1';
  const MAX_PARTICIPANTS = 10;
  const MIN_PARTICIPANTS = 2;
  const MIN_PROBABILITY = 0.05;

  // –ü—É–ª —Å–º–∞–π–ª–∏–∫–æ–≤ –¥–ª—è –∏–≥—Ä—ã - –∫–∞–∑–∏–Ω–æ—à–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
  const EMOJI_POOL = [
    'üçí','üçã','üçä','üçâ','üçá','üçì',
    'üîî','7Ô∏è‚É£','üé∞','üé≤','üÉè','üÄÑÔ∏è',
    '‚ô†Ô∏è','‚ô•Ô∏è','‚ô¶Ô∏è','‚ô£Ô∏è','üíé','‚≠êÔ∏è',
    'üçÄ','üí∞','üíµ','ü§ë','üèÜ','üëë',
    'üéØ','üéüÔ∏è','üéÅ','‚ú®','üî•','‚ö°Ô∏è'
  ];

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø–ª–∞–Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –º–∞—Å—Å–∏–≤: —Å–∫–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –¥–æ–ª–∂–Ω–æ –û–°–¢–ê–¢–¨–°–Ø –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞
  // –í–ê–ñ–ù–û: –º–∞–∫—Å–∏–º—É–º 3 —Ö–æ–¥–∞, –º–∞–∫—Å–∏–º—É–º 3 —Å–º–∞–π–ª–∏–∫–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ!
  function getEliminationPlan(participantCount) {
    if (participantCount === 2) return [1]; // 1 —Ö–æ–¥: —Ñ–∏–Ω–∞–ª —Å—Ä–∞–∑—É
    if (participantCount === 3) return [2, 1]; // 2 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 1, –ø–æ—Ç–æ–º 1
    if (participantCount === 4) return [2, 1]; // 2 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 2, –ø–æ—Ç–æ–º 1
    if (participantCount === 5) return [2, 1]; // 2 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 3, –ø–æ—Ç–æ–º 1
    if (participantCount === 6) return [3, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 3, 1, 1
    if (participantCount === 7) return [4, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 3, 2, 1
    if (participantCount === 8) return [4, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 4, 2, 1
    if (participantCount === 9) return [4, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 5, 2, 1
    if (participantCount === 10) return [6, 3, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 4, 3, 2
    if (participantCount === 11) return [5, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 6, 3, 1
    if (participantCount === 12) return [6, 2, 1]; // 3 —Ö–æ–¥–∞: –≤—ã–±—ã–≤–∞–µ—Ç 6, 4, 1

    // –î–ª—è 13-20: –í–°–ï–ì–î–ê 3 —Ö–æ–¥–∞ (–ø–µ—Ä–≤—ã–π —É–±–∏—Ä–∞–µ—Ç –ø–æ–ª–æ–≤–∏–Ω—É, –ø–æ—Å–ª–µ–¥–Ω–∏–π - —Ñ–∏–Ω–∞–ª)
    const firstRoundRemaining = Math.ceil(participantCount / 2);

    // –í—Ç–æ—Ä–æ–π —Ä–∞—É–Ω–¥ –æ—Å—Ç–∞–≤–ª—è–µ—Ç 2-3 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    const secondRoundRemaining = firstRoundRemaining <= 4 ? 2 : 3;

    return [firstRoundRemaining, secondRoundRemaining, 1];
  }

  function getTurnsCount(participantCount) {
    return getEliminationPlan(participantCount).length;
  }

  let names = ['–£—á–∞—Å—Ç–Ω–∏–∫ 1','–£—á–∞—Å—Ç–Ω–∏–∫ 2','–£—á–∞—Å—Ç–Ω–∏–∫ 3'];
  let probabilities = {};
  let lockedParticipants = {};
  let hasCustomProbabilities = false;
  let editingLocked = false;
  let isLoading = false;

  const namesList = document.getElementById('namesList');
  const newNameInput = document.getElementById('newNameInput');
  const addNameBtn = document.getElementById('addNameBtn');
  const startBtn = document.getElementById('startBtn');
  const errorMessage = document.getElementById('errorMessage');
  const gameField = document.getElementById('gameField');
  const equalizeBtn = document.getElementById('equalizeBtn');
  const collapseBtn = document.getElementById('collapseBtn');
  const collapseIcon = document.getElementById('collapseIcon');
  const namesListWrapper = document.getElementById('namesListWrapper');

  const defaultNewNamePlaceholder = '–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫';

  function setEditingEnabled(enabled) {
    editingLocked = !enabled;

    if (newNameInput) newNameInput.disabled = !enabled;
    if (addNameBtn) addNameBtn.disabled = !enabled;
    if (equalizeBtn) equalizeBtn.disabled = !enabled;

    const nameInputs = document.querySelectorAll('.name-input');
    nameInputs.forEach(el => el.disabled = !enabled);

    const probInputs = document.querySelectorAll('.probability-input');
    probInputs.forEach(el => el.disabled = !enabled);

    const probBtns = document.querySelectorAll('.prob-btn');
    probBtns.forEach(el => el.disabled = !enabled);

    const removeBtns = document.querySelectorAll('.remove-btn');
    removeBtns.forEach(el => el.disabled = !enabled);
  }

  function resetNewNamePlaceholder() {
    newNameInput.placeholder = defaultNewNamePlaceholder;

    if (!newNameInput.value.trim()) {
      newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
      newNameInput.style.background = 'rgba(255,255,255,0.1)';
    }
  }

  newNameInput.addEventListener('focus', resetNewNamePlaceholder);
  newNameInput.addEventListener('click', resetNewNamePlaceholder);

  function showErrorTooltip(message) {
    const existing = document.querySelector('.probability-error-tooltip');
    if (existing) existing.remove();

    const tooltip = document.createElement('div');
    tooltip.className = 'probability-error-tooltip';
    tooltip.textContent = message;
    document.body.appendChild(tooltip);

    setTimeout(() => {
      tooltip.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
      tooltip.style.opacity = '0';
      tooltip.style.transform = 'translate(-50%, -50%) scale(0.8)';
      setTimeout(() => tooltip.remove(), 300);
    }, 2000);
  }

  function clearErrorMessage() {
    if (errorMessage) errorMessage.textContent = '';
  }

  function saveState() {
    if (isLoading) return;
    try {
      localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      const cleanP = {};
      names.forEach((nm) => cleanP[nm] = probabilities[nm] ?? 0);
      const cleanLocked = {};
      names.forEach((nm) => { if (lockedParticipants[nm]) cleanLocked[nm] = true; });
      localStorage.setItem(PROB_KEY, JSON.stringify({
        probabilities: cleanP,
        hasCustomProbabilities
      }));
      localStorage.setItem(LOCKED_KEY, JSON.stringify(cleanLocked));
    } catch (e) {}
  }

  newNameInput.addEventListener('keydown', (e) => {
    if (newNameInput.value.length >= 15 &&
        !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'].includes(e.key) &&
        !e.ctrlKey && !e.metaKey) {

      newNameInput.style.borderColor = '#ef4444';
      newNameInput.style.background = 'rgba(239,68,68,0.1)';
      showErrorTooltip('–ù–µ –±–æ–ª–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
    }
  });

  function loadState() {
    isLoading = true;
    try {
      const savedNames = JSON.parse(localStorage.getItem(NAMES_KEY) || '[]');
      if (Array.isArray(savedNames) && savedNames.length >= MIN_PARTICIPANTS) {
        names = savedNames.slice(0, MAX_PARTICIPANTS);
      }
    } catch (e) {
    }

    try {
      const saved = JSON.parse(localStorage.getItem(PROB_KEY) || '{}');
      const savedLocked = JSON.parse(localStorage.getItem(LOCKED_KEY) || '{}');

      if (saved?.hasCustomProbabilities && saved?.probabilities && Object.keys(saved.probabilities).length) {
        probabilities = {};
        lockedParticipants = {};

        names.forEach((n) => {
          const raw = saved.probabilities[n];
          if (typeof raw === 'number' && !isNaN(raw)) {
            probabilities[n] = Math.max(MIN_PROBABILITY, raw);
          }
          if (savedLocked && savedLocked[n]) {
            lockedParticipants[n] = true;
          }
        });

        hasCustomProbabilities = true;

        names.forEach((n) => { if (!(n in probabilities)) probabilities[n] = MIN_PROBABILITY; });

        normalizeProbabilities({ skipSave: true, skipRender: true });
      } else {
        equalizeProbabilities({ skipSave: true, skipRender: true });
      }
    } catch (e) {
      equalizeProbabilities({ skipSave: true, skipRender: true });
    }
    isLoading = false;
  }

  function equalizeProbabilities(options = {}) {
    const { skipSave = false, skipRender = false } = options;
    const count = Math.max(1, names.length);
    const p = 1 / count;
    probabilities = {};
    lockedParticipants = {};
    hasCustomProbabilities = false;
    names.forEach((n) => {
      probabilities[n] = p;
    });
    if (!skipSave) saveState();
    if (!skipRender) {
      renderParticipants();
      validateAllNames();
    }
  }

  function getPercent(name) {
    const n = Math.max(1, names.length);
    let value = name in probabilities ? probabilities[name] : (1 / n);

    const min = MIN_PROBABILITY;
    const max = getRealisticMaxPercent(name) / 100;

    value = Math.min(Math.max(value, min), max || 1);

    return (value * 100).toFixed(1);
  }

  function getRealisticMaxPercent(name) {
    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);

    const otherLockedSum = otherLocked.reduce(
      (s, nm) => s + (probabilities[nm] || 0),
      0
    );

    const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;

    const rawMax = (1 - otherLockedSum - minUnlockedTotal) * 100;

    const rounded = Math.round(rawMax * 10) / 10;

    return Math.max(5, Math.min(100, rounded));
  }

  function normalizeProbabilities(options = {}) {
    const { skipSave = false, skipRender = false } = options;
    if (!hasCustomProbabilities) {
      const exact = 1 / (names.length || 1);
      names.forEach((nm) => probabilities[nm] = exact);
      return;
    }

    const locked = names.filter(n => lockedParticipants[n]);
    const unlocked = names.filter(n => !lockedParticipants[n]);

    if (unlocked.length === 0) {
      const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      if (sum > 0 && Math.abs(sum - 1) > 1e-4) {
        const k = 1 / sum;
        names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
      }

      const hasViolation = names.some(nm => (probabilities[nm] ?? 0) < (MIN_PROBABILITY - 0.001));
      if (hasViolation) {
        equalizeProbabilities({ skipSave, skipRender });
      }
      return;
    }

    const lockedSum = locked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);

    const minUnlockedTotal = unlocked.length * MIN_PROBABILITY;
    const remainForUnlocked = 1 - lockedSum;

    const lockedViolation = locked.some(nm => (probabilities[nm] ?? 0) < (MIN_PROBABILITY - 0.001));

    if (lockedViolation || remainForUnlocked < minUnlockedTotal - 0.001 || lockedSum > 1.001) {
      equalizeProbabilities({ skipSave, skipRender });
      return;
    }

    const sharePerUnlocked = remainForUnlocked / unlocked.length;
    unlocked.forEach(nm => probabilities[nm] = sharePerUnlocked);

    const finalViolation = names.some(nm => (probabilities[nm] ?? 0) < (MIN_PROBABILITY - 0.001));
    if (finalViolation) {
      equalizeProbabilities({ skipSave, skipRender });
    }
    if (!skipSave) saveState();
    if (!skipRender) {
      renderParticipants();
      validateAllNames();
    }
  }

  function setProbabilityManually(name, percentValue) {
    const maxPossible = getRealisticMaxPercent(name);

    if (isNaN(percentValue) || percentValue < MIN_PROBABILITY * 100 || percentValue > maxPossible + 0.2) {
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${maxPossible.toFixed(1)}%`);
      return false;
    }

    hasCustomProbabilities = true;
    lockedParticipants[name] = true;
    probabilities[name] = percentValue / 100;

    normalizeProbabilities();
    saveState();
    resetNewNamePlaceholder();

    return true;
  }

  function changeProbability(name, delta) {
    const cur = parseFloat(getPercent(name)) || 0;
    const maxPossible = 100 - (names.length - 1) * (MIN_PROBABILITY * 100);
    const next = Math.max(MIN_PROBABILITY * 100, Math.min(maxPossible, cur + delta));

    if (Math.abs(next - cur) < 0.01) {
      const realisticMax = getRealisticMaxPercent(name);
      if (delta > 0) {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º: ${realisticMax.toFixed(1)}%`);
      } else {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∏–Ω–∏–º—É–º: ${(MIN_PROBABILITY * 100).toFixed(1)}%`);
      }
      return;
    }

    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
    const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
    const newProbForThis = next / 100;
    const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
    const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;

    if (remainForUnlocked < minUnlockedTotal - 0.001) {
      const realisticMax = getRealisticMaxPercent(name);
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
      return;
    }

    setProbabilityManually(name, next);
    renderParticipants();
  }

  function validateProbabilities() {
    if (!names.length) return false;

    let sum = 0;
    for (const n of names) {
      const p = probabilities[n] || 0;
      if (p < MIN_PROBABILITY - 1e-6) {
        showErrorTooltip(
          `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ‚Äî ${(MIN_PROBABILITY * 100).toFixed(1)}%`
        );
        return false;
      }
      sum += p;
    }

    if (Math.abs(sum - 1) > 0.001) {
      showErrorTooltip(
        `–°—É–º–º–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100% (—Å–µ–π—á–∞—Å ${(sum * 100).toFixed(1)}%)`
      );
      return false;
    }

    clearErrorMessage();
    return true;
  }

  function validateAllNames() {
    let allValid = true;

    const nameInputs = namesList.querySelectorAll('.name-input');
    nameInputs.forEach(input => {
      const value = input.value.trim();
      if (!value || value.length === 0 || value.length > 15) {
        allValid = false;
      }
    });

    if (startBtn) {
      startBtn.disabled = !allValid;
    }

    return allValid;
  }

  function removeParticipant(idx) {
    if (names.length <= MIN_PARTICIPANTS) {
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${MIN_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–∞!`);
      return;
    }

    const name = names[idx];
    names.splice(idx, 1);
    delete probabilities[name];
    delete lockedParticipants[name];

    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();
  }

  function addNewParticipant() {
    const newName = newNameInput.value.trim();

    if (!newName) {
      newNameInput.classList.add('error-state');
      newNameInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
      return;
    }

    if (newName.length > 15) {
      showErrorTooltip('–ú–∞–∫—Å–∏–º—É–º 15 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∏');
      return;
    }

    if (names.some((n) => n.toLowerCase() === newName.toLowerCase())) {
      showErrorTooltip('–≠—Ç–æ –∏–º—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!');
      return;
    }

    if (names.length >= MAX_PARTICIPANTS) {
      showErrorTooltip(`–ú–∞–∫—Å–∏–º—É–º ${MAX_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!`);
      return;
    }

    names.push(newName);
    probabilities[newName] = MIN_PROBABILITY;
    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();

    newNameInput.value = '';
    resetNewNamePlaceholder();
    clearErrorMessage();
  }

  if (addNameBtn) {
    addNameBtn.addEventListener('click', addNewParticipant);
  }

  if (equalizeBtn) {
    equalizeBtn.addEventListener('click', equalizeProbabilities);
  }

  if (newNameInput) {
    newNameInput.addEventListener('input', () => {
      const v = newNameInput.value.trim();

      if (!v) {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
        return;
      }

      const dup = names.some((n) => n.toLowerCase() === v.toLowerCase());
      if (dup || v.length > 15) {
        newNameInput.style.borderColor = '#ef4444';
        newNameInput.style.background = 'rgba(239,68,68,0.1)';
        newNameInput.classList.add('error-state');
      } else {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
      }
    });

    newNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addNewParticipant();
      }
    });

    newNameInput.addEventListener('focus', () => {
      resetNewNamePlaceholder();
      newNameInput.style.borderColor = 'rgba(255,255,255,0.5)';
      newNameInput.style.background = 'rgba(255,255,255,0.2)';
      clearErrorMessage();
    });
  }

  function renderParticipants() {
    namesList.innerHTML = '';

    names.forEach((name, idx) => {
      const row = document.createElement('div');
      row.className = 'name-item';

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'name-input';
      input.value = name;
      input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
      input.maxLength = 15;
      input.disabled = editingLocked;

      input.addEventListener('keydown', (e) => {
        if (
          input.value.length >= 15 &&
          !['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Home','End'].includes(e.key) &&
          !e.ctrlKey && !e.metaKey
        ) {
          showErrorTooltip('–ù–µ –±–æ–ª–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          setTimeout(() => {
            if (input.value.trim() && !names.some((n, i) => i !== idx && n.toLowerCase() === input.value.trim().toLowerCase())) {
              input.style.borderColor = 'rgba(255,255,255,0.2)';
              input.style.background = 'rgba(255,255,255,0.1)';
            }
          }, 1500);
        }
      });

      input.addEventListener('input', () => {
        const v = input.value.trim();

        if (!v) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
        } else {
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
        }

        validateAllNames();
      });

      input.addEventListener('blur', () => {
        const v = input.value.trim();

        if (!v) {
          input.value = name;
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.value = names[idx];
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          showErrorTooltip('–ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤!');
          validateAllNames();
          return;
        }

        const oldName = names[idx];
        if (v !== oldName) {
          names[idx] = v;

          if (probabilities[oldName] !== undefined) {
            probabilities[v] = probabilities[oldName];
            delete probabilities[oldName];
          }

          if (lockedParticipants[oldName]) {
            lockedParticipants[v] = true;
            delete lockedParticipants[oldName];
          }

          saveState();
        }

        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.2)';
        input.style.background = 'rgba(255,255,255,0.1)';
        input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
        validateAllNames();
      });

      input.addEventListener('focus', () => {
        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.5)';
        input.style.background = 'rgba(255,255,255,0.2)';
        clearErrorMessage();
      });

      const probControls = document.createElement('div');
      probControls.className = 'probability-controls';

      const minusBtn = document.createElement('button');
      minusBtn.className = 'prob-btn';
      minusBtn.textContent = '‚àí';
      minusBtn.disabled = editingLocked;
      minusBtn.onclick = () => {
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, -1);
      };

      const probInput = document.createElement('input');
      probInput.type = 'text';
      probInput.className = 'probability-input';
      probInput.setAttribute('inputmode', 'decimal');
      probInput.setAttribute('aria-label', '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö');
      probInput.value = getPercent(name);
      probInput.disabled = editingLocked;

      if (lockedParticipants[name]) {
        probInput.classList.add('manual');
      }

      let lastValid = probInput.value;

      probInput.addEventListener('focus', () => {
        probInput.value = probInput.value.replace('%', '');
        lastValid = probInput.value;
        clearErrorMessage();
      });

      probInput.addEventListener('input', () => {
        probInput.value = probInput.value.replace(',', '.');
        let val = probInput.value.replace('%', '').trim();

        if (val.includes('.')) {
          const parts = val.split('.');
          if (parts[1] && parts[1].length > 2) {
            val = parts[0] + '.' + parts[1].substring(0, 2);
            probInput.value = val;
          }
        }

        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        if (val === '') {
          probInput.classList.remove('error');
        } else if (isNaN(num) || num < MIN_PROBABILITY * 100 || num > 100 || num > maxAllowed) {
          probInput.classList.add('error');
        } else {
          probInput.classList.remove('error');
        }
      });

      probInput.addEventListener('blur', () => {
        const val = probInput.value.replace('%', '').trim();
        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        if (val === '' || isNaN(num) || num < MIN_PROBABILITY * 100 || num > maxAllowed) {
          probInput.value = lastValid;
          probInput.classList.remove('error');

          if (!isNaN(num) && (num < MIN_PROBABILITY * 100 || num > maxAllowed)) {
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${maxAllowed.toFixed(1)}%`);
          }
        } else {
          const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
          const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
          const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
          const newProbForThis = num / 100;
          const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
          const minUnlockedTotal = willBeUnlocked.length * MIN_PROBABILITY;

          if (remainForUnlocked < minUnlockedTotal - 0.001) {
            probInput.value = lastValid;
            probInput.classList.remove('error');

            const realisticMax = getRealisticMaxPercent(name);
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${(MIN_PROBABILITY * 100).toFixed(1)}%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
          } else if (setProbabilityManually(name, num)) {
            lastValid = getPercent(name);
            renderParticipants();
          } else {
            probInput.value = lastValid;
            probInput.classList.remove('error');
          }
        }
      });

      probInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          probInput.blur();
        }
        if (!/[\d.,]/.test(e.key) && e.key !== 'Enter') e.preventDefault();
      });

      const plusBtn = document.createElement('button');
      plusBtn.className = 'prob-btn';
      plusBtn.textContent = '+';
      plusBtn.disabled = editingLocked;
      plusBtn.onclick = () => {
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, 1);
      };

      probControls.appendChild(minusBtn);
      probControls.appendChild(probInput);
      probControls.appendChild(plusBtn);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.disabled = editingLocked;
      removeBtn.onclick = () => removeParticipant(idx);

      row.appendChild(input);
      row.appendChild(probControls);
      row.appendChild(removeBtn);

      namesList.appendChild(row);
    });

    validateAllNames();
  }

  // ===== –ö–ù–û–ü–ö–ê "–°–í–ï–†–ù–£–¢–¨" –°–ü–ò–°–ö–ê =====
  let listCollapsed = false;

  if (collapseBtn) {
    collapseBtn.addEventListener('click', () => {
      listCollapsed = !listCollapsed;
      namesListWrapper.classList.toggle('collapsed', listCollapsed);
      collapseIcon.textContent = listCollapsed ? '‚ñ≤' : '‚ñº';
    });
  }

  // ===== DESKTOP MENU =====
  const desktopMenuToggle = document.getElementById('desktopMenuToggle');
  const desktopDropdown = document.getElementById('desktopDropdown');

  let desktopMenuOpen = false;

  function toggleDesktopMenu() {
    desktopMenuOpen = !desktopMenuOpen;
    desktopDropdown.classList.toggle('active', desktopMenuOpen);
    desktopMenuToggle.classList.toggle('active', desktopMenuOpen);
  }

  if (desktopMenuToggle) {
    desktopMenuToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleDesktopMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        desktopMenuOpen &&
        !desktopDropdown.contains(e.target) &&
        !desktopMenuToggle.contains(e.target)
      ) {
        toggleDesktopMenu();
      }
    });
  }

  // ===== BURGER MENU (MOBILE) =====
  const burgerBtn = document.getElementById('burgerBtn');
  const menuDropdown = document.getElementById('menuDropdown');
  let menuOpen = false;

  function toggleMenu() {
    menuOpen = !menuOpen;
    menuDropdown.classList.toggle('active', menuOpen);
    burgerBtn.classList.toggle('active', menuOpen);
  }

  if (burgerBtn) {
    burgerBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        menuOpen &&
        !menuDropdown.contains(e.target) &&
        !burgerBtn.contains(e.target)
      ) {
        toggleMenu();
      }
    });
  }


  // ===== BINGO –ò–ì–†–û–í–ê–Ø –õ–û–ì–ò–ö–ê =====

  let gameState = null;
  let gameInterval = null;

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Å–º–∞–π–ª–∏–∫–æ–≤ –¥–ª—è –∫–∞—Ä—Ç–æ—á–∫–∏
  function generateUniqueEmojis(count, availableEmojis) {
    const emojis = [];
    const pool = [...availableEmojis];

    while (emojis.length < count && pool.length > 0) {
      const randomIndex = Math.floor(Math.random() * pool.length);
      emojis.push(pool[randomIndex]);
      pool.splice(randomIndex, 1);
    }

    return emojis;
  }

  // –ü–µ—Ä–µ–º–µ—à–∞—Ç—å –º–∞—Å—Å–∏–≤
  function shuffleArray(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ —Å–º–∞–π–ª–∏–∫–∞
  function getRemainingParticipants(lastEmoji, participants) {
    return participants.filter(p => p.card.includes(lastEmoji) && !p.eliminated);
  }

  // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—ã–±—ã–≤–∞–Ω–∏–µ —Å –∫–æ–Ω—Ç—Ä–æ–ª–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –≤—ã–±—ã–≤—à–∏—Ö
  function generateEliminationSequence(participants, eliminationPlan) {
    // –í—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º
    const rand = Math.random();
    let cumulative = 0;
    let chosenWinner = null;

    for (const participant of participants) {
      cumulative += participant.probability;
      if (rand <= cumulative) {
        chosenWinner = participant;
        break;
      }
    }

    if (!chosenWinner) {
      chosenWinner = participants[participants.length - 1];
    }

    const turnsCount = eliminationPlan.length;
    const sequence = [];

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ —Å–º–∞–π–ª–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞
    for (let turn = 0; turn < turnsCount; turn++) {
      let emoji;
      do {
        emoji = EMOJI_POOL[Math.floor(Math.random() * EMOJI_POOL.length)];
      } while (sequence.includes(emoji));

      sequence.push(emoji);
    }

    return { sequence, chosenWinner };
  }

  // –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–º–∞–π–ª–∏–∫–æ–≤ - –ø–æ–±–µ–¥–∏—Ç–µ–ª—å –≤—ã–±—Ä–∞–Ω –∑–∞—Ä–∞–Ω–µ–µ, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª–µ–Ω
  function distributeEmojisToCards(participants, eliminationPlan, sequenceData) {
    const { sequence, chosenWinner } = sequenceData;
    const turnsCount = sequence.length;
    const participantCount = participants.length;

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—É–ª –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Å–º–∞–π–ª–∏–∫–æ–≤
    const allEmojis = [...sequence];
    const additionalCount = Math.max(turnsCount * 3, participantCount * 2);

    for (let i = 0; i < additionalCount; i++) {
      let emoji;
      do {
        emoji = EMOJI_POOL[Math.floor(Math.random() * EMOJI_POOL.length)];
      } while (allEmojis.includes(emoji));
      allEmojis.push(emoji);
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—É—Å—Ç—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
    participants.forEach(p => p.card = []);

    if (turnsCount === 1) {
      // 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞, 1 —Å–º–∞–π–ª–∏–∫
      participants.forEach((p, idx) => {
        if (p === chosenWinner) {
          p.card = [sequence[0]];
        } else {
          p.card = [allEmojis[turnsCount + idx]];
        }
      });
    } else if (turnsCount === 2) {
      // 3-5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, 2 —Å–º–∞–π–ª–∏–∫–∞
      // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–º–µ–µ—Ç –û–ë–ê –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–º–∞–π–ª–∏–∫–∞
      chosenWinner.card = [...sequence];

      // –û—Å—Ç–∞–ª—å–Ω—ã–µ: –∫–∞–∂–¥—ã–π –∏–º–µ–µ—Ç –æ–¥–∏–Ω –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–∏—Ö + –æ–¥–∏–Ω —É–Ω–∏–∫–∞–ª—å–Ω—ã–π
      const others = participants.filter(p => p !== chosenWinner);

      others.forEach((p, idx) => {
        // –ß–µ—Ä–µ–¥—É–µ–º: –∫—Ç–æ-—Ç–æ –∏–º–µ–µ—Ç –ø–µ—Ä–≤—ã–π —Å–º–∞–π–ª–∏–∫, –∫—Ç–æ-—Ç–æ –≤—Ç–æ—Ä–æ–π
        const winningEmoji = sequence[idx % 2];
        const uniqueEmoji = allEmojis[turnsCount + idx];
        p.card = shuffleArray([winningEmoji, uniqueEmoji]);
      });
    } else {
      // 6-20 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, 3 —Å–º–∞–π–ª–∏–∫–∞
      // –ü–æ–±–µ–¥–∏—Ç–µ–ª—å –∏–º–µ–µ—Ç –í–°–ï 3 –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–º–∞–π–ª–∏–∫–∞
      chosenWinner.card = shuffleArray([...sequence]);

      const others = participants.filter(p => p !== chosenWinner);

      others.forEach((p, idx) => {
        // –ö–∞–∂–¥—ã–π –∏–º–µ–µ—Ç 2 –∏–∑ 3 –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–º–∞–π–ª–∏–∫–æ–≤ + –≤–æ–∑–º–æ–∂–Ω–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ä–∞–∑–Ω—ã–µ —Å–º–∞–π–ª–∏–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
        const skipIndex = idx % 3;
        const card = [];

        // –î–æ–±–∞–≤–ª—è–µ–º 2 –≤—ã–ø–∞–¥–∞—é—â–∏—Ö —Å–º–∞–π–ª–∏–∫–∞ (–ø—Ä–æ–ø—É—Å–∫–∞—è –æ–¥–∏–Ω)
        for (let i = 0; i < 3; i++) {
          if (i !== skipIndex) {
            card.push(sequence[i]);
          }
        }

        // –î–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Å–º–∞–π–ª–∏–∫
        card.push(allEmojis[turnsCount + idx]);

        // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ 3 –∏–∑ —ç—Ç–∏—Ö 4
        p.card = shuffleArray(card).slice(0, 3);
      });
    }

    // –§–∏–Ω–∞–ª—å–Ω–æ–µ –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–Ω–∏–µ –ø–æ—Ä—è–¥–∫–∞ –≤ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö
    participants.forEach(p => {
      p.card = shuffleArray(p.card);
    });
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
  function initBingoGame(participantNames, participantProbabilities) {
    const eliminationPlan = getEliminationPlan(participantNames.length);
    const turnsCount = eliminationPlan.length;

    // –°–æ–∑–¥–∞–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –ø—É—Å—Ç—ã–º–∏ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
    const participants = participantNames.map((name, index) => {
      return {
        id: index,
        name: name,
        probability: participantProbabilities[name] || 0,
        card: [],
        eliminated: false
      };
    });

    // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –≤—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
    const sequenceData = generateEliminationSequence(participants, eliminationPlan);

    // –†–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ–º —Å–º–∞–π–ª–∏–∫–∏ –ø–æ –∫–∞—Ä—Ç–æ—á–∫–∞–º —Å–æ–≥–ª–∞—Å–Ω–æ –ø–ª–∞–Ω—É
    distributeEmojisToCards(participants, eliminationPlan, sequenceData);

    return {
      participants,
      drawnSequence: sequenceData.sequence,
      currentTurn: 0,
      winner: null,
      isGameOver: false,
      turnsCount,
      eliminationPlan
    };
  }

  // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
  function renderBingoGame(state) {
    gameField.innerHTML = `
      <div class="bingo-container">
        <div class="bingo-timer" id="bingoTimer"></div>
        <div class="bingo-status-bar">
          <div class="bingo-numbers-display" id="numbersDisplay"></div>
        </div>

        <div class="bingo-cards-grid" id="bingoCardsGrid"></div>
      </div>
    `;

    const cardsGrid = document.getElementById('bingoCardsGrid');
    state.participants.forEach((participant, index) => {
      const card = document.createElement('div');
      card.className = 'bingo-card';
      card.id = `card-${participant.id}`;
      card.style.animationDelay = `${index * 0.1}s`;

      card.innerHTML = `
        <div class="bingo-card-header">
          <div class="bingo-card-icon">üë§</div>
          <div class="bingo-card-name">${participant.name}</div>
        </div>
        <div class="bingo-card-numbers">
          ${participant.card.map((emoji) => `
            <div class="bingo-number" data-emoji="${emoji}">
              ${emoji}
            </div>
          `).join('')}
        </div>
      `;

      cardsGrid.appendChild(card);
    });
  }

  // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –ø–æ—Å–ª–µ —Ö–æ–¥–∞
  function updateBingoAfterTurn(state) {
    const numbersDisplay = document.getElementById('numbersDisplay');

    if (state.currentTurn > 0 && numbersDisplay) {
      const lastEmoji = state.drawnSequence[state.currentTurn - 1];

      // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å current —É –≤—Å–µ—Ö –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–º–∞–π–ª–∏–∫–æ–≤
      const allEmojis = numbersDisplay.querySelectorAll('.bingo-drawn-number');
      allEmojis.forEach(emoji => emoji.classList.remove('current'));

      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–π —Å–º–∞–π–ª–∏–∫
      const emojiEl = document.createElement('div');
      emojiEl.className = 'bingo-drawn-number current new';
      emojiEl.textContent = lastEmoji;
      numbersDisplay.appendChild(emojiEl);

      // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å new –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
      setTimeout(() => {
        emojiEl.classList.remove('new');
      }, 500);

      // –°–∫—Ä–æ–ª–ª–∏–º –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–º–∞–π–ª–∏–∫—É
      setTimeout(() => {
        numbersDisplay.scrollLeft = numbersDisplay.scrollWidth;
      }, 100);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫—Ç–æ –æ—Å—Ç–∞–µ—Ç—Å—è –≤ –∏–≥—Ä–µ
      const remaining = getRemainingParticipants(lastEmoji, state.participants);

      state.participants.forEach(participant => {
        const cardEl = document.getElementById(`card-${participant.id}`);
        if (!cardEl) return;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤—ã–±—ã–≤–∞–Ω–∏–µ
        if (!participant.eliminated) {
          if (!participant.card.includes(lastEmoji)) {
            // –£—á–∞—Å—Ç–Ω–∏–∫ –≤—ã–±—ã–≤–∞–µ—Ç
            participant.eliminated = true;
            setTimeout(() => {
              cardEl.classList.add('eliminated');
              cardEl.classList.remove('active');
            }, 1000);
          } else {
            // –£—á–∞—Å—Ç–Ω–∏–∫ –æ—Å—Ç–∞–µ—Ç—Å—è - –ø–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º —Å–º–∞–π–ª–∏–∫
            const emojiEl = cardEl.querySelector(`[data-emoji="${lastEmoji}"]`);
            if (emojiEl) {
              emojiEl.classList.add('matched');
            }

            cardEl.classList.add('active');
            setTimeout(() => {
              cardEl.classList.remove('active');
            }, 1500);
          }
        }
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏ –¥—Ä–∞–º–∞—Ç–∏—á–Ω–∞—è –ø–∞—É–∑–∞
      setTimeout(() => {
        const stillInGame = state.participants.filter(p => !p.eliminated);

        // –î–†–ê–ú–ê: –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–∞ 2 —Å–µ–∫—É–Ω–¥—ã
        if (stillInGame.length > 1) {
          stillInGame.forEach(p => {
            const cardEl = document.getElementById(`card-${p.id}`);
            if (cardEl) {
              cardEl.classList.add('survived');
            }
          });

          // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥—ã
          setTimeout(() => {
            stillInGame.forEach(p => {
              const cardEl = document.getElementById(`card-${p.id}`);
              if (cardEl) {
                cardEl.classList.remove('survived');
              }
            });
          }, 2000);
        }

        if (stillInGame.length === 1) {
          state.winner = stillInGame[0];
          state.isGameOver = true;

          const winnerCard = document.getElementById(`card-${state.winner.id}`);
          if (winnerCard) {
            winnerCard.classList.add('winner');
            winnerCard.classList.remove('active');
          }

          // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å current —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–º–∞–π–ª–∏–∫–∞
          if (numbersDisplay) {
            const allEmojis = numbersDisplay.querySelectorAll('.bingo-drawn-number');
            allEmojis.forEach(emoji => emoji.classList.remove('current'));
          }

          if (gameInterval) {
            clearInterval(gameInterval);
            gameInterval = null;
          }

          // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å—Ä–∞–∑—É
          showWinnerAnnouncement(state.winner.name);
          startBtn.disabled = false;
          startBtn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ';
          setEditingEnabled(true);
        }
      }, 1500);
    }
  }

  // –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
  function showWinnerAnnouncement(winnerName) {
    document.body.classList.add('shake');
    setTimeout(() => document.body.classList.remove('shake'), 500);

    createConfetti();
    createCelebrationEmojis();

    const announcement = document.createElement('div');
    announcement.className = 'winner-announcement show';
    announcement.innerHTML = `
      <h2>
        <span class="winner-emoji">üéâ</span> –ë–ò–ù–ì–û! <span class="winner-emoji">üéâ</span>
        <span class="winner-name">${winnerName}</span>
      </h2>
    `;
    document.body.appendChild(announcement);

    setTimeout(() => {
      announcement.classList.remove('show');
      setTimeout(() => announcement.remove(), 500);
    }, 4000);
  }

  // –°–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
  function createConfetti() {
    const colors = ['#667eea', '#764ba2', '#ffd43b', '#22c55e', '#ef4444', '#f59e0b'];
    for (let i = 0; i < 100; i++) {
      setTimeout(() => {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = Math.random() * 100 + 'vw';
        confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
        confetti.style.animationDelay = (Math.random() * 0.5) + 's';
        document.body.appendChild(confetti);

        setTimeout(() => confetti.remove(), 4000);
      }, i * 20);
    }
  }

  // –°–æ–∑–¥–∞—Ç—å –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ —ç–º–æ–¥–∑–∏
  function createCelebrationEmojis() {
    const emojis = ['üéâ', 'üéä', '‚ú®', 'üé±', 'üèÜ', '‚≠ê'];
    for (let i = 0; i < 20; i++) {
      setTimeout(() => {
        const emoji = document.createElement('div');
        emoji.className = 'celebration-emoji';
        emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
        emoji.style.left = Math.random() * 100 + 'vw';
        emoji.style.top = Math.random() * 100 + 'vh';
        document.body.appendChild(emoji);

        setTimeout(() => emoji.remove(), 3000);
      }, i * 150);
    }
  }

  // –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
  function playBingoTurn(state) {
    if (state.currentTurn >= state.drawnSequence.length || state.isGameOver) {
      if (gameInterval) {
        clearInterval(gameInterval);
        gameInterval = null;
      }
      startBtn.disabled = false;
      startBtn.textContent = '–ó–∞–ø—É—Å—Ç–∏—Ç—å –∑–∞–Ω–æ–≤–æ';
      setEditingEnabled(true);
      return;
    }

    state.currentTurn++;
    updateBingoAfterTurn(state);
  }

  // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
  function startBingoGame() {
    if (names.length < MIN_PARTICIPANTS) {
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º ${MIN_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–∞!`);
      return;
    }

    if (names.length > MAX_PARTICIPANTS) {
      showErrorTooltip(`–ú–∞–∫—Å–∏–º—É–º ${MAX_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!`);
      return;
    }

    if (!validateAllNames()) {
      showErrorTooltip('–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!');
      return;
    }

    if (!validateProbabilities()) {
      return;
    }

    gameState = initBingoGame(names, probabilities);
    renderBingoGame(gameState);

    startBtn.disabled = true;
    startBtn.textContent = '–ò–≥—Ä–∞ –∏–¥—ë—Ç...';
    setEditingEnabled(false);

    // –î–∞—ë–º –≤—Ä–µ–º—è –Ω–∞ –∞–Ω–∏–º–∞—Ü–∏—é —Ä–∞–∑–¥–∞—á–∏ –∫–∞—Ä—Ç–æ—á–µ–∫ + –ø–∞—É–∑–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º —Ä–∞—É–Ω–¥–æ–º
    const animationTime = gameState.participants.length * 100 + 500;
    setTimeout(() => {
      playNextRound(gameState, true);
    }, animationTime);
  }

  // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Ä–∞—É–Ω–¥–∞ —Å —Ç–∞–π–º–µ—Ä–æ–º
  function playNextRound(state, isFirstRound = false) {
    if (state.isGameOver) return;

    // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º —Ä–∞—É–Ω–¥–æ–º (–∫–∞–∫ –±—ã–ª–æ —Ä–∞–Ω—å—à–µ)
    const delay = isFirstRound ? 1500 : 0;

    setTimeout(() => {
      // –ò–≥—Ä–∞–µ–º —Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥
      playBingoTurn(state);

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–µ–Ω –ª–∏ —Ç–∞–π–º–µ—Ä
      // –¢–∞–π–º–µ—Ä –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥
      // (—Ç–µ–∫—É—â–∏–π —Ä–∞—É–Ω–¥ < –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–∞—É–Ω–¥–æ–≤)
      const willHaveNextRound = state.currentTurn < state.drawnSequence.length;

      // –ï—Å–ª–∏ –∏–≥—Ä–∞ –Ω–µ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å –ò –±—É–¥–µ—Ç —Å–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥, –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä
      if (!state.isGameOver && willHaveNextRound) {
        startRoundTimer(3, () => {
          playNextRound(state);
        });
      }
    }, delay);
  }

  // –¢–∞–π–º–µ—Ä –æ–±—Ä–∞—Ç–Ω–æ–≥–æ –æ—Ç—Å—á–µ—Ç–∞
  function startRoundTimer(seconds, callback) {
    const timerEl = document.getElementById('bingoTimer');
    if (!timerEl) return;

    let remaining = seconds;

    const updateTimer = () => {
      if (remaining > 0) {
        timerEl.innerHTML = `–°–ª–µ–¥—É—é—â–∏–π —Ä–∞—É–Ω–¥ —á–µ—Ä–µ–∑ <span class="countdown">${remaining}</span>`;
        timerEl.classList.add('visible');
        remaining--;
        setTimeout(updateTimer, 1000);
      } else {
        timerEl.classList.remove('visible');
        setTimeout(() => {
          timerEl.innerHTML = '';
          callback();
        }, 300);
      }
    };

    updateTimer();
  }

  // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–ó–ê–ü–£–°–¢–ò–¢–¨" =====
  if (startBtn) {
    startBtn.addEventListener('click', () => {
      if (gameInterval) {
        clearInterval(gameInterval);
        gameInterval = null;
      }

      startBingoGame();
    });
  }

  // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
  loadState();
  renderParticipants();
  validateProbabilities();
</script>

</body>
</html>
