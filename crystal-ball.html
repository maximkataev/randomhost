<!DOCTYPE html>
<html lang="ru">
<head>
 <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <title>–®–∞—Ä –°—É–¥—å–±—ã ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ–Ω–ª–∞–π–Ω</title>
  <meta name="description" content="–ú–∞–≥–∏—á–µ—Å–∫–∏–π ¬´–®–∞—Ä –°—É–¥—å–±—ã¬ª –ø–æ–º–æ–∂–µ—Ç —á–µ—Å—Ç–Ω–æ –∏ –∫—Ä–∞—Å–∏–≤–æ –≤—ã–±—Ä–∞—Ç—å –≤–µ–¥—É—â–µ–≥–æ, –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫–∞. –°–ø–∏—Å–æ–∫ –∏–º—ë–Ω, –≤–µ—Å–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π, –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ —Ñ–∞–Ω—Ñ–∞—Ä—ã." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1" />
  <link rel="canonical" href="https://example.com/crystal-ball.html" />

  <!-- Open Graph -->
  <meta property="og:locale" content="ru_RU" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="–®–∞—Ä –°—É–¥—å–±—ã ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ–Ω–ª–∞–π–Ω" />
  <meta property="og:description" content="–î–æ–±–∞–≤—å—Ç–µ –∏–º–µ–Ω–∞, –∑–∞–¥–∞–π—Ç–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –∏ –¥–æ–≤–µ—Ä—å—Ç–µ—Å—å –º–∞–≥–∏–∏: ¬´–®–∞—Ä –°—É–¥—å–±—ã¬ª –≤—ã–±–µ—Ä–µ—Ç –∑–∞ –≤–∞—Å." />
  <meta property="og:url" content="https://example.com/crystal-ball.html" />
  <meta property="og:site_name" content="–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä-–∏–≥—Ä—ã" />
  <meta property="og:image" content="https://example.com/assets/crystal-ball-share.jpg" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="–®–∞—Ä –°—É–¥—å–±—ã ‚Äî —Å–ª—É—á–∞–π–Ω—ã–π –≤—ã–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–∞ –æ–Ω–ª–∞–π–Ω" />
  <meta name="twitter:description" content="–ú–∞–≥–∏—á–µ—Å–∫–∏–π ¬´–®–∞—Ä –°—É–¥—å–±—ã¬ª —Å –∫–∞—Å—Ç–æ–º–Ω—ã–º–∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∞–º–∏." />
  <meta name="twitter:image" content="https://example.com/assets/crystal-ball-share.jpg" />

  <!-- Icons + PWA –º–µ–ª–æ—á–∏ -->
<link rel="alternate icon" type="image/png" sizes="72x72"
      href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/72x72/1f52e.png">
  <meta name="theme-color" content="#1a0033" />

  <!-- Fonts: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&family=Cinzel:wght@700&display=swap" rel="stylesheet">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body{
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; padding:20px;
      background:radial-gradient(ellipse at center, #1a0033 0%, #0a0015 100%);
      font-family:'Montserrat',system-ui,-apple-system,'Segoe UI',Roboto,Arial,sans-serif;
      overflow-x: hidden;
    }
    
    /* –ó–≤—ë–∑–¥—ã –Ω–∞ —Ñ–æ–Ω–µ */
    .stars {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 0;
    }
    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: #fff;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }
    @keyframes twinkle {
      0%, 100% { opacity: 0.3; }
      50% { opacity: 1; }
    }
    
    .main-container{ display:flex; gap:40px; align-items:center; max-width:1200px; width:100%; position:relative; z-index:1; }
    .game-container{ flex:1; text-align:center; perspective:1000px; }
    .settings-panel{
      width: 450px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(75,0,130,0.2);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(148,0,211,0.3);
      box-shadow: 0 8px 32px rgba(148,0,211,0.2);
      overflow: hidden;
    }
    
    .equalize-btn{
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(138,43,226,0.8), rgba(75,0,130,0.8));
      color: #fff;
      border: 2px solid rgba(186,85,211,0.4);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all .3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(138,43,226,0.3);
      letter-spacing: 0.5px;
    }
    .equalize-btn:hover{
      background: linear-gradient(135deg, rgba(148,0,211,1), rgba(138,43,226,1));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(138,43,226,0.5);
      border-color: rgba(186,85,211,0.6);
    }
    .equalize-btn:active{
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(138,43,226,0.3);
    }
    
    .names-list{ 
      display: flex; 
      flex-direction: column; 
      gap: 10px; 
      margin-bottom: 20px; 
      max-height: 500px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-right: 5px;
    }
    .name-item{ 
      display: flex; 
      gap: 8px;
      align-items: center; 
    }
    .name-input{
      flex:1; padding:10px 15px; border:2px solid rgba(186,85,211,0.3);
      border-radius:10px; background:rgba(75,0,130,0.2); color:#fff; font-size:16px; transition:.3s;
    }
    .name-input:focus{ outline:none; border-color:rgba(186,85,211,0.6); background:rgba(75,0,130,0.3); }
    .name-input::placeholder{ color:rgba(255,255,255,0.5); }
    .remove-btn{
      padding:8px 13px; background:rgba(139,0,139,0.7); color:#fff; border:none; border-radius:8px;
      cursor:pointer; font-size:18px; transition:.3s;
    }
    .remove-btn:hover{ background:rgba(139,0,139,0.9); transform:scale(1.1); }
    .add-name-container{ display:flex; gap:10px; margin-top:15px; }
    .add-btn-small{
      padding:10px 15px; background:rgba(138,43,226,0.7); color:#fff; border:none; border-radius:10px;
      cursor:pointer; font-size:20px; transition:.3s;
    }
    .add-btn-small:hover{ background:rgba(138,43,226,0.9); transform:scale(1.1); }

    h1{
      color:#fff; font-size:48px; margin-bottom:30px; 
      text-shadow:0 0 20px rgba(186,85,211,0.8), 0 0 40px rgba(138,43,226,0.6);
      font-family: 'Montserrat', serif;
      animation:glow 2s ease-in-out infinite alternate;
    }
    @keyframes glow{
      from{ text-shadow:0 0 20px rgba(186,85,211,0.8), 0 0 40px rgba(138,43,226,0.6); }
      to  { text-shadow:0 0 30px rgba(186,85,211,1), 0 0 60px rgba(138,43,226,0.8), 0 0 80px rgba(148,0,211,0.6); }
    }

    .probability-input.manual {
      border-color: #FBBF24;           /* amber-400 */
      box-shadow: 0 0 0 3px rgba(251,191,36,.25);
    }
    
    .top-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      display: flex;
      gap: 12px;
      z-index: 1000;
    }

    .top-btn {
      background: linear-gradient(135deg, rgba(138,43,226,0.95), rgba(75,0,130,0.95));
      color: #fff;
      text-decoration: none;
      padding: 10px 18px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      transition: 0.25s;
      box-shadow: 0 4px 12px rgba(138,43,226,0.3);
      border: 1px solid rgba(186,85,211,0.3);
    }

    .top-btn:hover {
      background: linear-gradient(135deg, rgba(148,0,211,1), rgba(138,43,226,1));
      transform: translateY(-2px);
    }

    /* –ú–∞–≥–∏—á–µ—Å–∫–∏–π —à–∞—Ä */
    .crystal-ball-container{ 
      position:relative; 
      width:400px; 
      height:400px; 
      margin:0 auto 50px;
    }
    
    .crystal-ball {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(186,85,211,0.4), rgba(75,0,130,0.6), rgba(25,0,51,0.9));
      box-shadow: 
        0 0 60px rgba(138,43,226,0.6),
        0 0 100px rgba(148,0,211,0.4),
        inset 0 0 100px rgba(186,85,211,0.2),
        inset -30px -30px 80px rgba(0,0,0,0.6);
      animation: ballPulse 3s ease-in-out infinite;
    }
    
    @keyframes ballPulse {
      0%, 100% {
        box-shadow: 
          0 0 60px rgba(138,43,226,0.6),
          0 0 100px rgba(148,0,211,0.4),
          inset 0 0 100px rgba(186,85,211,0.2),
          inset -30px -30px 80px rgba(0,0,0,0.6);
      }
      50% {
        box-shadow: 
          0 0 80px rgba(138,43,226,0.8),
          0 0 120px rgba(148,0,211,0.6),
          inset 0 0 120px rgba(186,85,211,0.3),
          inset -30px -30px 80px rgba(0,0,0,0.6);
      }
    }
    
    /* –¢—É–º–∞–Ω –≤–Ω—É—Ç—Ä–∏ —à–∞—Ä–∞ */
    .mist {
      position: absolute;
      inset: 0;
      border-radius: 50%;
      overflow: hidden;
    }
    
    .mist-layer {
      position: absolute;
      width: 200%;
      height: 200%;
      top: -50%;
      left: -50%;
      background: radial-gradient(circle, rgba(186,85,211,0.3) 0%, transparent 50%);
      animation: mistSwirl 20s linear infinite;
    }
    
    .mist-layer:nth-child(2) {
      animation-duration: 15s;
      animation-direction: reverse;
      background: radial-gradient(circle, rgba(138,43,226,0.2) 0%, transparent 50%);
    }
    
    .mist-layer:nth-child(3) {
      animation-duration: 25s;
      background: radial-gradient(circle, rgba(148,0,211,0.25) 0%, transparent 50%);
    }
    
    @keyframes mistSwirl {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }

    /* –≠—Ñ—Ñ–µ–∫—Ç –¥—ã–º–∞ –ø—Ä–∏ –ø–æ–±–µ–¥–µ */
.victory-smoke {
  position: absolute;
  inset: 0;
  border-radius: 50%;
  overflow: hidden;
  pointer-events: none;
  opacity: 0;
}

.victory-smoke.active {
  animation: smokeAppear 2s ease-out forwards;
}

@keyframes smokeAppear {
  0% { opacity: 0; }
  20% { opacity: 1; }
  100% { opacity: 0; }
}

    .smoke-particle {
      position: absolute;
      width: 100%;
      height: 100%;
      background: radial-gradient(circle, rgba(186,85,211,0.4) 0%, transparent 70%);
      animation: smokeRise 2s ease-out forwards;
    }

    .smoke-particle:nth-child(2) {
      animation-delay: 0.2s;
      background: radial-gradient(circle, rgba(138,43,226,0.3) 0%, transparent 70%);
    }

    .smoke-particle:nth-child(3) {
      animation-delay: 0.4s;
      background: radial-gradient(circle, rgba(148,0,211,0.35) 0%, transparent 70%);
    }

    @keyframes smokeRise {
      0% {
        transform: translateY(50%) scale(0.5);
        opacity: 0;
      }
      30% {
        opacity: 1;
      }
      100% {
        transform: translateY(-50%) scale(2);
        opacity: 0;
      }
    }
    
    /* –ë–ª–∏–∫–∏ */
    .highlight {
      position: absolute;
      top: 15%;
      left: 20%;
      width: 120px;
      height: 120px;
      background: radial-gradient(circle, rgba(255,255,255,0.6) 0%, transparent 60%);
      border-radius: 50%;
      filter: blur(20px);
    }
    
    /* –¢–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏ —à–∞—Ä–∞ */
.ball-text{
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  font-size:48px; font-weight:800; color:#fff; font-family:'Montserrat',serif;
  z-index:10; opacity:0;
  --blur: 10px;
  filter: blur(var(--blur));
  text-shadow:
    0 0 20px rgba(186,85,211,1),
    0 0 40px rgba(138,43,226,0.8),
    0 0 60px rgba(148,0,211,0.6);
  transition: filter .25s ease, opacity .25s ease, transform .25s ease;
}
.ball-text.show{ opacity:1; }


/* —Å—Ç–∞—Ä—ã–µ .ball-text.blurred / .ball-text.reveal –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω—ã */

    .ball-text.blurred {
  filter: blur(8px);
}
    
    .ball-text.reveal {
      animation: textReveal 2s forwards;
      color: #fff;
      text-shadow: 
        0 0 20px rgba(186,85,211,1),
        0 0 40px rgba(138,43,226,0.8),
        0 0 60px rgba(148,0,211,0.6);
    }
    
    @keyframes textReveal {
      0% {
        opacity: 0;
        transform: scale(0.5);
        filter: blur(20px);
      }
      50% {
        opacity: 0.5;
        filter: blur(10px);
      }
      100% {
        opacity: 1;
        transform: scale(1);
        filter: blur(0);
      }
    }
  

    .headers-row {
      display: flex;
      align-items: center;
      gap: 0px;
      margin-bottom: 10px;
      padding: 0 5px;
    }

    .header-name {
      flex: 1;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: left;
    }

    .header-probability {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      width: 120px;
      flex-shrink: 0;
    }

    .header-remove {
      width: 44px;
    }

    .probability-display {
      color: #ba55d3;
      font-weight: 800;
      font-size: 16px;
      min-width: 55px;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .probability-input {
      width: 55px;
      padding: 4px;
      background: rgba(75,0,130,0.3);
      color: #ba55d3;
      border: 2px solid rgba(186,85,211,0.4);
      border-radius: 5px;
      text-align: center;
      font-weight: 800;
      font-size: 14px;
      transition: .2s;
    }

    .probability-input:focus {
      outline: none;
      border-color: rgba(186,85,211,0.7);
      background: rgba(75,0,130,0.4);
    }

    .probability-input.error {
      border-color: rgba(139,0,139,0.8);
      background: rgba(139,0,139,0.2);
    }

    .probability-controls {
      display: flex;
      gap: 5px;
      width: 120px;
      flex-shrink: 0;
    }

    .prob-btn {
      padding: 5px 10px;
      background: rgba(138,43,226,0.3);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: .2s;
    }

    .prob-btn:hover {
      background: rgba(138,43,226,0.5);
      transform: scale(1.05);
    }

    .prob-btn:active {
      transform: scale(0.95);
    }

    .confetti {
      position: fixed; width: 10px; height: 10px;
      z-index: 0; pointer-events: none;
      animation: confetti-fall 3s ease-out forwards;
    }
    @keyframes confetti-fall{
      0%{ transform: translateY(0) rotate(300deg); opacity:1;}
      100%{ transform: translateY(100vh) rotate(720deg); opacity:0;}
    }

    .controls{ display:flex; gap:20px; justify-content:center; margin-top:30px; }
    button{
      padding:15px 30px; font-size:18px; font-weight:800; border:none; border-radius:50px;
      background:linear-gradient(135deg,#8a2be2 0%,#4b0082 100%); color:#fff; cursor:pointer;
      box-shadow:0 4px 15px rgba(138,43,226,.3); transition:.3s; position:relative; overflow:hidden;
      font-family: 'Montserrat', serif;
    }
    button:before{
      content:''; position:absolute; top:50%; left:50%; width:0; height:0; border-radius:50%;
      background:rgba(255,255,255,.3); transform:translate(-50%,-50%); transition:width .6s,height .6s;
    }
    button:hover:before{ width:300px; height:300px; }
    button:hover{ transform:translateY(-2px); box-shadow:0 6px 20px rgba(138,43,226,.5); }
    button:active{ transform:translateY(0); }
    button:disabled{ opacity:.5; cursor:not-allowed; }

    .mystical-overlay{ 
      position:fixed; inset:0; 
      background:radial-gradient(circle,transparent 0%,rgba(25,0,51,.95) 100%); 
      display:none; z-index:999; pointer-events:none; 
    }
    .mystical-overlay.active{ 
      display:block; 
      animation:mysticalPulse 2s ease-in-out infinite; 
    }
    @keyframes mysticalPulse{ 
      0%,100%{opacity:.6} 
      50%{opacity:.9} 
    }

    @keyframes screenShake{
      0%, 100% { transform: translate(0, 0); }
      10% { transform: translate(-3px, 2px); }
      20% { transform: translate(3px, -2px); }
      30% { transform: translate(-2px, 2px); }
      40% { transform: translate(2px, -2px); }
      50% { transform: translate(-2px, 1px); }
      60% { transform: translate(2px, -1px); }
      70% { transform: translate(-2px, 2px); }
      80% { transform: translate(2px, -2px); }
      90% { transform: translate(-1px, 1px); }
    }
    body.shake { animation: screenShake 0.5s ease-in-out; }

    .celebration-emoji {
      position: fixed;
      font-size: 60px;
      z-index: 998;
      pointer-events: none;
      animation: emojiCelebrate 3s ease-out forwards;
    }
    .celebration-word {
      position: fixed;
      font-size: 40px;
      font-weight: 800;
      color: #ba55d3;
      text-shadow: 0 0 20px rgba(186,85,211,1), 3px 3px 6px rgba(0,0,0,0.5);
      z-index: 998;
      pointer-events: none;
      opacity: 0.9;
      animation: wordFloat 4s ease-out forwards;
      font-family: 'Montserrat', serif;
    }
    @keyframes wordFloat {
      0% {
        transform: scale(0) translateY(0) rotate(-15deg);
        opacity: 0;
      }
      15% {
        transform: scale(1.2) translateY(-20px) rotate(5deg);
        opacity: 0.9;
      }
      50% {
        opacity: 0.8;
      }
      100% {
        transform: scale(0.8) translateY(-150px) rotate(15deg);
        opacity: 0;
      }
    }
    @keyframes emojiCelebrate {
      0% {
        transform: scale(0) rotate(0deg);
        opacity: 0;
      }
      20% {
        transform: scale(1.5) rotate(180deg);
        opacity: 1;
      }
      80% {
        opacity: 1;
      }
      100% {
        transform: scale(0.5) rotate(360deg);
        opacity: 0;
      }
    }
    /* —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –¥—Ä–∞–º–∞—Ç–∏—á–Ω—ã–π –ø–æ–ø-—ç—Ñ—Ñ–µ–∫—Ç */
@keyframes finalPop {
  0%   { transform: scale(0.6); opacity: 0; filter: blur(8px); }
  60%  { transform: scale(1.15); opacity: 1; filter: blur(2px); }
  100% { transform: scale(1);    opacity: 1; filter: blur(0); }
}
.ball-text.final-pop {
  animation: finalPop 700ms cubic-bezier(.2,.8,.2,1) forwards;
}

.probability-error-tooltip {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95));
  color: #fff;
  padding: 20px 30px;
  border-radius: 15px;
  box-shadow: 0 10px 40px rgba(0,0,0,0.4);
  z-index: 1002;
  font-size: 16px;
  font-weight: 600;
  text-align: center;
  max-width: 400px;
  animation: tooltipAppear 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  pointer-events: none;
}

@keyframes tooltipAppear {
  0% {
    transform: translate(-50%, -50%) scale(0);
    opacity: 0;
  }
  100% {
    transform: translate(-50%, -50%) scale(1);
    opacity: 1;
  }
}

@media (max-width: 900px) {
  .probability-error-tooltip {
    max-width: 90%;
    padding: 16px 20px;
    font-size: 14px;
  }
}

/* –æ–±—â–∏–µ —É–¥–æ–±—Å—Ç–≤–∞ –Ω–∞ —Ç–∞—á–∞—Ö */
:root { --pad: 12px; }
@media (hover: none) {
  button:hover, .top-btn:hover { transform: none !important; box-shadow: none !important; }
  button:before { display: none; }
}
* { -webkit-tap-highlight-color: transparent; }

/* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω (iPhone) + –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ */
.top-buttons {
  top: calc(env(safe-area-inset-top, 0px) + 8px);
  left: calc(env(safe-area-inset-left, 0px) + 8px);
  right: calc(env(safe-area-inset-right, 0px) + 8px);
  gap: 8px;
  padding-right: 8px;
  overflow-x: auto;
  max-width: 100%;
  -webkit-overflow-scrolling: touch;
}
.top-btn { flex: 0 0 auto; }

/* —à–∞—Ä –∏ —Ç–µ–∫—Å—Ç ‚Äî –≤—Å–µ–≥–¥–∞ –∫–≤–∞–¥—Ä–∞—Ç –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π —Ä–∞–∑–º–µ—Ä */
.crystal-ball-container {
  width: min(70vw, 360px); 
  aspect-ratio: 1 / 1;
  height: auto;
  margin: 8px auto 22px;   /* —Ü–µ–Ω—Ç—Ä –æ—Å—Ç–∞—ë—Ç—Å—è –∑–∞ —Å—á—ë—Ç auto */
}

.ball-text { font-size: clamp(24px, 9vw, 48px); }

/* –∫–Ω–æ–ø–∫–∞ ‚Äî –±–æ–ª—å—à–æ–π —Ç–∞—Ä–≥–µ—Ç –Ω–∞ –º–æ–±–∏–ª–µ */
.controls button {
  min-height: 52px;
  font-size: clamp(16px, 4.4vw, 18px);
  border-radius: 40px;
  padding: 12px 18px;
}

/* —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
@media (max-width: 900px) {
  body { padding: var(--pad); }
  .main-container { flex-direction: column; gap: 18px; align-items: stretch; }
  .settings-panel { width: 100%; max-width: 680px; padding: 16px; }
  .names-list { max-height: 40vh; }
  .name-input { padding: 10px 12px; font-size: 15px; }
  .probability-input { width: 56px; font-size: 13px; padding: 6px 4px; }
  .prob-btn { padding: 6px 8px; font-size: 13px; }
}

/* –æ–±–ª–µ–≥—á—ë–Ω–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –Ω–∞ —É–∑–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö, —á—Ç–æ–±—ã –Ω–µ ¬´–∑–≤–µ–Ω–µ–ª¬ª GPU */
@media (max-width: 480px) {
  h1 { font-size: clamp(22px, 7.2vw, 28px); }
  .highlight { filter: blur(14px); }
  .crystal-ball { box-shadow:
    0 0 40px rgba(138,43,226,0.5),
    0 0 70px rgba(148,0,211,0.35),
    inset 0 0 80px rgba(186,85,211,0.2),
    inset -24px -24px 64px rgba(0,0,0,0.55);
  }
  .celebration-emoji { font-size: clamp(32px, 10vw, 44px); }
  .celebration-word  { font-size: clamp(18px, 6vw, 26px); }
}

/* –µ—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—ã–∫–ª—é—á–µ–Ω—ã –∞–Ω–∏–º–∞—Ü–∏–∏ ‚Äî —É–≤–∞–∂–∞–µ–º –≤—ã–±–æ—Ä */
@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; }
}

/* --- –£–ù–ò–§–ò–¶–ò–†–û–í–ê–ù–ù–´–ï –û–¢–°–¢–£–ü–´ –ú–ï–ù–Æ, –∫–∞–∫ –≤ –≥–æ–Ω–∫–∞—Ö --- */

/* –î–µ—Å–∫—Ç–æ–ø: –∫–Ω–æ–ø–∫–∏ —Å–ª–µ–≤–∞, –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã */
.top-buttons {
  position: fixed;
  top: 20px;
  left: 20px;
  display: flex;
  gap: 12px;
  z-index: 1000;
}

@media (max-width: 768px) {
  .top-buttons {
    top: calc(env(safe-area-inset-top, 0px) + 8px);
    left: calc(env(safe-area-inset-left, 0px) + 8px);
    right: calc(env(safe-area-inset-right, 0px) + 8px);
    gap: 8px;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }
  .top-buttons::-webkit-scrollbar { display: none; }
  .top-btn { 
    padding: 8px 14px; 
    font-size: 14px; 
    border-radius: 9px; 
    flex: 0 0 auto;
    white-space: nowrap;
  }
  .main-container {
    padding-top: 60px;
  }
}


  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  
  <div class="main-container">
    <div class="top-buttons">
      <a href="lottery-drum.html" class="top-btn">üé± –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="wheel-of-fortune.html" class="top-btn">üé° –ö–æ–ª–µ—Å–æ</a>
      <a href="crystal-ball.html" class="top-btn">üîÆ –®–∞—Ä</a>
      <a href="plinko.html" class="top-btn">üéØ –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html" class="top-btn">üèÅ –ì–æ–Ω–∫–∏</a>
      <a href="trading.html" class="top-btn">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</a>
    </div>

    <div class="settings-panel">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px;">
        <h2 style="color: #ba55d3; font-size: 24px; margin: 0; text-shadow: 0 0 10px rgba(186,85,211,0.6); font-family: 'Montserrat', serif;">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <button class="equalize-btn" id="equalizeBtn">‚öñÔ∏è –£—Ä–∞–≤–Ω—è—Ç—å</button>
      </div>
      <div class="headers-row">
        <div class="header-name">–ò–º—è</div>
        <div class="header-probability">üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
        <div class="header-remove"></div>
      </div>
      <div class="names-list" id="namesList"></div>
      <div class="add-name-container">
        <input type="text" class="name-input" id="newNameInput" placeholder="–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫">
        <button class="add-btn-small" id="addNameBtn">‚ûï</button>
      </div>
    </div>

    <div class="game-container">
      <h1>üîÆ –ú–ê–ì–ò–ß–ï–°–ö–ò–ô –®–ê–† üîÆ</h1>
      <div class="crystal-ball-container">
        <div class="crystal-ball" id="crystalBall">
          <div class="mist">
            <div class="mist-layer"></div>
            <div class="mist-layer"></div>
            <div class="mist-layer"></div>
          </div>
          <div class="highlight"></div>
          <div class="victory-smoke" id="victorySmoke"></div>
          <div class="ball-text" id="ballText"></div>
        </div>
      </div>
      <div class="controls">
        <button id="consultBtn">‚ú® –£–∑–Ω–∞—Ç—å —Å—É–¥—å–±—É</button>
      </div>
    </div>
  </div>

  <div class="mystical-overlay" id="mysticalOverlay"></div>

  <script>
// ===== –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –º–æ–±–∏–ª—å–Ω–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ =====
const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

// ===== –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∑–≤—ë–∑–¥ (–º–µ–Ω—å—à–µ –Ω–∞ –º–æ–±–∏–ª–µ) =====
const starsContainer = document.getElementById('stars');
const STAR_COUNT = isMobile ? 60 : 120;
for (let i = 0; i < STAR_COUNT; i++) {
  const star = document.createElement('div');
  star.className = 'star';
  star.style.left = Math.random() * 100 + '%';
  star.style.top = Math.random() * 100 + '%';
  star.style.width = star.style.height = (Math.random() < 0.85 ? 2 : 3) + 'px';
  star.style.animationDelay = (Math.random() * 3) + 's';
  starsContainer.appendChild(star);
}

// ====== –ó–≤—É–∫ ======
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

(function () {
  let unlocked = false;
  function unlock() {
    try { if (audioCtx && audioCtx.state === 'suspended') audioCtx.resume(); } catch(e){}
    if (!unlocked) {
      unlocked = true;
      window.removeEventListener('touchstart', unlock, {passive:true});
      window.removeEventListener('pointerdown', unlock, {passive:true});
      window.removeEventListener('click', unlock, {passive:true});
    }
  }
  window.addEventListener('touchstart', unlock, {passive:true});
  window.addEventListener('pointerdown', unlock, {passive:true});
  window.addEventListener('click', unlock, {passive:true});
})();

// ===== –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã =====
const NAMES_KEY = 'shared_names_v1';
const PROB_KEY = 'shared_probabilities_v2';
const LOCKED_KEY = 'shared_locked_v1';

// ===== –°–æ—Å—Ç–æ—è–Ω–∏–µ =====
let names = ['–î–∏–º–∞','–°–∞—à–∞','–ù–∏–∫–∏—Ç–∞','–ú–∞–∫—Å–∏–º','–ö–∏—Ä–∏–ª–ª','–°–µ–º—ë–Ω'];
let probabilities          = {};
let lockedParticipants     = {};
let hasCustomProbabilities = false;

const crystalBall = document.getElementById('crystalBall');
const ballText = document.getElementById('ballText');
const victorySmoke = document.getElementById('victorySmoke');
const consultBtn = document.getElementById('consultBtn');
const mysticalOverlay = document.getElementById('mysticalOverlay');
const namesList = document.getElementById('namesList');
const addNameBtn = document.getElementById('addNameBtn');
const newNameInput = document.getElementById('newNameInput');
const equalizeBtn = document.getElementById('equalizeBtn');

let isConsulting = false;

// ====== –ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã ======
function playSound(f, d, v){ 
  const o=audioCtx.createOscillator(), g=audioCtx.createGain(); 
  o.type='sine'; o.frequency.value=f; g.gain.value=v||0.1; 
  o.connect(g); g.connect(audioCtx.destination); 
  const t=audioCtx.currentTime; o.start(t); o.stop(t+(d||0.1)); 
}
const playMysticalSound = ()=>{
  playSound(220, 0.5, 0.1);
  setTimeout(()=>playSound(277, 0.5, 0.1), 200);
  setTimeout(()=>playSound(330, 0.5, 0.1), 400);
};
const playRevealSound = ()=>playSound(880, 0.8, 0.2);
function playFanfare(){ 
  [523,659,784,1046,784,1046,1319,1568].forEach((f,i)=>
    setTimeout(()=>playSound(f,0.18,0.15),i*150)
  ); 
}

// ====== –ó–∞–≥—Ä—É–∑–∫–∞ –∏–º–µ–Ω ======
try {
  const saved = JSON.parse(localStorage.getItem(NAMES_KEY) || '[]');
  if (Array.isArray(saved) && saved.length) names = saved;
  else localStorage.setItem(NAMES_KEY, JSON.stringify(names));
} catch(e){}

const saveNames = ()=>{ 
  try{ 
    localStorage.setItem(NAMES_KEY, JSON.stringify(names)); 
  }catch(e){} 
};

// ===== –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏ =====
function initProbabilities() {
  try {
    const saved       = JSON.parse(localStorage.getItem(PROB_KEY)   || '{}');
    const savedLocked = JSON.parse(localStorage.getItem(LOCKED_KEY) || '{}');

    if (saved?.hasCustomProbabilities && saved?.probabilities && Object.keys(saved.probabilities).length) {
      probabilities          = { ...saved.probabilities };
      lockedParticipants     = { ...savedLocked };
      hasCustomProbabilities = true;

      names.forEach((n) => { if (!(n in probabilities)) probabilities[n] = 1 / names.length; });
      Object.keys(probabilities).forEach((n) => { if (!names.includes(n)) delete probabilities[n]; });
      Object.keys(lockedParticipants).forEach((n) => { if (!names.includes(n)) delete lockedParticipants[n]; });

      saveProbabilities();
    } else {
      setEqualProbabilities();
    }
  } catch (_) {
    setEqualProbabilities();
  }
}

function setEqualProbabilities() {
  const p = 1 / (names.length || 1);
  probabilities = {};
  names.forEach((nm) => probabilities[nm] = p);
  lockedParticipants     = {};
  hasCustomProbabilities = false;
  saveProbabilities();
}

function clampProbabilitiesMin(min = 0.001) {
  names.forEach((nm) => { if ((probabilities[nm] ?? 0) < min) probabilities[nm] = min; });
}

function normalizeProbabilities() {
  const vals = names.map((n) => probabilities[n] ?? 0);
  const uniq = [...new Set(vals.map((v) => +v.toFixed(6)))];
  if (uniq.length === 1 && !hasCustomProbabilities) {
    const exact = 1 / (names.length || 1);
    names.forEach((nm) => probabilities[nm] = exact);
    return;
  }

  clampProbabilitiesMin(0.001);

  const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
  if (sum > 0 && Math.abs(sum - 1) > 1e-4) {
    const k = 1 / sum;
    names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
  }

  clampProbabilitiesMin(0.001);
}

function saveProbabilities() {
  try {
    const cleanP = {};
    names.forEach((nm) => cleanP[nm] = probabilities[nm] ?? 0);

    const cleanLocked = {};
    names.forEach((nm) => { if (lockedParticipants[nm]) cleanLocked[nm] = true; });

    localStorage.setItem(PROB_KEY, JSON.stringify({
      probabilities: cleanP,
      hasCustomProbabilities
    }));
    localStorage.setItem(LOCKED_KEY, JSON.stringify(cleanLocked));
  } catch (_) {}
}

function getProbabilityPercent(name) {
  if (!hasCustomProbabilities && names.length) return (100 / names.length).toFixed(1);
  return (((probabilities[name] || 0) * 100).toFixed(1));
}

function adjustProbability(name, delta) {
  const cur         = parseFloat(getProbabilityPercent(name)) || 0;
  const maxPossible = 100 - (names.length - 1) * 0.1;
  const next        = Math.max(0.1, Math.min(maxPossible, cur + delta));
  setProbabilityManually(name, next);
  createNameInputs();
}

function setProbabilityManually(name, percentValue) {
  if (isNaN(percentValue) || percentValue < 0.1 || percentValue > 99.9) return false;

  hasCustomProbabilities = true;
  const newProb          = percentValue / 100;

  const otherLocked      = names.filter((n) => n !== name && lockedParticipants[n]);
  const lockedTotal      = otherLocked.reduce((s, n) => s + (probabilities[n] || 0), 0);
  const minOthers        = (names.length - 1) * 0.001;

  if (newProb + lockedTotal + minOthers > 1) {
    lockedParticipants = {};
    probabilities[name] = newProb;
    lockedParticipants[name] = true;

    const others  = names.filter((n) => n !== name);
    const remain  = 1 - newProb;
    const share   = remain / (others.length || 1);
    others.forEach((n) => probabilities[n] = share);

    normalizeProbabilities();
    saveProbabilities();
    return true;
  }

  lockedParticipants[name] = true;

  const free   = names.filter((n) => n !== name && !lockedParticipants[n]);
  const locked = names.filter((n) => n !== name && lockedParticipants[n]);

  if (free.length) {
    probabilities[name] = newProb;
    const lockedSum = locked.reduce((s, n) => s + (probabilities[n] || 0), 0) + newProb;
    let remain       = Math.max(0, 1 - lockedSum);

    const freeSum = free.reduce((s, n) => s + (probabilities[n] || 0), 0);
    if (freeSum > 0) {
      const k = remain / freeSum;
      free.forEach((n) => probabilities[n] = (probabilities[n] || 0) * k);
    } else {
      free.forEach((n) => probabilities[n] = remain / free.length);
    }

    free.forEach((n) => { if (probabilities[n] < 0.001) probabilities[n] = 0.001; });
  } else {
    const others = names.filter((n) => n !== name).sort((a, b) => (probabilities[a] || 0) - (probabilities[b] || 0));
    const victim = others[0];
    delete lockedParticipants[victim];

    probabilities[name] = newProb;
    const stillLocked   = names.filter((n) => n !== name && lockedParticipants[n]);
    const lockedSum     = stillLocked.reduce((s, n) => s + (probabilities[n] || 0), 0) + newProb;
    const remain        = 1 - lockedSum;

    probabilities[victim] = Math.max(0.001, remain);
  }

  normalizeProbabilities();
  saveProbabilities();
  return true;
}

function equalizeProbabilities() {
  setEqualProbabilities();
  createNameInputs();
}

// ====== –ü—Ä–∞–∑–¥–Ω–æ–≤–∞–Ω–∏—è ======
function createCelebrationEmojis(){
  const emojis = ['üîÆ', '‚ú®', '‚≠ê', 'üí´', 'üåü', 'ü™Ñ', 'üéÜ', 'üíú', 'üåô', 'üî•'];
  const count = isMobile ? 12 : 20;
  
  for (let i=0; i<count; i++){
    setTimeout(()=>{
      const emoji = document.createElement('div');
      emoji.className = 'celebration-emoji';
      emoji.textContent = emojis[Math.floor(Math.random() * emojis.length)];
      emoji.style.left = (Math.random() * 100) + '%';
      emoji.style.top = (Math.random() * 100) + '%';
      emoji.style.animationDelay = (Math.random() * 0.5) + 's';
      document.body.appendChild(emoji);
      setTimeout(() => emoji.remove(), 3500);
    }, i * 100);
  }
}

function createCelebrationWords(){
  const words = [
    '–ü–†–ï–î–°–ö–ê–ó–ê–ù–û', '–°–£–î–¨–ë–ê –†–ï–®–ï–ù–ê', '–¢–ê–ö –í–ï–õ–ò–¢ –ú–ê–ì–ò–Ø', '–ü–†–ï–î–ù–ê–ß–ï–†–¢–ê–ù–û',
    '–ó–í–Å–ó–î–´ –£–ö–ê–ó–ê–õ–ò', '–°–£–î–¨–ë–û–ù–û–°–ù–û', '–ú–ò–°–¢–ò–ß–ï–°–ö–ò', '–í–û–õ–®–ï–ë–ù–û',
    '–û–†–ê–ö–£–õ –í–´–ë–†–ê–õ', '–ü–†–û–í–ò–î–ï–ù–ò–ï', '–ú–ê–ì–ò–ß–ï–°–ö–ò–ô –í–´–ë–û–†', '–ü–†–ï–î–í–ï–°–¢–ò–ï',
    '–¢–´ –ò–ó–ë–†–ê–ù–ù–´–ô', '–ë–ê–ë–ê –í–ê–ù–ì–ê –®–ï–ü–ù–£–õ–ê'
  ];
  
  const gridCols = isMobile ? 3 : 4;
  const gridRows = isMobile ? 4 : 3;
  const positions = [];
  
  for (let row = 0; row < gridRows; row++) {
    for (let col = 0; col < gridCols; col++) {
      positions.push({
        left: (col * (100 / gridCols)) + (100 / gridCols / 2),
        top: (row * (100 / gridRows)) + (100 / gridRows / 2)
      });
    }
  }
  
  positions.sort(() => Math.random() - 0.5);
  
  const wordsToShow = isMobile ? 6 : 10;
  
  for (let i = 0; i < wordsToShow; i++){
    setTimeout(() => {
      const word = document.createElement('div');
      word.className = 'celebration-word';
      word.textContent = words[Math.floor(Math.random() * words.length)];
      
      const pos = positions[i % positions.length];
      word.style.left = (pos.left + (Math.random() - 0.5) * 10) + '%';
      word.style.top = (pos.top + (Math.random() - 0.5) * 10) + '%';
      word.style.animationDelay = (Math.random() * 0.3) + 's';
      
      document.body.appendChild(word);
      setTimeout(() => word.remove(), 4500);
    }, i * 150);
  }
}

function createConfetti(){
  const cs = ['#8a2be2','#9370db','#ba55d3','#da70d6','#dda0dd','#ee82ee'];
  const count = isMobile ? 50 : 100;
  
  for (let i=0;i<count;i++){
    setTimeout(()=>{
      const d=document.createElement('div');
      d.className='confetti';
      d.style.left=(Math.random()*100)+'%';
      d.style.top='0';
      d.style.background=cs[Math.floor(Math.random()*cs.length)];
      d.style.width=(5+Math.random()*10)+'px';
      d.style.height=(5+Math.random()*10)+'px';
      d.style.animationDelay=(Math.random()*0.5)+'s';
      d.style.animationDuration=(2+Math.random()*2)+'s';
      document.body.appendChild(d);
      setTimeout(()=>d.remove(),4000);
    }, i*25);
  }
}

// ====== UI –∏–º—ë–Ω ======
function createNameInputs(){
  namesList.innerHTML='';
  names.forEach((name,idx)=>{
    const row=document.createElement('div'); 
    row.className='name-item';
    
    const input=document.createElement('input'); 
    input.type='text'; 
    input.className='name-input'; 
    input.value=name; 
    input.placeholder='–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
    
    input.addEventListener('input', ()=>{ 
      const v=input.value.trim(); 
      if(!v) return;

      const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
      if(dup){
        input.style.borderColor = 'rgba(139,0,139,0.8)';
        input.style.background = 'rgba(139,0,139,0.2)';
        return;
      }

      input.style.borderColor = 'rgba(186,85,211,0.3)';
      input.style.background = 'rgba(75,0,130,0.2)';

      const oldName = names[idx];

      if (oldName in probabilities) {
        probabilities[v] = probabilities[oldName];
        delete probabilities[oldName];
      }
      if (oldName in lockedParticipants) {
        lockedParticipants[v] = true;
        delete lockedParticipants[oldName];
      }
      saveProbabilities();

      names[idx] = v;
      saveNames();
    });

    input.addEventListener('blur', ()=>{
      const v=input.value.trim();
      if(!v) {
        input.value = names[idx];
        return;
      }
      
      const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
      if(dup) {
        input.value = names[idx];
        input.style.borderColor = 'rgba(186,85,211,0.3)';
        input.style.background = 'rgba(75,0,130,0.2)';
      }
    });
    
    const probControls = document.createElement('div');
    probControls.className = 'probability-controls';
    
    const decreaseBtn = document.createElement('button');
    decreaseBtn.className = 'prob-btn';
    decreaseBtn.textContent = '‚àí';
    decreaseBtn.onclick = () => {
      adjustProbability(name, -1);
    };

    const probInput = document.createElement('input');
    probInput.type = 'text';
    probInput.inputMode = 'decimal';
    probInput.className = 'probability-input';
    probInput.value = getProbabilityPercent(name);
    if (lockedParticipants[name]) {
      probInput.classList.add('manual');
    }
    
    let lastValid = probInput.value;

    probInput.addEventListener('focus', () => {
      probInput.value = probInput.value.replace('%', '');
      lastValid = probInput.value;
    });

    probInput.addEventListener('input', () => {
      const val = probInput.value.replace('%', '').trim();
      const num = parseFloat(val);
      if (val === '' || (num >= 0.1 && num <= 99.9)) {
        probInput.classList.remove('error');
      } else {
        probInput.classList.add('error');
      }
    });

    probInput.addEventListener('blur', () => {
      const val = probInput.value.replace('%', '').trim();
      const num = parseFloat(val);

      if (val === '' || isNaN(num) || num < 0.1 || num > 99.9) {
        probInput.value = lastValid;
        probInput.classList.remove('error');
        playSound(300, 0.1, 0.2);
      } else {
        if (setProbabilityManually(name, num)) {
          lastValid = getProbabilityPercent(name);
          createNameInputs();
        } else {
          probInput.value = lastValid;
          probInput.classList.remove('error');
        }
      }
    });

    probInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') { e.preventDefault(); probInput.blur(); }
      if (!/[\d.]/.test(e.key) && e.key !== 'Enter') e.preventDefault();
    });

    const increaseBtn = document.createElement('button');
    increaseBtn.className = 'prob-btn';
    increaseBtn.textContent = '+';
    increaseBtn.onclick = () => {
      adjustProbability(name, 1);
    };
    
    probControls.appendChild(decreaseBtn);
    probControls.appendChild(probInput);
    probControls.appendChild(increaseBtn);
    
    const btn=document.createElement('button'); 
    btn.className='remove-btn'; 
    btn.textContent='‚úï';
    btn.onclick=()=>{ 
      if (names.length <= 2) {
        alert('–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞!');
        return;
      }
      const removedName = names[idx];
      names.splice(idx,1);
      delete probabilities[removedName];
      delete lockedParticipants[removedName];

      saveNames();
      normalizeProbabilities();
      saveProbabilities();
      
      createNameInputs();
    };
    
    row.appendChild(input);
    row.appendChild(probControls);
    row.appendChild(btn); 
    namesList.appendChild(row);
  });
}

function addNewParticipant(){
  const v=newNameInput.value.trim(); 
  if(!v) return;
  
  const dup = names.some((n) => n.toLowerCase() === v.toLowerCase());
  if(dup){
    newNameInput.style.borderColor = 'rgba(139,0,139,0.8)';
    newNameInput.style.background = 'rgba(139,0,139,0.2)';
    setTimeout(() => {
      newNameInput.style.borderColor = 'rgba(186,85,211,0.3)';
      newNameInput.style.background = 'rgba(75,0,130,0.2)';
    }, 1500);
    return;
  }
  
  newNameInput.value=''; 
  newNameInput.style.borderColor = 'rgba(186,85,211,0.3)';
  newNameInput.style.background = 'rgba(75,0,130,0.2)';

  names.push(v);
  saveNames();

  probabilities[v] = 1 / names.length;
  normalizeProbabilities();
  saveProbabilities();

  createNameInputs();
}

addNameBtn.addEventListener('click', addNewParticipant);
newNameInput.addEventListener('keypress', e=>{ 
  if(e.key==='Enter') addNewParticipant(); 
});
equalizeBtn.addEventListener('click', equalizeProbabilities);

async function consultOracle() {
  if (isConsulting) return;
  isConsulting = true;
  consultBtn.disabled = true;

  ballText.classList.add('show');
  ballText.textContent = '';

  const pool = [];
  names.forEach(n => {
    const w = probabilities[n] || (1 / names.length);
    const cnt = Math.max(1, Math.round(w * 1000));
    for (let i = 0; i < cnt; i++) pool.push(n);
  });
  const winnerName = pool[Math.floor(Math.random() * pool.length)];

  mysticalOverlay.classList.add('active');
  playMysticalSound();

  const prevAnim = crystalBall.style.animation;
  crystalBall.style.animation = 'ballPulse 0.5s ease-in-out infinite';

  const total = isMobile ? 3800 : 5000;
  const startInterval = isMobile ? 14 : 22;
  const endInterval = isMobile ? 110 : 140;

  const fontPx = parseFloat(getComputedStyle(ballText).fontSize) || 32;
  const minBlurPx = Math.max(4, fontPx * 0.10);
  const startBlur = Math.max(minBlurPx, 16);
  const endRollBlur = minBlurPx;

  ballText.style.setProperty('--blur', `${startBlur}px`);

  let startTS = null;
  const easeOutCubic = t => 1 - Math.pow(1 - t, 3);

  function tick(ts){
    if (!startTS) startTS = ts;
    const elapsed = Math.min(ts - startTS, total);
    const p = easeOutCubic(elapsed / total);

    if (elapsed < total) {
      const randomName = names[Math.floor(Math.random() * names.length)];
      ballText.textContent = randomName;

      const blurNow = startBlur + (endRollBlur - startBlur) * p;
      ballText.style.setProperty('--blur', `${Math.max(endRollBlur, blurNow)}px`);

      const intervalNow = startInterval + (endInterval - startInterval) * p;
      setTimeout(()=>requestAnimationFrame(tick), intervalNow);
      return;
    }

    ballText.textContent = '';
    ballText.style.setProperty('--blur', '10px');
    
    victorySmoke.innerHTML = '<div class="smoke-particle"></div><div class="smoke-particle"></div><div class="smoke-particle"></div>';
    victorySmoke.classList.add('active');
    
    setTimeout(() => {
      ballText.textContent = winnerName;
      ballText.style.setProperty('--blur', '0px');
      
      ballText.classList.remove('final-pop');
      void ballText.offsetWidth;
      ballText.classList.add('final-pop');
      
      playRevealSound();
      
      setTimeout(() => {
        victorySmoke.classList.remove('active');
        victorySmoke.innerHTML = '';
      }, 1000);
    }, 1000);

    setTimeout(async () => {
      mysticalOverlay.style.background = 'radial-gradient(circle,transparent 0%,rgba(10,0,21,.98) 100%)';
      await new Promise(r=>setTimeout(r, 500));
      mysticalOverlay.classList.remove('active');
      mysticalOverlay.style.background = 'radial-gradient(circle,transparent 0%,rgba(25,0,51,.95) 100%)';
      crystalBall.style.animation = prevAnim || 'ballPulse 3s ease-in-out infinite';

      document.body.classList.add('shake');
      setTimeout(()=>document.body.classList.remove('shake'), 500);

      playFanfare();
      createConfetti();
      createCelebrationEmojis();
      createCelebrationWords();

      setTimeout(() => {
        isConsulting = false;
        consultBtn.disabled = false;
      }, 2000);
    }, 1800);
  }

  requestAnimationFrame(tick);
}

consultBtn.addEventListener('click', consultOracle);

// ====== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ======
function init() {
  initProbabilities();
  createNameInputs();
}

init();
  </script>
  <!-- Yandex.Metrika counter --> <script type="text/javascript"> (function(m,e,t,r,i,k,a){ m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)}; m[i].l=1*new Date(); for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }} k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a) })(window, document,'script','https://mc.yandex.ru/metrika/tag.js?id=104849796', 'ym'); ym(104849796, 'init', {ssr:true, webvisor:true, clickmap:true, ecommerce:"dataLayer", accurateTrackBounce:true, trackLinks:true}); </script> <noscript><div><img src="https://mc.yandex.ru/watch/104849796" style="position:absolute; left:-9999px;" alt="" /></div></noscript> <!-- /Yandex.Metrika counter -->
</body>
</html>
