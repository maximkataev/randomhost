<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />

  <title>–†–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä - –®–∞–±–ª–æ–Ω</title>
  <meta name="description" content="–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —à–∞–±–ª–æ–Ω —Ä–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä–∞ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏ –∏ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏." />
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">

  <!-- Icons -->
  <link rel="icon" href="https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f3b2.svg" type="image/svg+xml">
  <meta name="theme-color" content="#764ba2">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;800&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-right: env(safe-area-inset-right, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
      --safe-left: env(safe-area-inset-left, 0px);
    }

    body {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      touch-action: manipulation;
    }

    /* ===== DESKTOP –ú–ï–ù–Æ ===== */
    .top-buttons {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 1000;
    }

    .desktop-menu-toggle {
      position: relative;
      background: linear-gradient(135deg, rgba(30,35,60,0.85), rgba(50,30,70,0.85));
      backdrop-filter: blur(12px);
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      padding: 0;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      font-size: 24px;
      cursor: pointer;
      box-shadow:
        0 4px 15px rgba(0,0,0,0.3),
        0 0 0 0 rgba(255,255,255,0.4);
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      display: flex;
      align-items: center;
      justify-content: center;
      user-select: none;
      overflow: hidden;
    }

    .desktop-menu-toggle::before {
      content: '';
      position: absolute;
      inset: -2px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea, #764ba2, #667eea);
      background-size: 200% 200%;
      animation: gradientSpin 3s ease infinite;
      opacity: 0;
      transition: opacity 0.3s ease;
      z-index: -1;
    }

    @keyframes gradientSpin {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .desktop-menu-toggle:hover::before {
      opacity: 1;
    }

    .desktop-menu-toggle:hover {
      transform: translateY(-3px) scale(1.05);
      box-shadow:
        0 8px 25px rgba(0,0,0,0.4),
        0 0 0 8px rgba(255,255,255,0.1);
      border-color: rgba(255,255,255,0.5);
    }

    .desktop-menu-toggle:active {
      transform: translateY(-1px) scale(0.98);
    }

    .menu-icon {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 24px;
      height: 18px;
      position: relative;
      transition: transform 0.3s ease;
    }

    .menu-icon span {
      display: block;
      width: 100%;
      height: 3px;
      background: #fff;
      border-radius: 2px;
      position: absolute;
      left: 0;
      transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .menu-icon span:nth-child(1) {
      top: 0;
    }

    .menu-icon span:nth-child(2) {
      top: 50%;
      margin-top: -1.5px;
    }

    .menu-icon span:nth-child(3) {
      bottom: 0;
    }

    .desktop-menu-toggle:hover .menu-icon {
      transform: scale(1.1);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(1) {
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(45deg);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(2) {
      opacity: 0;
      transform: rotate(180deg) scale(0);
    }

    .desktop-menu-toggle.active .menu-icon span:nth-child(3) {
      bottom: auto;
      top: 50%;
      margin-top: -1.5px;
      transform: rotate(-45deg);
    }

    .desktop-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      margin-top: 15px;
      background: linear-gradient(135deg, rgba(20,25,45,0.92), rgba(40,20,55,0.92));
      backdrop-filter: blur(20px);
      border-radius: 16px;
      box-shadow:
        0 10px 40px rgba(0,0,0,0.5),
        0 0 0 1px rgba(255,255,255,0.15) inset,
        0 0 20px rgba(102,126,234,0.2);
      overflow: hidden;
      max-height: 0;
      opacity: 0;
      transform: translateY(-10px);
      transition:
        max-height 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55),
        opacity 0.3s ease,
        transform 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
      min-width: 240px;
    }

    .desktop-dropdown.active {
      max-height: 600px;
      opacity: 1;
      transform: translateY(0);
    }

    .desktop-dropdown a {
      position: relative;
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 16px 20px;
      color: #fff;
      text-decoration: none;
      font-size: 16px;
      font-weight: 600;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      transition: all 0.3s ease;
      overflow: hidden;
    }

    .desktop-dropdown a::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 4px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      transform: translateX(-4px);
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(90deg, rgba(102,126,234,0.2), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .desktop-dropdown a:last-child {
      border-bottom: none;
    }

    .desktop-dropdown a:hover {
      background: rgba(102,126,234,0.25);
      padding-left: 24px;
      color: #ffd43b;
      text-shadow: 0 0 10px rgba(255,212,59,0.5);
    }

    .desktop-dropdown a:hover::before {
      transform: translateX(0);
    }

    .desktop-dropdown a:hover::after {
      opacity: 1;
    }

    .desktop-dropdown a:active {
      background: rgba(118,75,162,0.3);
      transform: scale(0.98);
    }

    .desktop-dropdown a span:first-child {
      font-size: 20px;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
      transition: transform 0.3s ease;
    }

    .desktop-dropdown a:hover span:first-child {
      transform: scale(1.2) rotate(10deg);
    }

    /* ===== MOBILE –ú–ï–ù–Æ (–°–ö–†–´–¢–û –ü–û –î–ï–§–û–õ–¢–£ –ù–ê DESKTOP) ===== */
    .menu-container {
      display: none;
    }

    /* ===== –û–°–ù–û–í–ù–û–ô –ö–û–ù–¢–ï–ô–ù–ï–† ===== */
    .main-container {
      display: flex;
      flex-direction: row-reverse;
      gap: 40px;
      align-items: center;
      max-width: 1200px;
      width: 100%;
    }

    .game-container {
      flex: 1;
      text-align: center;
      perspective: 1000px;
      position: relative;
    }

    .game-field {
      width: 100%;
      min-height: 600px;
      position: relative;
      border-radius: 24px;
      overflow: hidden;
      border: 3px solid rgba(255,255,255,0.15);
      box-shadow:
        0 12px 40px rgba(0,0,0,0.5),
        0 0 40px rgba(102,126,234,0.35);
      background: transparent;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .settings-panel {
      width: 450px;
      padding: 30px;
      border-radius: 20px;
      background: rgba(255,255,255,0.1);
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.1);
      overflow: hidden;
    }

    .settings-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 15px;
    }

    .settings-title {
      color: #fff;
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }

    .settings-actions {
      display: flex;
      gap: 8px;
    }

    .equalize-btn, .collapse-btn {
      padding: 8px 18px;
      background: linear-gradient(135deg, rgba(102,126,234,0.8), rgba(118,75,162,0.8));
      color: #fff;
      border: 2px solid rgba(255,255,255,0.3);
      border-radius: 10px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 700;
      transition: all 0.3s ease;
      white-space: nowrap;
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      letter-spacing: 0.5px;
    }

    .collapse-btn {
      display: none;
    }

    .equalize-btn:hover, .collapse-btn:hover {
      background: linear-gradient(135deg, rgba(118,75,162,1), rgba(102,126,234,1));
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
      border-color: rgba(255,255,255,0.5);
    }

    .equalize-btn:active, .collapse-btn:active {
      transform: translateY(0px);
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    .names-list-wrapper {
      transition: max-height 0.3s ease;
    }

    .names-list-wrapper.collapsed {
      max-height: 0;
      overflow: hidden;
    }

    .names-list {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
      max-height: 500px;
      overflow-y: auto;
      scrollbar-width: none;
      -ms-overflow-style: none;
      padding-right: 5px;
    }
    .names-list::-webkit-scrollbar {
      display: none;
    }

    .headers-row {
      display: flex;
      align-items: center;
      gap: 0px;
      margin-bottom: 10px;
      padding: 0 5px;
    }

    .header-name {
      flex: 1;
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: left;
    }

    .header-probability {
      color: rgba(255,255,255,0.7);
      font-size: 14px;
      font-weight: 600;
      text-align: center;
      width: 120px;
      flex-shrink: 0;
    }

    .header-remove {
      width: 44px;
    }

    .name-item {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .name-input {
      flex: 1;
      padding: 10px 15px;
      border: 2px solid rgba(255,255,255,0.2);
      border-radius: 10px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      font-size: 16px;
      transition: 0.3s;
    }
    .name-input:focus {
      outline: none;
      border-color: rgba(255,255,255,0.5);
      background: rgba(255,255,255,0.2);
    }
    .name-input::placeholder {
      color: rgba(255,255,255,0.5);
    }

    .name-input.error-state {
      border-color: #ef4444 !important;
      background: rgba(239,68,68,0.1) !important;
    }

    .name-input.error-state::placeholder {
      color: rgba(255, 255, 255, 0.7);
    }

    .probability-controls {
      display: flex;
      gap: 5px;
      width: 120px;
      flex-shrink: 0;
    }

    .prob-btn {
      padding: 5px 10px;
      background: rgba(255,255,255,0.2);
      color: #fff;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .prob-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.05);
    }

    .prob-btn:active {
      transform: scale(0.95);
    }

    .probability-input {
      width: 55px;
      padding: 4px;
      background: rgba(255,255,255,0.1);
      color: #ffd43b;
      border: 2px solid rgba(255,212,59,0.3);
      border-radius: 5px;
      text-align: center;
      font-weight: 800;
      font-size: 14px;
      transition: 0.2s;
      flex-shrink: 0;
    }

    .probability-input::-webkit-outer-spin-button,
    .probability-input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      appearance: none;
      margin: 0;
    }

    .probability-input[type=number] {
      -moz-appearance: textfield;
      appearance: textfield;
    }

    .probability-input.error {
      border-color: #ef4444;
      background: rgba(239,68,68,0.2);
    }

    .probability-input.manual {
      background: rgba(255,244,204,0.25);
      border-color: #F59E0B;
      box-shadow: 0 0 0 3px rgba(245,158,11,0.25);
    }

    .prob-btn,
    .remove-btn,
    .add-btn-small {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .equalize-btn {
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .prob-btn:hover,
    .remove-btn:hover,
    .add-btn-small:hover,
    .equalize-btn:hover {
      box-shadow: 0 6px 16px rgba(0,0,0,0.3);
    }

    .probability-input:focus {
      outline: none;
      border-color: rgba(255,212,59,0.6);
      background: rgba(255,255,255,0.15);
    }

    .remove-btn {
      padding: 8px 12px;
      background: rgba(239,68,68,0.2);
      color: #fff;
      border: 2px solid rgba(239,68,68,0.3);
      border-radius: 8px;
      cursor: pointer;
      font-size: 18px;
      font-weight: 700;
      transition: 0.2s;
      width: 44px;
      flex-shrink: 0;
    }

    .remove-btn:hover {
      background: rgba(239,68,68,0.4);
      border-color: rgba(239,68,68,0.5);
      transform: scale(1.05);
    }

    .remove-btn:active {
      transform: scale(0.95);
    }

    .add-name-container {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .add-btn-small {
      padding: 10px 15px;
      background: rgba(34,197,94,0.7);
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-size: 20px;
      transition: 0.3s;
    }
    .add-btn-small:hover {
      background: rgba(34,197,94,0.9);
      transform: scale(1.1);
    }

    .add-btn-small:active {
      transform: scale(0.95);
    }

    .start-btn {
      width: auto;
      min-width: 200px;
      padding: 15px 30px;
      font-size: 18px;
      font-weight: 800;
      border: none;
      border-radius: 50px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      transition: 0.3s;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
      margin-top: 20px;
    }

    .start-btn:before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: rgba(255,255,255,0.3);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .start-btn:hover:not(:disabled):before {
      width: 300px;
      height: 300px;
    }

    .start-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.3);
    }

    .start-btn:active:not(:disabled) {
      transform: translateY(0);
    }

    .start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    button:disabled,
    input:disabled {
      opacity: 0.5;
      cursor: not-allowed !important;
    }

    .error-message {
      color: #fff;
      font-size: 13px;
      margin-top: 8px;
      min-height: 16px;
    }

    /* –¢—É–ª—Ç–∏–ø –¥–ª—è –æ—à–∏–±–æ–∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π */
    .probability-error-tooltip {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, rgba(239,68,68,0.95), rgba(220,38,38,0.95));
      color: #fff;
      padding: 20px 30px;
      border-radius: 15px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.4);
      z-index: 1002;
      font-weight: 700;
      font-size: 16px;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 2px solid rgba(255,255,255,0.3);
      animation: tooltipAppear 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    @keyframes tooltipAppear {
      from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.8);
      }
      to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }

    /* ===== RESPONSIVE ===== */
    @media (max-width: 1024px) {
      .main-container {
        flex-direction: column;
      }

      .settings-panel {
        width: 100%;
        max-width: 500px;
      }

      .game-container {
        width: 100%;
      }
    }

    @media (max-width: 918px) {
      html, body {
        max-width: 100%;
        overflow-x: hidden;
      }
      body {
        padding: calc(66px + var(--safe-top)) var(--safe-right) calc(20px + var(--safe-bottom)) var(--safe-left);
      }

      .top-buttons {
        display: none;
      }

      .menu-container {
        display: block;
        position: fixed;
        top: var(--safe-top);
        left: var(--safe-left);
        right: var(--safe-right);
        z-index: 1000;
        padding: 12px 16px;
        background: linear-gradient(180deg, rgba(102,126,234,0.95) 0%, rgba(118,75,162,0.85) 100%);
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
      }

      .menu-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .menu-title {
        color: #fff;
        font-size: 18px;
        font-weight: 700;
        text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      }

      .burger-btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 8px 12px;
        cursor: pointer;
        display: flex;
        flex-direction: column;
        gap: 4px;
        transition: all 0.3s ease;
      }

      .burger-btn:hover {
        background: rgba(255,255,255,0.3);
      }

      .burger-btn span {
        display: block;
        width: 24px;
        height: 3px;
        background: #fff;
        border-radius: 2px;
        transition: all 0.3s ease;
      }

      .burger-btn.active span:nth-child(1) {
        transform: rotate(45deg) translateY(7px);
      }

      .burger-btn.active span:nth-child(2) {
        opacity: 0;
      }

      .burger-btn.active span:nth-child(3) {
        transform: rotate(-45deg) translateY(-7px);
      }

      .menu-dropdown {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: linear-gradient(180deg, rgba(102,126,234,0.98) 0%, rgba(118,75,162,0.98) 100%);
        backdrop-filter: blur(10px);
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .menu-dropdown.active {
        max-height: 500px;
      }

      .menu-dropdown a {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 16px 20px;
        color: #fff;
        text-decoration: none;
        font-size: 16px;
        font-weight: 600;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        transition: background 0.2s;
      }

      .menu-dropdown a:last-child {
        border-bottom: none;
      }

      .menu-dropdown a:hover {
        background: rgba(255,255,255,0.15);
      }

      .menu-dropdown a:active {
        background: rgba(255,255,255,0.25);
      }

      .main-container {
        flex-direction: column;
        gap: 20px;
      }

      .collapse-btn {
        display: block;
      }

      .game-field {
        min-height: 400px;
      }

      .name-item {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: nowrap;
      }

      .name-item .name-input {
        flex: 1;
        min-width: 0;
      }

      .name-item .probability-controls {
        flex-shrink: 0;
      }

      .name-item .remove-btn {
        flex-shrink: 0;
      }

      .names-list-wrapper {
        max-height: none;
      }

      .names-list {
        max-height: none;
        overflow-y: visible;
        overflow: visible;
        width: 100%;
        max-width: 100%;
        flex: 1 1 auto;
      }

      .name-input.invalid {
        border-color: #ef4444 !important;
        background: rgba(239,68,68,0.1) !important;
      }

      .headers-row {
        padding: 0 2px;
      }

      h1 {
        font-size: clamp(24px, 6vw, 48px);
        margin-bottom: 30px;
        margin-top: 18px !important;
      }

      .probability-error-tooltip {
        max-width: 90%;
        padding: 16px 20px;
        font-size: 14px;
      }

      .add-name-container {
        display: flex;
        gap: 8px;
        margin-top: 15px;
      }

      .add-name-container .name-input {
        flex: 1;
        min-width: 0;
      }

      .add-btn-small {
        flex-shrink: 0;
        width: 44px;
        padding: 10px 0;
      }

      .settings-panel {
        width: 100%;
        max-width: 600px;
        padding: 20px 16px;
        margin: 0 auto;
      }

      .settings-header {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        margin-bottom: 10px;
      }

      .settings-actions {
        display: flex;
        justify-content: space-between;
        width: 100%;
        gap: 8px;
        margin-bottom: 4px;
      }

      .settings-actions .equalize-btn {
        flex: 1;
        max-width: 100%;
        padding: 10px 0;
        font-size: 14px;
        text-align: center;
      }
    }
  </style>
</head>
<body>

  <!-- Desktop Menu -->
  <div class="top-buttons">
    <button class="desktop-menu-toggle" id="desktopMenuToggle" aria-label="–ú–µ–Ω—é">
      <div class="menu-icon">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </button>
    <nav class="desktop-dropdown" id="desktopDropdown">
      <a href="index.html"><span>üè†</span> –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html"><span>üé°</span> –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html"><span>üé±</span> –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html"><span>üîÆ</span> –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html"><span>üéØ</span> –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html"><span>üèÅ</span> –ì–æ–Ω–∫–∏</a>
      <a href="trading.html"><span>üìà</span> –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html"><span>‚öîÔ∏è</span> –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <!-- Mobile Menu -->
  <div class="menu-container">
    <div class="menu-header">
      <div class="menu-title">–†–ê–ù–î–û–ú–ê–ô–ó–ï–†</div>
      <button class="burger-btn" id="burgerBtn" aria-label="–ú–µ–Ω—é">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <nav class="menu-dropdown" id="menuDropdown">
      <a href="index.html">üè† –ì–ª–∞–≤–Ω–∞—è</a>
      <a href="wheel-of-fortune.html">üé° –ö–æ–ª–µ—Å–æ –§–æ—Ä—Ç—É–Ω—ã</a>
      <a href="lottery-drum.html">üé± –õ–æ—Ç–æ—Ç—Ä–æ–Ω</a>
      <a href="crystal-ball.html">üîÆ –ú–∞–≥–∏—á–µ—Å–∫–∏–π –®–∞—Ä</a>
      <a href="plinko.html">üéØ –ü–ª–∏–Ω–∫–æ</a>
      <a href="racing.html">üèÅ –ì–æ–Ω–∫–∏</a>
      <a href="trading.html">üìà –¢—Ä–µ–π–¥–∏–Ω–≥</a>
      <a href="tournament.html">‚öîÔ∏è –¢—É—Ä–Ω–∏—Ä</a>
    </nav>
  </div>

  <div class="main-container">
    <!-- Game Container -->
    <div class="game-container">
      <h1 style="color: #fff; text-align: center; font-size: 48px; font-weight: 800; margin-bottom: 20px; text-shadow: 3px 3px 6px rgba(0,0,0,0.5);">–†–ê–ù–î–û–ú–ê–ô–ó–ï–†</h1>
      <div class="game-field" id="gameField">
      </div>
      <button class="start-btn" id="startBtn">–ó–∞–ø—É—Å—Ç–∏—Ç—å</button>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel">
      <div class="settings-header">
        <h2 class="settings-title">–£—á–∞—Å—Ç–Ω–∏–∫–∏</h2>
        <div class="settings-actions">
          <button class="equalize-btn" id="equalizeBtn" title="–£—Ä–∞–≤–Ω—è—Ç—å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏">–£—Ä–∞–≤–Ω—è—Ç—å</button>
        </div>
      </div>

      <div class="names-list-wrapper" id="namesListWrapper">
        <div class="headers-row">
          <div class="header-name">–ò–º—è</div>
          <div class="header-probability">üìä –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å</div>
          <div class="header-remove"></div>
        </div>
        <div class="names-list" id="namesList"></div>
      </div>

      <div class="add-name-container">
        <input type="text" class="name-input" id="newNameInput" placeholder="–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫" maxlength="15">
        <button class="add-btn-small" id="addNameBtn" title="–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞">‚ûï</button>
      </div>

      <div id="errorMessage" class="error-message"></div>
    </div>
  </div>

<script>
  const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || window.innerWidth < 768;

  const NAMES_KEY = 'shared_names_v1';
  const PROB_KEY = 'shared_probabilities_v2';
  const LOCKED_KEY = 'shared_locked_v1';
  const MAX_PARTICIPANTS = 20;
  const MIN_PROBABILITY = 0.05; // 5%

  let names = ['–£—á–∞—Å—Ç–Ω–∏–∫ 1','–£—á–∞—Å—Ç–Ω–∏–∫ 2','–£—á–∞—Å—Ç–Ω–∏–∫ 3','–£—á–∞—Å—Ç–Ω–∏–∫ 4','–£—á–∞—Å—Ç–Ω–∏–∫ 5','–£—á–∞—Å—Ç–Ω–∏–∫ 6'];
  let probabilities = {};
  let lockedParticipants = {};
  let hasCustomProbabilities = false;
  let isLoadingFromStorage = false;

  const namesList = document.getElementById('namesList');
  const newNameInput = document.getElementById('newNameInput');
  const addNameBtn = document.getElementById('addNameBtn');
  const startBtn = document.getElementById('startBtn');
  const errorMessage = document.getElementById('errorMessage');
  const gameField = document.getElementById('gameField');
  const equalizeBtn = document.getElementById('equalizeBtn');
  const namesListWrapper = document.getElementById('namesListWrapper');

  const defaultNewNamePlaceholder = '–ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫';

  function resetNewNamePlaceholder() {
    newNameInput.placeholder = defaultNewNamePlaceholder;

    if (!newNameInput.value.trim()) {
      newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
      newNameInput.style.background = 'rgba(255,255,255,0.1)';
    }
  }

  newNameInput.addEventListener('focus', resetNewNamePlaceholder);
  newNameInput.addEventListener('click', resetNewNamePlaceholder);

  function showErrorTooltip(message) {
    const existing = document.querySelector('.probability-error-tooltip');
    if (existing) existing.remove();

    const tooltip = document.createElement('div');
    tooltip.className = 'probability-error-tooltip';
    tooltip.textContent = message;
    document.body.appendChild(tooltip);

    setTimeout(() => {
      tooltip.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
      tooltip.style.opacity = '0';
      tooltip.style.transform = 'translate(-50%, -50%) scale(0.8)';
      setTimeout(() => tooltip.remove(), 300);
    }, 2000);
  }

  function clearErrorMessage() {
    if (errorMessage) errorMessage.textContent = '';
  }

  function saveState() {
    try {
      localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      const cleanP = {};
      names.forEach((nm) => cleanP[nm] = probabilities[nm] ?? 0);
      const cleanLocked = {};
      names.forEach((nm) => { if (lockedParticipants[nm]) cleanLocked[nm] = true; });
      localStorage.setItem(PROB_KEY, JSON.stringify({
        probabilities: cleanP,
        hasCustomProbabilities
      }));
      localStorage.setItem(LOCKED_KEY, JSON.stringify(cleanLocked));
    } catch (e) {}
  }

  newNameInput.addEventListener('keydown', (e) => {
    if (newNameInput.value.length >= 15 &&
        !['Backspace', 'Delete', 'ArrowLeft', 'ArrowRight', 'Tab', 'Home', 'End'].includes(e.key) &&
        !e.ctrlKey && !e.metaKey) {

      newNameInput.style.borderColor = '#ef4444';
      newNameInput.style.background = 'rgba(239,68,68,0.1)';
      showErrorTooltip('–ù–µ –±–æ–ª–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
    }
  });

  function equalizeProbabilities() {
    const count = Math.max(1, names.length);
    const p = 1 / count;
    probabilities = {};
    lockedParticipants = {};
    hasCustomProbabilities = false;
    names.forEach((n) => {
      probabilities[n] = p;
    });
    saveState();
    renderParticipants();
    validateAllNames();
  }

  function validateAndFixProbabilities() {
    const belowMin = names.filter(n => (probabilities[n] ?? 0) < 0.05);

    if (belowMin.length === 0) {
      const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      if (Math.abs(sum - 1) > 1e-4) {
        const k = 1 / sum;
        names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
      }
      return;
    }

    belowMin.forEach(n => probabilities[n] = 0.05);

    const fixedSum = belowMin.length * 0.05;
    const others = names.filter(n => !belowMin.includes(n));

    if (others.length === 0) {
      equalizeProbabilities();
      return;
    }

    const othersSum = others.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
    const remainForOthers = 1 - fixedSum;

    if (othersSum > 0) {
      const scale = remainForOthers / othersSum;
      others.forEach(nm => probabilities[nm] = (probabilities[nm] || 0) * scale);

      const stillBelowMin = others.some(nm => (probabilities[nm] ?? 0) < 0.05);

      if (stillBelowMin) {
        equalizeProbabilities();
      }
    } else {
      equalizeProbabilities();
    }
  }

  function loadState() {
    isLoadingFromStorage = true;

    try {
      const savedNames = JSON.parse(localStorage.getItem(NAMES_KEY) || '[]');
      if (Array.isArray(savedNames) && savedNames.length) {
        names = savedNames.slice(0, MAX_PARTICIPANTS);
        if (names.length === 1) {
          names.push('–£—á–∞—Å—Ç–Ω–∏–∫ 2');
        }
      } else {
        localStorage.setItem(NAMES_KEY, JSON.stringify(names));
      }
    } catch (e) {}

    try {
      const saved = JSON.parse(localStorage.getItem(PROB_KEY) || '{}');
      const savedLocked = JSON.parse(localStorage.getItem(LOCKED_KEY) || '{}');

      if (saved?.hasCustomProbabilities && saved?.probabilities && Object.keys(saved.probabilities).length) {
        probabilities = { ...saved.probabilities };
        lockedParticipants = { ...savedLocked };
        hasCustomProbabilities = true;

        Object.keys(probabilities).forEach((n) => { if (!names.includes(n)) delete probabilities[n]; });
        Object.keys(lockedParticipants).forEach((n) => { if (!names.includes(n)) delete lockedParticipants[n]; });

        names.forEach((n) => { if (!(n in probabilities)) probabilities[n] = 0.05; });

        normalizeProbabilities();
      } else {
        equalizeProbabilities();
      }
    } catch (e) {
      equalizeProbabilities();
    }

    isLoadingFromStorage = false;
  }

  function getPercent(name) {
    const n = Math.max(1, names.length);
    if (!(name in probabilities)) {
      return (100 / n).toFixed(1);
    }
    return (probabilities[name] * 100).toFixed(1);
  }

  function getRealisticMaxPercent(name) {
    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);

    const otherLockedSum = otherLocked.reduce(
      (s, nm) => s + (probabilities[nm] || 0),
      0
    );

    const minUnlockedTotal = willBeUnlocked.length * 0.05;

    const rawMax = (1 - otherLockedSum - minUnlockedTotal) * 100;

    const rounded = Math.round(rawMax * 10) / 10;

    return Math.max(5, Math.min(100, rounded));
  }

  function normalizeProbabilities() {
    if (!hasCustomProbabilities) {
      const exact = 1 / (names.length || 1);
      names.forEach((nm) => probabilities[nm] = exact);
      return;
    }

    const locked = names.filter(n => lockedParticipants[n]);
    const unlocked = names.filter(n => !lockedParticipants[n]);

    if (unlocked.length === 0) {
      const sum = names.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
      if (sum > 0 && Math.abs(sum - 1) > 1e-4) {
        const k = 1 / sum;
        names.forEach((nm) => probabilities[nm] = (probabilities[nm] || 0) * k);
      }

      const hasViolation = names.some(nm => (probabilities[nm] ?? 0) < 0.049);
      if (hasViolation) {
        equalizeProbabilities();
      }
      return;
    }

    const lockedSum = locked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);

    const minUnlockedTotal = unlocked.length * 0.05;
    const remainForUnlocked = 1 - lockedSum;

    const lockedViolation = locked.some(nm => (probabilities[nm] ?? 0) < 0.049);

    if (lockedViolation || remainForUnlocked < minUnlockedTotal - 0.001 || lockedSum > 1.001) {
      equalizeProbabilities();
      return;
    }

    const sharePerUnlocked = remainForUnlocked / unlocked.length;
    unlocked.forEach(nm => probabilities[nm] = sharePerUnlocked);

    const finalViolation = names.some(nm => (probabilities[nm] ?? 0) < 0.049);
    if (finalViolation) {
      equalizeProbabilities();
    }
  }

  function setProbabilityManually(name, percentValue) {
    const maxPossible = getRealisticMaxPercent(name);

    if (isNaN(percentValue) || percentValue < 5 || percentValue > maxPossible + 0.2) {
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${maxPossible.toFixed(1)}%`);
      return false;
    }

    hasCustomProbabilities = true;
    lockedParticipants[name] = true;
    probabilities[name] = percentValue / 100;

    normalizeProbabilities();
    saveState();
    resetNewNamePlaceholder();

    return true;
  }

  function changeProbability(name, delta) {
    const cur = parseFloat(getPercent(name)) || 0;
    const maxPossible = 100 - (names.length - 1) * 5;
    const next = Math.max(5, Math.min(maxPossible, cur + delta));

    if (Math.abs(next - cur) < 0.01) {
      const realisticMax = getRealisticMaxPercent(name);
      if (delta > 0) {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º: ${realisticMax.toFixed(1)}%`);
      } else {
        showErrorTooltip(`–î–æ—Å—Ç–∏–≥–Ω—É—Ç –º–∏–Ω–∏–º—É–º: 5.0%`);
      }
      return;
    }

    const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
    const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
    const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
    const newProbForThis = next / 100;
    const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
    const minUnlockedTotal = willBeUnlocked.length * 0.05;

    if (remainForUnlocked < minUnlockedTotal - 0.001) {
      const realisticMax = getRealisticMaxPercent(name);
      showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
      return;
    }

    setProbabilityManually(name, next);
    renderParticipants();
  }

  function validateProbabilities() {
    if (!names.length) return false;

    let sum = 0;
    for (const n of names) {
      const p = probabilities[n] || 0;
      if (p < MIN_PROBABILITY - 1e-6) {
        showErrorTooltip(
          `–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å ‚Äî ${(MIN_PROBABILITY * 100).toFixed(1)}%`
        );
        return false;
      }
      sum += p;
    }

    if (Math.abs(sum - 1) > 0.001) {
      showErrorTooltip(
        `–°—É–º–º–∞ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å 100% (—Å–µ–π—á–∞—Å ${(sum * 100).toFixed(1)}%)`
      );
      return false;
    }

    clearErrorMessage();
    return true;
  }

  function validateAllNames() {
    let allValid = true;

    const nameInputs = namesList.querySelectorAll('.name-input');
    nameInputs.forEach(input => {
      const value = input.value.trim();
      if (!value || value.length === 0 || value.length > 15) {
        allValid = false;
      }
    });

    if (startBtn) {
      startBtn.disabled = !allValid;
    }

    return allValid;
  }

  function removeParticipant(idx) {
    if (names.length <= 2) {
      showErrorTooltip('–ú–∏–Ω–∏–º—É–º 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞!');
      return;
    }

    const name = names[idx];
    names.splice(idx, 1);
    delete probabilities[name];
    delete lockedParticipants[name];

    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();
  }

  function addNewParticipant() {
    const newName = newNameInput.value.trim();

    if (!newName) {
      newNameInput.classList.add('error-state');
      newNameInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è';
      return;
    }

    if (newName.length > 15) {
      showErrorTooltip('–ú–∞–∫—Å–∏–º—É–º 15 —Å–∏–º–≤–æ–ª–æ–≤ –≤ –∏–º–µ–Ω–∏');
      return;
    }

    if (names.some((n) => n.toLowerCase() === newName.toLowerCase())) {
      showErrorTooltip('–≠—Ç–æ –∏–º—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è!');
      return;
    }

    if (names.length >= MAX_PARTICIPANTS) {
      showErrorTooltip(`–ú–∞–∫—Å–∏–º—É–º ${MAX_PARTICIPANTS} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤!`);
      return;
    }

    names.push(newName);
    probabilities[newName] = 0.05;
    normalizeProbabilities();
    saveState();
    renderParticipants();
    validateProbabilities();

    newNameInput.value = '';
    resetNewNamePlaceholder();
    clearErrorMessage();
  }

  if (addNameBtn) {
    addNameBtn.addEventListener('click', addNewParticipant);
  }

  if (equalizeBtn) {
    equalizeBtn.addEventListener('click', equalizeProbabilities);
  }

  if (newNameInput) {
    newNameInput.addEventListener('input', () => {
      const v = newNameInput.value.trim();

      if (!v) {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
        return;
      }

      const dup = names.some((n) => n.toLowerCase() === v.toLowerCase());
      if (dup || v.length > 15) {
        newNameInput.style.borderColor = '#ef4444';
        newNameInput.style.background = 'rgba(239,68,68,0.1)';
        newNameInput.classList.add('error-state');
      } else {
        newNameInput.style.borderColor = 'rgba(255,255,255,0.2)';
        newNameInput.style.background = 'rgba(255,255,255,0.1)';
        newNameInput.classList.remove('error-state');
        clearErrorMessage();
      }
    });

    newNameInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        addNewParticipant();
      }
    });

    newNameInput.addEventListener('focus', () => {
      resetNewNamePlaceholder();
      newNameInput.style.borderColor = 'rgba(255,255,255,0.5)';
      newNameInput.style.background = 'rgba(255,255,255,0.2)';
      clearErrorMessage();
    });
  }

  function renderParticipants() {
    namesList.innerHTML = '';

    names.forEach((name, idx) => {
      const row = document.createElement('div');
      row.className = 'name-item';

      const input = document.createElement('input');
      input.type = 'text';
      input.className = 'name-input';
      input.value = name;
      input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
      input.maxLength = 15;

      input.addEventListener('keydown', (e) => {
        if (
          input.value.length >= 15 &&
          !['Backspace','Delete','ArrowLeft','ArrowRight','Tab','Home','End'].includes(e.key) &&
          !e.ctrlKey && !e.metaKey
        ) {
          showErrorTooltip('–ù–µ –±–æ–ª–µ–µ 15 —Å–∏–º–≤–æ–ª–æ–≤');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          setTimeout(() => {
            if (input.value.trim() && !names.some((n, i) => i !== idx && n.toLowerCase() === input.value.trim().toLowerCase())) {
              input.style.borderColor = 'rgba(255,255,255,0.2)';
              input.style.background = 'rgba(255,255,255,0.1)';
            }
          }, 1500);
        }
      });

      input.addEventListener('input', () => {
        const v = input.value.trim();

        if (!v) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.classList.add('error-state');
          input.style.borderColor = '#ef4444';
          input.style.background = 'rgba(239,68,68,0.1)';
        } else {
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
        }

        validateAllNames();
      });

      input.addEventListener('blur', () => {
        const v = input.value.trim();

        if (!v) {
          input.value = name;
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
          validateAllNames();
          return;
        }

        const dup = names.some((n, i) => i !== idx && n.toLowerCase() === v.toLowerCase());
        if (dup || v.length > 15) {
          input.value = names[idx];
          input.classList.remove('error-state');
          input.style.borderColor = 'rgba(255,255,255,0.2)';
          input.style.background = 'rgba(255,255,255,0.1)';
          showErrorTooltip('–ò–º–µ–Ω–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ –∏ –¥–æ 15 —Å–∏–º–≤–æ–ª–æ–≤!');
          validateAllNames();
          return;
        }

        const oldName = names[idx];
        if (v !== oldName) {
          names[idx] = v;

          if (probabilities[oldName] !== undefined) {
            probabilities[v] = probabilities[oldName];
            delete probabilities[oldName];
          }

          if (lockedParticipants[oldName]) {
            lockedParticipants[v] = true;
            delete lockedParticipants[oldName];
          }

          saveState();
        }

        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.2)';
        input.style.background = 'rgba(255,255,255,0.1)';
        input.placeholder = '–ò–º—è —É—á–∞—Å—Ç–Ω–∏–∫–∞';
        validateAllNames();
      });

      input.addEventListener('focus', () => {
        input.classList.remove('error-state');
        input.style.borderColor = 'rgba(255,255,255,0.5)';
        input.style.background = 'rgba(255,255,255,0.2)';
        clearErrorMessage();
      });

      const probControls = document.createElement('div');
      probControls.className = 'probability-controls';

      const minusBtn = document.createElement('button');
      minusBtn.className = 'prob-btn';
      minusBtn.textContent = '‚àí';
      minusBtn.onclick = () => {
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, -1);
      };

      const probInput = document.createElement('input');
      probInput.type = 'text';
      probInput.className = 'probability-input';
      probInput.setAttribute('inputmode', 'decimal');
      probInput.setAttribute('aria-label', '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö');
      probInput.value = getPercent(name);

      if (lockedParticipants[name]) {
        probInput.classList.add('manual');
      }

      let lastValid = probInput.value;

      probInput.addEventListener('focus', () => {
        probInput.value = probInput.value.replace('%', '');
        lastValid = probInput.value;
        clearErrorMessage();
      });

      probInput.addEventListener('input', () => {
        probInput.value = probInput.value.replace(',', '.');
        let val = probInput.value.replace('%', '').trim();

        if (val.includes('.')) {
          const parts = val.split('.');
          if (parts[1] && parts[1].length > 2) {
            val = parts[0] + '.' + parts[1].substring(0, 2);
            probInput.value = val;
          }
        }

        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        if (val === '') {
          probInput.classList.remove('error');
        } else if (isNaN(num) || num < 5 || num > 100 || num > maxAllowed) {
          probInput.classList.add('error');
        } else {
          probInput.classList.remove('error');
        }
      });

      probInput.addEventListener('blur', () => {
        const val = probInput.value.replace('%', '').trim();
        const num = parseFloat(val);
        const maxAllowed = getRealisticMaxPercent(name);

        if (val === '' || isNaN(num) || num < 5 || num > maxAllowed) {
          probInput.value = lastValid;
          probInput.classList.remove('error');

          if (!isNaN(num) && (num < 5 || num > maxAllowed)) {
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${maxAllowed.toFixed(1)}%`);
          }
        } else {
          const otherLocked = names.filter(n => lockedParticipants[n] && n !== name);
          const willBeUnlocked = names.filter(n => !lockedParticipants[n] && n !== name);
          const otherLockedSum = otherLocked.reduce((s, nm) => s + (probabilities[nm] || 0), 0);
          const newProbForThis = num / 100;
          const remainForUnlocked = 1 - otherLockedSum - newProbForThis;
          const minUnlockedTotal = willBeUnlocked.length * 0.05;

          if (remainForUnlocked < minUnlockedTotal - 0.001) {
            probInput.value = lastValid;
            probInput.classList.remove('error');

            const realisticMax = getRealisticMaxPercent(name);
            showErrorTooltip(`–ú–∏–Ω–∏–º—É–º 5.0%, –º–∞–∫—Å–∏–º—É–º ${realisticMax.toFixed(1)}%`);
          } else if (setProbabilityManually(name, num)) {
            lastValid = getPercent(name);
            renderParticipants();
          } else {
            probInput.value = lastValid;
            probInput.classList.remove('error');
          }
        }
      });

      probInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          e.preventDefault();
          probInput.blur();
        }
        if (!/[\d.,]/.test(e.key) && e.key !== 'Enter') e.preventDefault();
      });

      const plusBtn = document.createElement('button');
      plusBtn.className = 'prob-btn';
      plusBtn.textContent = '+';
      plusBtn.onclick = () => {
        if (lockedParticipants[name]) {
          delete lockedParticipants[name];
          hasCustomProbabilities = Object.keys(lockedParticipants).length > 0;
        }
        changeProbability(name, 1);
      };

      probControls.appendChild(minusBtn);
      probControls.appendChild(probInput);
      probControls.appendChild(plusBtn);

      const removeBtn = document.createElement('button');
      removeBtn.className = 'remove-btn';
      removeBtn.textContent = '‚úï';
      removeBtn.onclick = () => removeParticipant(idx);

      row.appendChild(input);
      row.appendChild(probControls);
      row.appendChild(removeBtn);

      namesList.appendChild(row);
    });

    validateAllNames();
  }

  // ===== DESKTOP MENU =====
  const desktopMenuToggle = document.getElementById('desktopMenuToggle');
  const desktopDropdown = document.getElementById('desktopDropdown');

  let desktopMenuOpen = false;

  function toggleDesktopMenu() {
    desktopMenuOpen = !desktopMenuOpen;
    desktopDropdown.classList.toggle('active', desktopMenuOpen);
    desktopMenuToggle.classList.toggle('active', desktopMenuOpen);
  }

  if (desktopMenuToggle) {
    desktopMenuToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleDesktopMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        desktopMenuOpen &&
        !desktopDropdown.contains(e.target) &&
        !desktopMenuToggle.contains(e.target)
      ) {
        toggleDesktopMenu();
      }
    });
  }

  // ===== BURGER MENU (MOBILE) =====
  const burgerBtn = document.getElementById('burgerBtn');
  const menuDropdown = document.getElementById('menuDropdown');
  let menuOpen = false;

  function toggleMenu() {
    menuOpen = !menuOpen;
    menuDropdown.classList.toggle('active', menuOpen);
    burgerBtn.classList.toggle('active', menuOpen);
  }

  if (burgerBtn) {
    burgerBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleMenu();
    });

    document.addEventListener('click', (e) => {
      if (
        menuOpen &&
        !menuDropdown.contains(e.target) &&
        !burgerBtn.contains(e.target)
      ) {
        toggleMenu();
      }
    });
  }

  // ===== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò –î–õ–Ø –†–ê–ë–û–¢–´ –° –£–ß–ê–°–¢–ù–ò–ö–ê–ú–ò =====

  // –ü–æ–ª—É—á–∏—Ç—å –º–∞—Å—Å–∏–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Å –∏—Ö –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º–∏
  function getParticipantsData() {
    return names.map(name => ({
      name: name,
      probability: probabilities[name] || 0,
      isLocked: !!lockedParticipants[name]
    }));
  }

  // –í—ã–±—Ä–∞—Ç—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—è–º
  function selectRandomParticipant() {
    const rand = Math.random();
    let cumulative = 0;

    for (const name of names) {
      cumulative += probabilities[name] || 0;
      if (rand <= cumulative) {
        return name;
      }
    }

    return names[names.length - 1];
  }

  // –ü–æ–ª—É—á–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞ –ø–æ –∏–Ω–¥–µ–∫—Å—É
  function getParticipantByIndex(index) {
    if (index >= 0 && index < names.length) {
      return {
        name: names[index],
        probability: probabilities[names[index]] || 0,
        isLocked: !!lockedParticipants[names[index]]
      };
    }
    return null;
  }

  // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ù–û–ü–ö–ò "–ó–ê–ü–£–°–¢–ò–¢–¨" =====
  if (startBtn) {
    startBtn.addEventListener('click', () => {
      if (!validateProbabilities()) {
        return;
      }

      // –ó–î–ï–°–¨ –í–ê–®–ê –õ–û–ì–ò–ö–ê –†–ê–ù–î–û–ú–ê–ô–ó–ï–†–ê
      console.log('–ó–∞–ø—É—Å–∫ —Ä–∞–Ω–¥–æ–º–∞–π–∑–µ—Ä–∞!');
      console.log('–£—á–∞—Å—Ç–Ω–∏–∫–∏:', getParticipantsData());

      // –ü—Ä–∏–º–µ—Ä: –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–≥–æ —É—á–∞—Å—Ç–Ω–∏–∫–∞
      const winner = selectRandomParticipant();
      console.log('–ü–æ–±–µ–¥–∏—Ç–µ–ª—å:', winner);

      // –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è placeholder –≤ –∏–≥—Ä–æ–≤–æ–º –ø–æ–ª–µ
      const placeholder = gameField.querySelector('.game-placeholder');
      if (placeholder) {
        placeholder.textContent = `–í—ã–±—Ä–∞–Ω: ${winner} üéâ`;
      }
    });
  }

  // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
  loadState();
  renderParticipants();
  validateProbabilities();
</script>

</body>
</html>
